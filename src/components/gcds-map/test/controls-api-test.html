<!doctype html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />
    <title>GCDS Map - Controls API Test</title>

    <link rel="stylesheet" href="/www/gcds/gcds.css" />
    <script type="module" src="/www/gcds/gcds.esm.js"></script>
    <script type="module" src="/www/build/gcds-map.esm.js"></script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        margin: 20px;
      }
      
      h1 {
        color: #333;
      }
      
      .test-info {
        background-color: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      
      gcds-map {
        width: 600px;
        height: 400px;
        border: 1px solid #ccc;
        display: block;
        margin-bottom: 20px;
      }
      
      .controls {
        margin: 10px 0;
      }
      
      button {
        margin: 5px;
        padding: 10px 15px;
        background: #0070f3;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      
      button:hover {
        background: #0051a2;
      }
      
      .status {
        background: #e6f7ff;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
      }
    </style>
  </head>

  <body>
    <h1>GCDS Map - Controls API Test</h1>
    
    <div class="test-info">
      <h3>Controls API Test</h3>
      <p>This test verifies that both property assignment and attribute manipulation work for the controls API.</p>
    </div>

    <!-- Test map without controls initially -->
    <gcds-map 
      id="testMap"
      lat="45.4215" 
      lon="-75.6972" 
      zoom="10" 
      projection="OSMTILE">
      <gcds-map-layer src="/src/components/gcds-map/assets/mapml/en/osmtile/cbmt" checked></gcds-map-layer>
    </gcds-map>

    <div class="controls">
      <button onclick="testPropertyAPI()">Property API: map.controls = true</button>
      <button onclick="testPropertyAPIFalse()">Property API: map.controls = false</button>
      <button onclick="testAttributeAPISet()">Attribute API: setAttribute('controls', '')</button>
      <button onclick="testAttributeAPIRemove()">Attribute API: removeAttribute('controls')</button>
      <button onclick="checkStatus()">Check Current Status</button>
    </div>

    <div id="status" class="status">
      Status: Ready for testing
    </div>

    <div class="test-info">
      <h3>Expected Behavior:</h3>
      <ul>
        <li>✓ Map starts without controls visible</li>
        <li>✓ Property API (map.controls = true) shows controls and adds controls="" attribute</li>
        <li>✓ Property API (map.controls = false) hides controls and removes attribute</li>
        <li>✓ Attribute API (setAttribute) shows controls and updates property</li>
        <li>✓ Attribute API (removeAttribute) hides controls and updates property</li>
        <li>✓ Both APIs should work in DevTools: $0.controls = true, $0.setAttribute('controls', '')</li>
      </ul>
    </div>

    <div class="test-info">
      <h3>DevTools Test Commands:</h3>
      <pre>
// Select the map element first, then try:
$0.controls = true;          // Should show controls
$0.controls = false;         // Should hide controls
$0.setAttribute('controls', '');   // Should show controls
$0.removeAttribute('controls');    // Should hide controls

// Check status:
console.log('controls property:', $0.controls);
console.log('controls attribute:', $0.hasAttribute('controls'));
      </pre>
    </div>

    <script>
      const map = document.getElementById('testMap');
      const statusDiv = document.getElementById('status');

      function updateStatus(message) {
        const hasAttribute = map.hasAttribute('controls');
        const propertyValue = map.controls;
        statusDiv.innerHTML = `
          ${message}<br>
          Property (map.controls): ${propertyValue}<br>
          Attribute (hasAttribute('controls')): ${hasAttribute}<br>
          Should match: ${propertyValue === hasAttribute ? '✓ YES' : '✗ NO'}
        `;
      }

      function testPropertyAPI() {
        map.controls = true;
        updateStatus('Property API: Set controls = true');
      }

      function testPropertyAPIFalse() {
        map.controls = false;
        updateStatus('Property API: Set controls = false');
      }

      function testAttributeAPISet() {
        map.setAttribute('controls', '');
        updateStatus('Attribute API: setAttribute("controls", "")');
      }

      function testAttributeAPIRemove() {
        map.removeAttribute('controls');
        updateStatus('Attribute API: removeAttribute("controls")');
      }

      function checkStatus() {
        updateStatus('Current Status Check');
      }

      // Initial status check
      setTimeout(() => {
        updateStatus('Initial Load Complete');
      }, 1000);

      // Listen for changes to verify reactivity
      map.addEventListener('controlsChanged', (e) => {
        console.log('controlsChanged event:', e);
      });
      
      // Watch for attribute changes
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes' && mutation.attributeName === 'controls') {
            console.log('Controls attribute changed:', map.hasAttribute('controls'));
          }
        });
      });
      observer.observe(map, { attributes: true, attributeFilter: ['controls'] });
    </script>
  </body>
</html>