<!doctype html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />
    <title>GCDS Map - Reload Button Test</title>

    <link rel="stylesheet" href="/www/gcds/gcds.css" />
    <script type="module" src="/www/gcds/gcds.esm.js"></script>

    <script type="module" src="/www/build/gcds-map.esm.js"></script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        margin: 20px;
      }
      
      h1 {
        color: #333;
      }
      
      .test-info {
        background-color: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      
      gcds-map {
        width: 600px;
        height: 400px;
        border: 1px solid #ccc;
        display: block;
      }
    </style>
  </head>

  <body>
    <h1>GCDS Map - Reload Button Test</h1>
    
    <div class="test-info">
      <h3>Test Instructions:</h3>
      <ol>
        <li>The map should load with controls enabled (including reload button)</li>
        <li>Pan/zoom the map to move away from the initial position</li>
        <li>Look for the reload button (↺) in the top-left corner</li>
        <li>Click the reload button to return to the initial map position</li>
        <li>The reload button should be disabled when at the initial position</li>
      </ol>
    </div>

    <gcds-map 
      lat="45.4215" 
      lon="-75.6972" 
      zoom="10" 
      projection="OSMTILE" 
      controls>
      <gcds-map-layer src="/src/components/gcds-map/assets/mapml/en/osmtile/cbmt" checked></gcds-map-layer>
    </gcds-map>

    <div class="test-info" style="margin-top: 20px;">
      <h3>Expected Behavior:</h3>
      <ul>
        <li>✓ Reload button appears in top-left control area</li>
        <li>✓ Reload button is initially disabled (grayed out)</li>
        <li>✓ After panning/zooming, reload button becomes enabled</li>
        <li>✓ Clicking reload button returns map to initial position (Ottawa: 45.4215, -75.6972, zoom 10)</li>
        <li>✓ After reload, button becomes disabled again</li>
      </ul>
    </div>

    <script>
      // Add some debugging to help verify the reload button functionality
      document.addEventListener('DOMContentLoaded', () => {
        const map = document.querySelector('gcds-map');
        
        // Log when the map component is ready
        map.addEventListener('componentDidLoad', () => {
          console.log('Map loaded');
          console.log('Map element:', map);
          console.log('Map internal _map:', map._map);
          console.log('Reload button:', map._map && map._map.reloadButton);
        });
        
        // Listen for map events
        map.addEventListener('moveend', () => {
          console.log('Map moveend event - current position:', {
            lat: map.lat,
            lon: map.lon,
            zoom: map.zoom
          });
        });
      });
    </script>
  </body>
</html>