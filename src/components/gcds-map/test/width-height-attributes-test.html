<!doctype html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>GCDS Map - Width/Height Attributes Test</title>

    <link rel="stylesheet" href="/www/gcds/gcds.css" />
    <script type="module" src="/www/gcds/gcds.esm.js"></script>
    <script type="module" src="/www/build/gcds-map.esm.js"></script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        margin: 20px;
      }
      
      .test-info {
        background-color: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      
      .test-map {
        margin: 20px 0;
        border: 2px solid #ccc;
      }
    </style>
  </head>

  <body>
    <h1>GCDS Map - Width/Height Attributes Test</h1>
    
    <div class="test-info">
      <h3>Test 1: Default Size (No attributes)</h3>
      <p>Should use CSS defaults: 300px × 150px</p>
    </div>

    <gcds-map 
      id="defaultMap"
      class="test-map"
      lat="45.4215" 
      lon="-75.6972" 
      zoom="10" 
      projection="OSMTILE"
      controls>
      <gcds-map-layer src="/src/components/gcds-map/assets/mapml/en/osmtile/cbmt" checked></gcds-map-layer>
    </gcds-map>

    <div class="test-info">
      <h3>Test 2: Width Attribute Only</h3>
      <p>Should be 500px wide, height should use CSS default (150px)</p>
    </div>

    <gcds-map 
      id="widthOnlyMap"
      class="test-map"
      width="500"
      lat="45.4215" 
      lon="-75.6972" 
      zoom="10" 
      projection="OSMTILE"
      controls>
      <gcds-map-layer src="/src/components/gcds-map/assets/mapml/en/osmtile/cbmt" checked></gcds-map-layer>
    </gcds-map>

    <div class="test-info">
      <h3>Test 3: Height Attribute Only</h3>
      <p>Should be 200px tall, width should use CSS default (300px)</p>
    </div>

    <gcds-map 
      id="heightOnlyMap"
      class="test-map"
      height="200"
      lat="45.4215" 
      lon="-75.6972" 
      zoom="10" 
      projection="OSMTILE"
      controls>
      <gcds-map-layer src="/src/components/gcds-map/assets/mapml/en/osmtile/cbmt" checked></gcds-map-layer>
    </gcds-map>

    <div class="test-info">
      <h3>Test 4: Both Width and Height Attributes</h3>
      <p>Should be 600px × 300px</p>
    </div>

    <gcds-map 
      id="bothAttrsMap"
      class="test-map"
      width="600"
      height="300"
      lat="45.4215" 
      lon="-75.6972" 
      zoom="10" 
      projection="OSMTILE"
      controls>
      <gcds-map-layer src="/src/components/gcds-map/assets/mapml/en/osmtile/cbmt" checked></gcds-map-layer>
    </gcds-map>

    <div class="test-info">
      <h3>Programmatic Test Controls</h3>
      <button onclick="testAttributeChanges()">Test Dynamic Attribute Changes</button>
      <button onclick="checkAllSizes()">Check All Map Sizes</button>
      <div id="results"></div>
    </div>

    <script>
      function checkAllSizes() {
        const maps = [
          { id: 'defaultMap', expected: { width: 300, height: 150 } },
          { id: 'widthOnlyMap', expected: { width: 500, height: 150 } },
          { id: 'heightOnlyMap', expected: { width: 300, height: 200 } },
          { id: 'bothAttrsMap', expected: { width: 600, height: 300 } }
        ];

        let results = '<h4>Size Check Results:</h4><ul>';
        
        maps.forEach(test => {
          const map = document.getElementById(test.id);
          const rect = map.getBoundingClientRect();
          const computed = window.getComputedStyle(map);
          
          const widthMatch = Math.abs(rect.width - test.expected.width) < 2;
          const heightMatch = Math.abs(rect.height - test.expected.height) < 2;
          
          results += `<li><strong>${test.id}:</strong> `;
          results += `Expected: ${test.expected.width}×${test.expected.height}, `;
          results += `Actual: ${Math.round(rect.width)}×${Math.round(rect.height)} `;
          results += `${widthMatch && heightMatch ? '✅' : '❌'}</li>`;
        });
        
        results += '</ul>';
        document.getElementById('results').innerHTML = results;
      }

      function testAttributeChanges() {
        const map = document.getElementById('defaultMap');
        
        // Test setting width attribute
        map.setAttribute('width', '400');
        setTimeout(() => {
          const rect1 = map.getBoundingClientRect();
          console.log('After setting width=400:', rect1.width);
          
          // Test setting height attribute
          map.setAttribute('height', '250');
          setTimeout(() => {
            const rect2 = map.getBoundingClientRect();
            console.log('After setting height=250:', rect2.height);
            
            // Test removing attributes (should revert to CSS defaults)
            map.removeAttribute('width');
            map.removeAttribute('height');
            setTimeout(() => {
              const rect3 = map.getBoundingClientRect();
              console.log('After removing attributes:', rect3.width, '×', rect3.height);
              
              document.getElementById('results').innerHTML = 
                '<h4>Dynamic Change Test:</h4>' +
                '<p>Check console for results. Map should now be back to default size.</p>';
            }, 100);
          }, 100);
        }, 100);
      }

      // Auto-check sizes on load
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(checkAllSizes, 2000);
      });
    </script>
  </body>
</html>