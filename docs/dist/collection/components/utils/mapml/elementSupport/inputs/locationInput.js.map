{"version":3,"file":"locationInput.js","sourceRoot":"","sources":["../../../../../../src/components/utils/mapml/elementSupport/inputs/locationInput.ts"],"names":[],"mappings":"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","sourcesContent":["import { Point } from 'leaflet';\nimport { Util } from '../../Util';\n\nexport class LocationInput {\n  name: string;\n  position?: string;\n  axis: string;\n  units?: string;\n  min?: string;\n  max?: string;\n  rel?: string;\n  layer: any;\n\n  constructor(\n    name: string,\n    position: string,\n    axis: string,\n    units: string,\n    min: string,\n    max: string,\n    rel: string,\n    layer: any\n  ) {\n    this.name = name;\n    this.position = position;\n    this.axis = axis;\n    // if unit/cs not present, find it\n    if (!units && axis && !['i', 'j'].includes(axis)) {\n      this.units = Util.axisToCS(axis).toLowerCase();\n    } else {\n      this.units = units; // cs\n    }\n    this.min = min;\n    this.max = max;\n    this.rel = rel;\n    this.layer = layer;\n  }\n\n  validateInput(): boolean {\n    // name is required\n    // axis is required\n    if (!this.name || !this.axis) {\n      return false;\n    }\n    // cs/units is only required when the axis is i/j. To differentiate between the units/cs\n    if (\n      (this.axis === 'i' || this.axis === 'j') &&\n      !['map', 'tile'].includes(this.units)\n    ) {\n      return false;\n    }\n    // check if axis match the units/cs\n    if (this.units) {\n      let axisCS = Util.axisToCS(this.axis);\n      if (\n        typeof axisCS === 'string' &&\n        axisCS.toUpperCase() !== this.units.toUpperCase()\n      ) {\n        return false;\n      }\n    }\n    // position is not required, will default to top-left\n    // min max fallbacks, map-meta -> projection\n    // rel not required, default is image/extent\n    return true;\n  }\n\n  _TCRSToPCRS(coords: any, zoom: number): any {\n    // TCRS pixel point to Projected CRS point (in meters, presumably)\n    const map = this.layer._map;\n    const crs = map.options.crs;\n    const loc = crs.transformation.untransform(coords, crs.scale(zoom));\n    return loc;\n  }\n\n  getValue(zoom?: number, bounds?: any): any {\n    // units = cs\n    //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting|latitude|longitude\">\n    if (zoom === undefined) zoom = this.layer._map.getZoom();\n    if (bounds === undefined) bounds = this.layer._map.getPixelBounds();\n\n    if (this.units === 'pcrs' || this.units === 'gcrs') {\n      switch (this.axis) {\n        case 'longitude':\n        case 'easting':\n          if (this.position) {\n            if (this.position.match(/.*?-left/i)) {\n              return this._TCRSToPCRS(bounds.min, zoom).x;\n            } else if (this.position.match(/.*?-right/i)) {\n              return this._TCRSToPCRS(bounds.max, zoom).x;\n            }\n          } else {\n            // position is not required, will default to top-left\n            return this._TCRSToPCRS(bounds.min, zoom).x;\n          }\n          break;\n        case 'latitude':\n        case 'northing':\n          if (this.position) {\n            if (this.position.match(/top-.*?/i)) {\n              return this._TCRSToPCRS(bounds.min, zoom).y;\n            } else if (this.position.match(/bottom-.*?/i)) {\n              return this._TCRSToPCRS(bounds.max, zoom).y;\n            }\n          } else {\n            // position is not required, will default to top-left\n            return this._TCRSToPCRS(bounds.min, zoom).y;\n          }\n          break;\n      }\n    } else if (this.units === 'tilematrix') {\n      // Value is retrieved from the createTile method of TemplatedTileLayer, on move end.\n      // Different values for each tile when filling in the map tiles on the map.\n      // Currently storing all x,y,z within one object,\n      // TODO: change return value as needed based on usage by map-input\n      // https://github.com/Leaflet/Leaflet/blob/6994baf25f267db1c8b720c28a61e0700d0aa0e8/src/layer/tile/GridLayer.js#L652\n      const center = this.layer._map.getCenter();\n      const templatedTileLayer = this.layer._extentLayer._templates[0].layer;\n      const pixelBounds = templatedTileLayer._getTiledPixelBounds(center);\n      const tileRange = templatedTileLayer._pxBoundsToTileRange(pixelBounds);\n      const obj: any[] = [];\n      for (let j = tileRange.min.y; j <= tileRange.max.y; j++) {\n        for (let i = tileRange.min.x; i <= tileRange.max.x; i++) {\n          const coords = new Point(i, j);\n          (coords as any).z = templatedTileLayer._tileZoom;\n          obj.push(coords);\n        }\n      }\n      return obj;\n    } else if (this.units === 'tile' || this.units === 'map') {\n      // used for query handler on map enter or click.\n      // mapi, tilei, mapj, tilej used for query handling, value is derived from the mouse click event\n      // or center of the map when used with keyboard.\n    }\n    return;\n  }\n}\n"]}