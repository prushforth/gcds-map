{"version":3,"file":"map-tile.js","sourceRoot":"","sources":["../../../src/components/map-tile/map-tile.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Prop, Element, Method, Watch } from '@stencil/core';\nimport { Util } from '../utils/mapml/Util.js';\nimport { mapTileLayer } from '../utils/mapml/layers/MapTileLayer.js';\nimport { calculatePosition } from '../utils/mapml/elementSupport/layers/calculatePosition.js';\n\n@Component({\n  tag: 'map-tile',\n  shadow: false\n})\nexport class MapTile {\n  @Element() el: HTMLElement;\n\n  // \"Set once\" properties - these are set once at connection and never change\n  @Prop({ reflect: true }) row?: number;\n  @Prop({ reflect: true }) col?: number;\n  @Prop({ reflect: true }) zoom?: number;\n  @Prop({ reflect: true }) src?: string;\n\n  _parentEl: any;\n  _tileLayer: any;\n  _extent: any;\n  \n  // Store initial values to prevent changes after connection\n  private _initialRow: number;\n  private _initialCol: number;\n  private _initialZoom: number;\n  private _hasConnected = false;\n\n  @Watch('src')\n  srcChanged(newValue: string, oldValue: string) {\n    if (oldValue !== newValue) {\n      if (this._extent) this._calculateExtent();\n      if (this._tileLayer) {\n        this._tileLayer.removeMapTile(this.el);\n        this._tileLayer.addMapTile(this.el);\n      }\n    }\n  }\n\n  connectedCallback() {\n    // Capture initial values before anything else - these won't change\n    // Read from attributes first, then fall back to props\n    this._initialRow = this.el.hasAttribute('row') ? +this.el.getAttribute('row') : (this.row ?? 0);\n    this._initialCol = this.el.hasAttribute('col') ? +this.el.getAttribute('col') : (this.col ?? 0);\n    \n    // For zoom, check: explicit attribute -> prop -> map-meta value -> map zoom -> 0\n    let zoomValue = 0;\n    if (this.el.hasAttribute('zoom')) {\n      zoomValue = +this.el.getAttribute('zoom');\n    } else if (this.zoom !== undefined) {\n      zoomValue = this.zoom;\n    } else {\n      // Try to get zoom from map-meta element\n      const metaZoom = this._getMetaZoomValue();\n      if (metaZoom !== null) {\n        zoomValue = metaZoom;\n      } else {\n        zoomValue = this.getMapEl()?.zoom || 0;\n      }\n    }\n    this._initialZoom = zoomValue;\n    this._hasConnected = true;\n    \n    // Override getAttribute/setAttribute on the element to prevent row/col/zoom changes\n    const originalGetAttribute = this.el.getAttribute.bind(this.el);\n    const originalSetAttribute = this.el.setAttribute.bind(this.el);\n    \n    this.el.getAttribute = (name: string) => {\n      if (this._hasConnected) {\n        switch (name) {\n          case 'row':\n            return String(this._initialRow);\n          case 'col':\n            return String(this._initialCol);\n          case 'zoom':\n            return String(this._initialZoom);\n        }\n      }\n      return originalGetAttribute(name);\n    };\n    \n    this.el.setAttribute = (name: string, value: string) => {\n      if (this._hasConnected) {\n        switch (name) {\n          case 'row':\n          case 'col':\n          case 'zoom':\n            return; // Ignore changes to these after connection\n        }\n      }\n      originalSetAttribute(name, value);\n    };\n\n    // Override property accessors on the element to return initial values\n    Object.defineProperties(this.el, {\n      row: {\n        get: () => this._initialRow,\n        configurable: true\n      },\n      col: {\n        get: () => this._initialCol,\n        configurable: true\n      },\n      zoom: {\n        get: () => this._initialZoom,\n        configurable: true\n      }\n    });\n    \n    // Find parent element (handle shadow DOM)\n    const parentNode = this.el.parentNode as HTMLElement;\n    this._parentEl =\n      parentNode.nodeName === 'MAP-LAYER' ||\n      parentNode.nodeName === 'LAYER-' ||\n      parentNode.nodeName === 'MAP-LINK'\n        ? parentNode\n        : (parentNode as any).host;\n\n    // Preload image\n    const imgObj = new Image();\n    imgObj.src = this.src || '';\n\n    this._createOrGetTileLayer();\n  }\n  disconnectedCallback() {\n    if (this._tileLayer) {\n      this._tileLayer.removeMapTile(this.el);\n      if (this._tileLayer._mapTiles && this._tileLayer._mapTiles.length === 0) {\n        this._tileLayer.remove();\n        this._tileLayer = null;\n        delete this._tileLayer;\n\n        const entry = this?._parentEl?._layerRegistry?.get(this.position);\n        if (entry) {\n          entry.count--;\n          if (entry.count === 0) {\n              this._parentEl._layerRegistry.delete(this.position);\n          }\n        }\n      }\n    }\n  }\n\n  // \"Set once\" property pattern for row, col, zoom\n  // After connection, always return the initial values\n  get rowValue() {\n    return this._hasConnected ? this._initialRow : +this.row;\n  }\n  get colValue() {\n    return this._hasConnected ? this._initialCol : +this.col;\n  }\n  get zoomValue() {\n    return this._hasConnected ? this._initialZoom : +this.zoom;\n  }\n\n  get extent() {\n    if (!this._extent) this._calculateExtent();\n    return this._extent;\n  }\n\n  get position() {\n    return calculatePosition(this.el);\n  }\n\n  isFirst() {\n    return !this._parentEl._layerRegistry.has(this.position);\n  }\n\n  getPrevious() {\n    if (this.isFirst()) return null;\n    return this.el.previousElementSibling;\n  }\n\n  @Method()\n  async zoomTo() {\n    const extent = this.extent;\n    const map = this.getMapEl()?._map;\n    if (!extent || !map) return;\n    const xmin = extent.topLeft.pcrs.horizontal,\n      xmax = extent.bottomRight.pcrs.horizontal,\n      ymin = extent.bottomRight.pcrs.vertical,\n      ymax = extent.topLeft.pcrs.vertical,\n      bounds = (window as any).L.bounds((window as any).L.point(xmin, ymin), (window as any).L.point(xmax, ymax)),\n      center = map.options.crs.unproject(bounds.getCenter(true)),\n      maxZoom = extent.zoom.maxZoom,\n      minZoom = extent.zoom.minZoom;\n    map.setView(center, Util.getMaxZoom(bounds, map, minZoom, maxZoom), { animate: false });\n  }\n\n  getMapEl() {\n    return Util.getClosest(this.el, 'gcds-map');\n  }\n\n  getLayerEl() {\n    return Util.getClosest(this.el, 'map-layer,layer-');\n  }\n\n  private _getMetaZoomValue(): number | null {\n    // Look for <map-meta name=\"zoom\" content=\"...value=N...\"> in parent layer\n    const layerEl = this.getLayerEl();\n    if (!layerEl) return null;\n    \n    const metaZoom = layerEl.querySelector('map-meta[name=\"zoom\"][content]');\n    if (!metaZoom) return null;\n    \n    const content = metaZoom.getAttribute('content');\n    if (!content) return null;\n    \n    // Parse content like \"min=1,max=4,value=2\"\n    const valueMatch = content.match(/value=(\\d+)/);\n    if (valueMatch && valueMatch[1]) {\n      return parseInt(valueMatch[1], 10);\n    }\n    \n    return null;\n  }\n\n  getMeta(metaName: string) {\n    const name = metaName.toLowerCase();\n    if (name !== 'cs' && name !== 'zoom' && name !== 'projection') return;\n    const sdMeta = this._parentEl?.shadowRoot?.querySelector(`map-meta[name=${name}][content]`);\n    if (this._parentEl?.nodeName === 'MAP-LINK') {\n      return sdMeta || this._parentEl.parentElement?.getMeta(metaName);\n    } else {\n      return this._parentEl?.src\n        ? this._parentEl.shadowRoot?.querySelector(`map-meta[name=${name}][content]`)\n        : this._parentEl.querySelector(`map-meta[name=${name}][content]`);\n    }\n  }\n\n  private async _createOrGetTileLayer() {\n    if (!this._parentEl?.whenReady) return;\n    await this._parentEl.whenReady();\n    const parentElement = this._parentEl;\n    if (this.isFirst()) {\n\n      this._tileLayer = mapTileLayer({\n        projection: this.getMapEl()?.projection,\n        opacity: 1,\n        pane:\n          parentElement._templatedLayer?.getContainer?.() ||\n          parentElement._layer?.getContainer?.(),\n        zIndex: this.position\n      });\n      this._tileLayer.addMapTile(this.el);\n      if (parentElement._templatedLayer?.addLayer) {\n        parentElement._templatedLayer.addLayer(this._tileLayer);\n      } else {\n        parentElement._layer?.addLayer?.(this._tileLayer);\n      }\n      // Publish _tileLayer on the element for test access\n      (this.el as any)._tileLayer = this._tileLayer;\n      // Add this position to the parent's _layerRegistry with layer reference and count = 1\n      parentElement._layerRegistry.set(this.position, { layer: this._tileLayer, count: 1 });\n    } else {\n      // get the previously registered TileLayer for this position\n      const entry = parentElement._layerRegistry.get(this.position);\n\n      this._tileLayer = entry?.layer;\n      if (entry) {\n        entry.count++;\n      }\n      if (this._tileLayer) {\n        this._tileLayer.addMapTile(this.el);\n        // Publish _tileLayer on the element for test access\n        (this.el as any)._tileLayer = this._tileLayer;\n      }\n    }\n  }\n\n  private _calculateExtent() {\n    const mapEl = this.getMapEl();\n    if (!mapEl || !mapEl._map) return;\n    const map = mapEl._map;\n    const projection = map.options.projection;\n    const tileSize = (window as any).M[projection].options.crs.tile.bounds.max.x;\n    const pixelX = this.colValue * tileSize;\n    const pixelY = this.rowValue * tileSize;\n    const pixelBounds = (window as any).L.bounds(\n      (window as any).L.point(pixelX, pixelY),\n      (window as any).L.point(pixelX + tileSize, pixelY + tileSize)\n    );\n    const pcrsBounds = Util.pixelToPCRSBounds(pixelBounds, this.zoomValue, projection);\n    this._extent = Util._convertAndFormatPCRS(pcrsBounds, map.options.crs, projection);\n    this._extent.zoom = {\n      minZoom: this.zoomValue,\n      maxZoom: this.zoomValue,\n      minNativeZoom: this.zoomValue,\n      maxNativeZoom: this.zoomValue\n    };\n  }\n\n  render() {\n    // This component does not render any visible DOM\n    return null;\n  }\n}\n"]}