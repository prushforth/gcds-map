{"version":3,"file":"map-select.js","sourceRoot":"","sources":["../../../src/components/map-select/map-select.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Prop, Element, Watch, Method } from '@stencil/core';\n\n@Component({\n  tag: 'map-select',\n  shadow: false\n})\nexport class MapSelect {\n  @Element() el: HTMLElement;\n\n  @Prop({ reflect: true }) name?: string;\n\n  selectDetails?: HTMLElement;\n  htmlSelect?: HTMLSelectElement;\n\n  connectedCallback() {\n    this._createLayerControlForSelect();\n    // Publish as lowercase to match MapML source compatibility\n    (this.el as any).selectdetails = this.selectDetails;\n    (this.el as any).htmlselect = this.htmlSelect;\n  }\n\n  disconnectedCallback() {}\n\n  @Watch('name')\n  nameChanged(newValue: string, oldValue: string) {\n    if (oldValue !== newValue) {\n      // handle side effects if needed\n    }\n  }\n\n  private _createLayerControlForSelect() {\n    this.htmlSelect = this.transcribe();\n    const selectdetails = document.createElement('details');\n    selectdetails.className = 'mapml-layer-item-details mapml-control-layers';\n    const selectsummary = document.createElement('summary');\n    const selectSummaryLabel = document.createElement('label');\n    selectSummaryLabel.innerText = this.name || '';\n    if (this.el.hasAttribute('id')) selectSummaryLabel.setAttribute('for', this.el.getAttribute('id'));\n    selectsummary.appendChild(selectSummaryLabel);\n    selectdetails.appendChild(selectsummary);\n    selectdetails.appendChild(this.htmlSelect);\n    this.selectDetails = selectdetails;\n    // Add change event listener to trigger redraw\n    this.htmlSelect.addEventListener('change', () => {\n      (this.el.parentElement as any)?._extentLayer?.redraw?.();\n    });\n  }\n\n  private transcribe(): HTMLSelectElement {\n    const select = document.createElement('select');\n    const elementAttrNames = this.el.getAttributeNames();\n    for (let i = 0; i < elementAttrNames.length; i++) {\n      select.setAttribute(elementAttrNames[i], this.el.getAttribute(elementAttrNames[i])!);\n    }\n    // Use querySelectorAll to get actual DOM children (this.el.children is a FakeNodeList in Stencil)\n    const options = this.el.querySelectorAll('map-option');\n    for (let i = 0; i < options.length; i++) {\n      const option = document.createElement('option');\n      const optionAttrNames = options[i].getAttributeNames();\n      for (let j = 0; j < optionAttrNames.length; j++) {\n        option.setAttribute(optionAttrNames[j], options[i].getAttribute(optionAttrNames[j])!);\n      }\n      option.innerHTML = options[i].innerHTML;\n      select.appendChild(option);\n    }\n    return select;\n  }\n\n  @Method()\n  async whenReady(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      let interval: any, failureTimer: any;\n      if (this.selectDetails) {\n        resolve();\n      } else {\n        const selectElement = this;\n        interval = setInterval(testForSelect, 300, selectElement);\n        failureTimer = setTimeout(selectNotDefined, 10000);\n      }\n      function testForSelect(selectElement: MapSelect) {\n        if (selectElement.selectDetails) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          resolve();\n        } else if (!selectElement.el.isConnected) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          reject('map-select was disconnected while waiting to be ready');\n        }\n      }\n      function selectNotDefined() {\n        clearInterval(interval);\n        clearTimeout(failureTimer);\n        reject('Timeout reached waiting for map-select to be ready');\n      }\n    });\n  }\n\n  render() {\n    // Render the details/summary/select structure\n    return null;\n  }\n}\n"]}