{"version":3,"file":"gcds-map.js","sourceRoot":"","sources":["../../../src/components/gcds-map/gcds-map.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Prop, Element, Watch, Method } from '@stencil/core';\nimport {\n  map,\n  LatLng,\n  control\n} from 'leaflet';\nimport { Util } from '../utils/mapml/Util.js';\nimport { DOMTokenList } from '../utils/mapml/DOMTokenList.js';\nimport { locale, localeFr } from '../../generated/locale.js';\nimport { matchMedia } from '../utils/mapml/elementSupport/viewers/matchMedia.js';\n// TODO: Import Stencil component versions when created\n// import { HTMLLayerElement } from '../map-layer/map-layer.js';\n// import { LayerDashElement } from '../layer-/layer-.js';\n// import { HTMLMapCaptionElement } from '../map-caption/map-caption.js';\n// import { HTMLFeatureElement } from '../map-feature/map-feature.js';\n// import { HTMLExtentElement } from '../map-extent/map-extent.js';\n// import { HTMLInputElement } from '../map-input/map-input.js';\n// import { HTMLSelectElement } from '../map-select/map-select.js';\n// import { HTMLLinkElement } from '../map-link/map-link.js';\n// import { HTMLStyleElement } from '../map-style/map-style.js';\n// import { HTMLWebMapElement } from '../web-map/web-map.js';\n// import { HTMLMapAreaElement } from '../map-area/map-area.js';\n\nimport { layerControl } from '../utils/mapml/control/LayerControl.js';\n// due to Stencil bundling shenanigans, the import here doesn't happen \n// (maybe because it's not actually called anywhere - the attribution control\n// was auto-added and the\n// attribution control doesn't get auto-added \n  // Auto-added via Map.addInitHook\n// import { attributionButton } from '../../utils/mapml/control/AttributionButton.js';\nimport { reloadButton } from '../utils/mapml/control/ReloadButton.js';\nimport { scaleBar } from '../utils/mapml/control/ScaleBar.js';\n\nimport { geolocationButton } from '../utils/mapml/control/GeolocationButton.js';\nimport { fullscreenButton } from '../utils/mapml/control/FullscreenButton.js';\nimport { debugOverlay } from '../utils/mapml/layers/DebugOverlay.js';\nimport { crosshair } from '../utils/mapml/layers/Crosshair.js';\nimport { featureIndexOverlay } from '../utils/mapml/layers/FeatureIndexOverlay.js';\n\n@Component({\n  tag: 'gcds-map',\n  styleUrl: 'gcds-map.css',\n  shadow: true,\n})\nexport class GcdsMap {\n  @Element() el: HTMLElement;\n\n  // Mirror the observedAttributes as Stencil props\n  @Prop({ mutable: true }) lat?: number = 0;\n  @Prop({ mutable: true }) lon?: number = 0;\n  @Prop({ mutable: true }) zoom?: number = 0;\n  @Prop({ reflect: false, mutable: true }) projection?: string = 'OSMTILE';\n  // Note: width/height are NOT Stencil props - they're managed via custom properties and MutationObserver\n  // @Prop() width?: string;\n  // @Prop() height?: string;\n  @Prop({ reflect: true, attribute: 'controls' }) controls: boolean = false;\n  @Prop({ reflect: true }) static?: boolean = false;\n  @Prop({ reflect: true, attribute: 'controlslist' }) _controlslist?: string;\n  @Prop({ mutable: true }) locale?: any;\n\n  _controlsList: DOMTokenList;\n  _source: string;\n  _history: any[] = [];\n  _historyIndex: number = -1;\n  _traversalCall: number | false = false;\n\n  // Private properties that mirror the original (will be set in componentDidLoad)\n  private _map: any;\n  // private locale: any; // TODO: Use when implementing locale support\n  private _container: HTMLElement;\n  private mapCaptionObserver: MutationObserver;\n  // @ts-ignore - Stored for potential cleanup, removed when map is deleted\n  private _featureIndexOverlay: any;\n\n  private _zoomControl: any;\n  private _layerControl: any;\n  private _reloadButton: any;\n  private _fullScreenControl: any;\n  private _geolocationButton: any;\n  private _scaleBar: any;\n  private _isInitialized: boolean = false;\n  private _debug: any;\n  // @ts-ignore \n  private _crosshair: any;\n  private _boundDropHandler: (event: DragEvent) => void;\n  private _boundDragoverHandler: (event: DragEvent) => void;\n\n\n  // see comments below regarding attributeChangedCallback vs. getter/setter\n  // usage.  Effectively, the user of the element must use the property, not\n  // the getAttribute/setAttribute/removeAttribute DOM API, because the latter\n  // calls don't result in the getter/setter being called (so you have to use\n  // the getter/setter directly)\n  @Watch('controls')\n  controlsChanged(newValue: boolean) {\n    // Mirror original controls setter logic\n    if (this._map) {\n      if (newValue) {\n        this._showControls();\n      } else {\n        this._hideControls();\n      }\n    }\n  }\n  @Watch('_controlslist')\n  controlsListChanged(newValue: string) {\n    if (this._controlsList) {\n      this._controlsList.value = newValue;\n      // Re-toggle controls to apply the new controlslist filtering\n      if (this._map) {\n        this._toggleControls();\n      }\n    }\n  }\n\n  get controlsList(): DOMTokenList {\n    return this._controlsList;\n  }\n  set controlsList(value: string | null) {\n    if (this._controlsList && (typeof value === 'string' || value === null)) {\n      if (value) {\n        this.el.setAttribute('controlslist', value);\n      } else {\n        this.el.removeAttribute('controlslist');\n      }\n      // DOMTokenList automatically reflects the attribute change\n      // Re-toggle controls based on new attribute value\n      if (this._map) {\n        this._toggleControls();\n      }\n    }\n  }\n  // Note: width/height watchers removed - handled via MutationObserver instead\n  // since they're not Stencil @Prop() anymore\n  \n  // Note: lat, lon, and zoom are NOT watched because in mapml-viewer, changing these\n  // attributes does not change the map position/zoom. These attributes are only \n  // updated by map events to reflect the current state for external observers.\n  @Watch('projection')\n  async projectionChanged(newValue: string, oldValue: string) {\n    if (newValue && this._map && this._map.options.projection !== newValue) {\n      const reconnectLayers = () => {\n        // save map location and zoom\n        let lat = this.lat;\n        let lon = this.lon;\n        let zoom = this.zoom;\n        // saving the lat, lon and zoom is necessary because Leaflet seems\n        // to try to compensate for the change in the scales for each zoom\n        // level in the crs by changing the zoom level of the map when\n        // you set the map crs. So, we save the current view for use below\n        // when all the layers' reconnections have settled.\n        // leaflet doesn't like this: https://github.com/Leaflet/Leaflet/issues/2553\n        this._map.options.crs = (window as any).M[newValue];\n        this._map.options.projection = newValue;\n        let layersReady: Promise<void>[] = [];\n        this._map.announceMovement?.disable();\n        \n        // Get all map-layer and layer- elements and reconnect them\n        const layers = this.el.querySelectorAll('map-layer,layer-');\n        for (let layer of Array.from(layers)) {\n          (layer as any).removeAttribute('disabled');\n          let reAttach = this.el.removeChild(layer);\n          this.el.appendChild(reAttach);\n          if ((reAttach as any).whenReady) {\n            layersReady.push((reAttach as any).whenReady());\n          }\n        }\n        \n        return Promise.allSettled(layersReady).then(() => {\n          // use the saved map location to ensure it is correct after\n          // changing the map CRS. Specifically affects projection\n          // upgrades, e.g. https://maps4html.org/experiments/custom-projections/BNG/\n          // see leaflet bug: https://github.com/Leaflet/Leaflet/issues/2553\n          // Skip restoration if there's only one layer - link traversal case where layer.zoomTo() should control zoom\n          const layers = (this.el as any).layers;\n          if (layers.length === 1) {\n            const layer = layers[0] as any;\n            if (layer.extent) {\n              this._map.setMinZoom(layer.extent.zoom.minZoom);\n              this._map.setMaxZoom(layer.extent.zoom.maxZoom);\n            }\n          }\n          this.zoomTo(lat, lon, zoom);\n          if ((window as any).M.options.announceMovement) this._map.announceMovement?.enable();\n          // required to delay until map-extent.disabled is correctly set\n          // which happens as a result of map-layer._validateDisabled()\n          // which happens so much we have to delay until the calls are\n          // completed\n          setTimeout(() => {\n            this.el.dispatchEvent(new CustomEvent('map-projectionchange'));\n          }, 0);\n        });\n      };\n\n      const connect = reconnectLayers.bind(this);\n      try {\n        await this.whenProjectionDefined(newValue);\n        await connect();\n        if (this._map && this._map.options.projection !== oldValue) {\n          // this doesn't completely work either\n          this._resetHistory();\n        }\n        if (this._debug) {\n          // Toggle debug twice to refresh it with new projection\n          for (let i = 0; i < 2; i++) this.toggleDebug();\n        }\n      } catch {\n        throw new Error('Undefined projection: ' + newValue);\n      }\n    }\n  }\n  \n  // Note: zoom is NOT watched because in mapml-viewer, changing the zoom attribute\n  // does not change the map zoom. The zoom attribute is only updated by map events\n  // to reflect the current state for external observers.\n  \n  // Note: instead of layers getter here, gcds-map.layers property is exposed via Object.defineProperty in componentDidLoad\n  get extent() {\n    let map = this._map,\n      pcrsBounds = Util.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection\n      );\n    let formattedExtent = Util._convertAndFormatPCRS(\n      pcrsBounds,\n      map.options.crs,\n      this.projection\n    );\n    // get min/max zoom from layers at this moment\n    let minZoom = Infinity,\n      maxZoom = -Infinity;\n    const layers = (this.el as any).layers;\n    for (let i = 0; i < layers.length; i++) {\n      if ((layers[i] as any).extent) {\n        if ((layers[i] as any).extent.zoom.minZoom < minZoom)\n          minZoom = (layers[i] as any).extent.zoom.minZoom;\n        if ((layers[i] as any).extent.zoom.maxZoom > maxZoom)\n          maxZoom = (layers[i] as any).extent.zoom.maxZoom;\n      }\n    }\n\n    formattedExtent.zoom = {\n      minZoom: minZoom !== Infinity ? minZoom : map.getMinZoom(),\n      maxZoom: maxZoom !== -Infinity ? maxZoom : map.getMaxZoom()\n    };\n    return formattedExtent;\n  }\n  \n  // Width and height getters return computed CSS values (not attribute values)\n  // This allows CSS to dominate over HTML attributes, matching mapml-viewer behavior\n  getWidth(): number {\n    return +window.getComputedStyle(this.el).width.replace('px', '');\n  }\n  \n  getHeight(): number {\n    return +window.getComputedStyle(this.el).height.replace('px', '');\n  }\n  \n  @Watch('static')\n  staticChanged() {\n    if (this._map) {\n      this._toggleStatic();\n    }\n  }\n  // Note: Stencil handles constructor automatically, but we can use componentWillLoad for initialization\n  componentWillLoad() {\n    // Mirror the original constructor logic\n    this._source = this.el.outerHTML;\n    // create an array to track the history of the map and the current index\n    this._history = [];\n    this._historyIndex = -1;\n    this._traversalCall = false;\n  }\n  // Mirror the connectedCallback logic in componentDidLoad\n  async connectedCallback() {\n    try {\n      // Sync initial history state to element for MapML controls\n      (this.el as any)._history = this._history;\n      (this.el as any)._historyIndex = this._historyIndex;\n      \n      // Publish width/height getters/setters to match mapml-viewer API\n      // These return computed style (CSS wins over attributes)\n      Object.defineProperty(this.el, 'width', {\n        get: () => {\n          return +window.getComputedStyle(this.el).width.replace('px', '');\n        },\n        set: (val) => {\n          // Set attribute only, don't override CSS with inline styles\n          this.el.setAttribute('width', val);\n        },\n        enumerable: true,\n        configurable: true\n      });\n      \n      Object.defineProperty(this.el, 'height', {\n        get: () => {\n          return +window.getComputedStyle(this.el).height.replace('px', '');\n        },\n        set: (val) => {\n          // Set attribute only, don't override CSS with inline styles  \n          this.el.setAttribute('height', val);\n        },\n        enumerable: true,\n        configurable: true\n      });\n      \n      // Ensure MapML controls are loaded and their init hooks are registered\n      // BEFORE creating any maps. This is critical for proper attribution control.\n      await this._ensureControlsLoaded();\n      \n      await this.whenProjectionDefined(this.projection);\n      this._setLocale();\n      this._initShadowRoot();\n\n      this._controlsList = new DOMTokenList(\n        this.el.getAttribute('controlslist'),\n        this.el,\n        'controlslist',\n        [\n          'noreload',\n          'nofullscreen',\n          'nozoom',\n          'nolayer',\n          'noscale',\n          'geolocation'\n        ]\n      );\n\n      var s = window.getComputedStyle(this.el),\n        wpx = s.width,\n        hpx = s.height,\n        w = this.el.hasAttribute('width')\n          ? this.el.getAttribute('width')\n          : parseInt(wpx.replace('px', '')),\n        h = this.el.hasAttribute('height')\n          ? this.el.getAttribute('height')\n          : parseInt(hpx.replace('px', ''));\n      this._changeWidth(w);\n      this._changeHeight(h);\n\n      this._createMap();\n\n      // Mark as initialized so watchers can now run\n      this._isInitialized = true;\n      \n      // Watch for attribute changes to width/height after initialization\n      // This handles setAttribute() calls which don't trigger custom property setters\n      const attributeObserver = new MutationObserver((mutations) => {\n        mutations.forEach((mutation) => {\n          if (mutation.type === 'attributes' && mutation.attributeName) {\n            const newValue = this.el.getAttribute(mutation.attributeName);\n            if (mutation.attributeName === 'width' && newValue) {\n              this._changeWidth(newValue);\n            } else if (mutation.attributeName === 'height' && newValue) {\n              this._changeHeight(newValue);\n            }\n          }\n        });\n      });\n      \n      attributeObserver.observe(this.el, {\n        attributes: true,\n        attributeFilter: ['width', 'height']\n      });\n      \n      // Store observer for cleanup\n      (this.el as any)._attributeObserver = attributeObserver;\n\n      // https://github.com/Maps4HTML/MapML.js/issues/274\n      this.el.setAttribute('role', 'application');\n      this._toggleStatic();\n\n      /*\n    1. only deletes aria-label when the last (only remaining) map caption is removed\n    2. only deletes aria-label if the aria-label was defined by the map caption element itself\n    */\n\n      let mapcaption = this.el.querySelector('map-caption');\n\n      if (mapcaption !== null) {\n        setTimeout(() => {\n          let ariaupdate = this.el.getAttribute('aria-label');\n\n          if (ariaupdate === mapcaption.innerHTML) {\n            this.mapCaptionObserver = new MutationObserver((_m) => {\n              let mapcaptionupdate = this.el.querySelector('map-caption');\n              if (mapcaptionupdate !== mapcaption) {\n                this.el.removeAttribute('aria-label');\n              }\n            });\n            this.mapCaptionObserver.observe(this.el, {\n              childList: true\n            });\n          }\n        }, 0);\n      }\n    } catch (e) {\n      console.log(e);\n      throw new Error('Error: ' + e);\n    }\n  }\n  _setLocale() {\n    // Priority order (matching mapml-viewer behavior):\n    // 1. :lang(fr) attribute in ancestry (Canadian French context)\n    // 2. :lang(en) attribute in ancestry (Canadian English context)\n    // 3. <map-options> locale in document head (browser/custom locale)\n    \n    if (this.el.closest(':lang(fr)') === this.el) {\n      this.locale = localeFr;\n    } else if (this.el.closest(':lang(en)') === this.el) {\n      this.locale = locale;\n    } else {\n      // Check if there's a <map-options> element in the document head\n      // that was placed there by the browser extension or test harness\n      const mapOptions = document.head.querySelector('map-options');\n      if (mapOptions && mapOptions.textContent) {\n        try {\n          const options = JSON.parse(mapOptions.textContent);\n          if (options.locale) {\n            this.locale = options.locale;\n            return;\n          }\n        } catch (e) {\n          console.warn('Failed to parse map-options:', e);\n        }\n      }\n      \n      // Default to English locale if no other locale specified\n      this.locale = locale;\n    }\n  }\n  _initShadowRoot() {\n\n    let shadowRoot = this.el.shadowRoot;\n    if (shadowRoot.querySelector('[aria-label=\"Interactive map\"]')) return;\n    \n    // Add default :host styles AFTER Stencil's gcds-map.css loads\n    // This ensures proper cascade order and allows _changeWidth/_changeHeight to modify it\n    const ensureHostStyle = () => {\n      // Wait for Stencil's stylesheet to load first\n      if (shadowRoot.styleSheets.length === 0) {\n        requestAnimationFrame(ensureHostStyle);\n        return;\n      }\n      \n      // Now append our :host defaults AFTER the main gcds-map.css\n      let mapDefaultCSS = document.createElement('style');\n      mapDefaultCSS.innerHTML =\n        `:host {` +\n        `all: initial;` +\n        `display: inline-block;` +\n        `background-color: white;` +\n        `height: 150px;` +\n        `width: 300px;` +\n        `contain: layout size;` +\n        `border-width: 2px;` +\n        `border-style: inset;` +\n        `}`;\n      shadowRoot.appendChild(mapDefaultCSS);\n    };\n    \n    ensureHostStyle();\n    \n    this._container = document.createElement('div');\n\n    let output =\n      \"<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output'></output>\";\n    this._container.insertAdjacentHTML('beforeend', output);\n\n    // Make the Leaflet container element programmatically identifiable\n    // (https://github.com/Leaflet/Leaflet/issues/7193).\n    this._container.setAttribute('role', 'region');\n    this._container.setAttribute('aria-label', 'Interactive map');\n    shadowRoot.appendChild(this._container);\n    \n    // Expose _container on DOM element for test access and MapML compatibility\n    (this.el as any)._container = this._container;\n    \n    // Hide all (light DOM) children of the map element (equivalent to hideElementsCSS)\n    let hideElementsCSS = document.createElement('style');\n    hideElementsCSS.innerHTML = `gcds-map > * { display: none!important; }`;\n    this.el.appendChild(hideElementsCSS);\n  }\n  _createMap() {\n    if (!this._map) {\n      this._map = map(this._container, {\n        center: new LatLng(this.lat, this.lon),\n        minZoom: 0,\n        maxZoom: (window as any).M[this.projection].options.resolutions.length - 1,\n        projection: this.projection,\n        query: true,\n        contextMenu: true,\n        announceMovement: true,\n        featureIndex: true,\n        mapEl: this.el,\n        crs: (window as any).M[this.projection],\n        zoom: this.zoom,\n        zoomControl: false\n      } as any);\n\n      // Make map accessible for debugging\n      (this.el as any)._map = this._map;\n      (window as any)._debugMap = this._map;\n      \n      // Expose component history properties on element for MapML control compatibility\n      (this.el as any)._history = this._history;\n      (this.el as any)._historyIndex = this._historyIndex;\n      \n      // Expose controlsList API on element for MapML control compatibility\n      // Follow standard HTML DOMTokenList behavior (like video.controlsList)\n      Object.defineProperty(this.el, 'controlsList', {\n        get: () => this._controlsList,\n        set: (value: string | null) => {\n          // Standard behavior: property assignment updates DOMTokenList value\n          // but does NOT update HTML attribute (unlike component setter)\n          if (this._controlsList && (typeof value === 'string' || value === null)) {\n            this._controlsList.value = value || '';\n            // Trigger control visibility updates without changing HTML attribute\n            if (this._map) {\n              this._toggleControls();\n            }\n          }\n        },\n        configurable: true,\n        enumerable: true\n      });\n      \n      // Expose layers getter on element for MapML control compatibility\n      Object.defineProperty(this.el, 'layers', {\n        get: () => this.el.getElementsByTagName('map-layer'),\n        configurable: true,\n        enumerable: true\n      });\n      \n      // Expose locale property on element for MapML control compatibility\n      Object.defineProperty(this.el, 'locale', {\n        get: () => this.locale,\n        configurable: true,\n        enumerable: true\n      });\n      \n      // Expose extent property on element for MapML compatibility\n      Object.defineProperty(this.el, 'extent', {\n        get: () => this.extent,\n        configurable: true,\n        enumerable: true\n      });\n      \n      // Expose width/height getters that return computed CSS values (not attributes)\n      // This allows CSS to dominate over HTML attributes, matching mapml-viewer behavior\n      Object.defineProperty(this.el, 'width', {\n        get: () => this.getWidth(),\n        set: (val: string) => {\n          // Setter changes the attribute AND applies the change immediately\n          this.el.setAttribute('width', val);\n          if (this._isInitialized) {\n            this._changeWidth(val);\n          }\n        },\n        configurable: true,\n        enumerable: true\n      });\n      \n      Object.defineProperty(this.el, 'height', {\n        get: () => this.getHeight(),\n        set: (val: string) => {\n          // Setter changes the attribute AND applies the change immediately\n          this.el.setAttribute('height', val);\n          if (this._isInitialized) {\n            this._changeHeight(val);\n          }\n        },\n        configurable: true,\n        enumerable: true\n      });\n      \n      // Expose public synchronous methods on element for MapML compatibility\n      Object.defineProperty(this.el, 'zoomTo', {\n        value: (lat: number, lon: number, zoom?: number) => this.zoomTo(lat, lon, zoom),\n        writable: true,\n        configurable: true\n      });\n\n      Object.defineProperty(this.el, 'back', {\n        value: () => this.back(),\n        writable: true,\n        configurable: true\n      });\n\n      Object.defineProperty(this.el, 'forward', {\n        value: () => this.forward(),\n        writable: true,\n        configurable: true\n      });\n\n      Object.defineProperty(this.el, 'reload', {\n        value: () => this.reload(),\n        writable: true,\n        configurable: true\n      });\n\n      Object.defineProperty(this.el, 'toggleDebug', {\n        value: () => this.toggleDebug(),\n        writable: true,\n        configurable: true\n      });\n\n      Object.defineProperty(this.el, 'viewSource', {\n        value: () => this.viewSource(),\n        writable: true,\n        configurable: true\n      });\n\n      // Expose matchMedia method with proper 'this' binding\n      // This ensures 'this' always refers to the custom element when called\n      Object.defineProperty(this.el, 'matchMedia', {\n        value: (...args: any[]) => matchMedia.apply(this.el, args),\n        writable: true,\n        configurable: true\n      });\n\n      // Expose geojson2mapml method\n      Object.defineProperty(this.el, 'geojson2mapml', {\n        value: (json: any, options?: any) => this.geojson2mapml(json, options),\n        writable: true,\n        configurable: true\n      });\n\n      Object.defineProperty(this.el, 'defineCustomProjection', {\n        value: (jsonTemplate: string) => this.defineCustomProjection(jsonTemplate),\n        writable: true,\n        configurable: true\n      });\n\n      // Expose internal methods needed by MapML controls and context menu items\n      (this.el as any)._toggleFullScreen = () => this._toggleFullScreen();\n      (this.el as any)._toggleControls = () => this._toggleControls();\n\n      this._addToHistory();\n      this._createControls();\n      this._toggleControls();\n      this._crosshair = crosshair().addTo(this._map);\n      \n      if ((window as any).M.options.featureIndexOverlayOption)\n        this._featureIndexOverlay = featureIndexOverlay().addTo(this._map);\n      \n      this._setUpEvents();\n    }\n  }\n  \n  disconnectedCallback() {\n    this._removeEvents();\n\n    // Clean up attribute observer\n    if ((this.el as any)._attributeObserver) {\n      (this.el as any)._attributeObserver.disconnect();\n      delete (this.el as any)._attributeObserver;\n    }\n\n    delete this._map;\n    this._deleteControls();\n  }\n  // Helper methods that mirror the original\n  async _ensureControlsLoaded() {\n    // Force MapML control modules to load and register their init hooks\n    // This ensures attribution and other controls work properly\n    try {\n      // needed because attributionButton is auto-added via Map.addInitHook and\n      // if it's not referenced by code, the bundler will omit it automatically\n      await import('../utils/mapml/control/AttributionButton.js');\n      // Load ContextMenu handler to register init hooks\n      await import('../utils/mapml/handlers/ContextMenu.js');\n      await import('../utils/mapml/handlers/AnnounceMovement.js');\n      await import('../utils/mapml/handlers/keyboard.js');\n      // Load FeatureIndex handler to register init hooks for keyboard navigation\n      await import('../utils/mapml/handlers/FeatureIndex.js');\n      // TODO: other controls if needed\n    } catch (error) {\n      console.error('Failed to load MapML controls:', error);\n    }\n  }\n  // Creates All map controls and adds them to the map, when created.\n  _createControls() {\n    let mapSize = this._map.getSize().y,\n      totalSize = 0;\n\n    this._layerControl = layerControl(null, {\n      collapsed: true,\n      mapEl: this.el\n    }).addTo(this._map);\n    this._map.on('movestart', this._layerControl.collapse, this._layerControl);\n    // Expose on element for MapML compatibility\n    (this.el as any)._layerControl = this._layerControl;\n\n    let scaleValue = (window as any).M.options.announceScale;\n\n    if (scaleValue === 'metric') {\n      scaleValue = { metric: true, imperial: false };\n    }\n    if (scaleValue === 'imperial') {\n      scaleValue = { metric: false, imperial: true };\n    }\n\n    if (!this._scaleBar) {\n      this._scaleBar = scaleBar(scaleValue).addTo(this._map);\n      // Expose on element for MapML compatibility\n      (this.el as any)._scaleBar = this._scaleBar;\n    }\n\n    // Only add controls if there is enough top left vertical space\n    if (!this._zoomControl && totalSize + 93 <= mapSize) {\n      totalSize += 93;\n      this._zoomControl = control\n        .zoom({\n          zoomInTitle: this.locale.btnZoomIn,\n          zoomOutTitle: this.locale.btnZoomOut\n        })\n        .addTo(this._map);\n      // Expose on element for MapML compatibility\n      (this.el as any)._zoomControl = this._zoomControl;\n    }\n    if (!this._reloadButton && totalSize + 49 <= mapSize) {\n      totalSize += 49;\n      this._reloadButton = reloadButton().addTo(this._map);\n      // Expose on element for MapML compatibility\n      (this.el as any)._reloadButton = this._reloadButton;\n    }\n    if (!this._fullScreenControl && totalSize + 49 <= mapSize) {\n      totalSize += 49;\n      this._fullScreenControl = fullscreenButton().addTo(this._map);\n      // Expose on element for MapML compatibility\n      (this.el as any)._fullScreenControl = this._fullScreenControl;\n    }\n\n    if (!this._geolocationButton) {\n      this._geolocationButton = geolocationButton().addTo(this._map);\n      // Expose on element for MapML compatibility\n      (this.el as any)._geolocationButton = this._geolocationButton;\n    }\n    \n    // Expose locate method on element for MapML compatibility\n    (this.el as any).locate = this.locate.bind(this);\n  }\n  // Sets controls by hiding/unhiding them based on the map attribute\n  _toggleControls() {\n    if (this.controls === false) {\n      this._hideControls();\n      this._map.contextMenu.toggleContextMenuItem('Controls', 'disabled');\n    } else {\n      this._showControls();\n      this._map.contextMenu.toggleContextMenuItem('Controls', 'enabled');\n    }\n  }\n\n  _hideControls() {\n    this._setControlsVisibility('fullscreen', true);\n    this._setControlsVisibility('layercontrol', true);\n    this._setControlsVisibility('reload', true);\n    this._setControlsVisibility('zoom', true);\n    this._setControlsVisibility('geolocation', true);\n    this._setControlsVisibility('scale', true);\n  }\n  _showControls() {\n    this._setControlsVisibility('fullscreen', false);\n    this._setControlsVisibility('layercontrol', false);\n    this._setControlsVisibility('reload', false);\n    this._setControlsVisibility('zoom', false);\n    this._setControlsVisibility('geolocation', true);\n    this._setControlsVisibility('scale', false);\n\n    // prune the controls shown if necessary\n    // this logic could be embedded in _showControls\n    // but would require being able to iterate the domain of supported tokens\n    // for the controlslist\n    if (this._controlsList) {\n      this._controlsList.forEach((value) => {\n        switch (value.toLowerCase()) {\n          case 'nofullscreen':\n            this._setControlsVisibility('fullscreen', true);\n            break;\n          case 'nolayer':\n            this._setControlsVisibility('layercontrol', true);\n            break;\n          case 'noreload':\n            this._setControlsVisibility('reload', true);\n            break;\n          case 'nozoom':\n            this._setControlsVisibility('zoom', true);\n            break;\n          case 'geolocation':\n            this._setControlsVisibility('geolocation', false);\n            break;\n          case 'noscale':\n            this._setControlsVisibility('scale', true);\n            break;\n        }\n      });\n    }\n    // Hide layer control if no layers (will be uncommented when layer control is implemented)\n    if (this._layerControl && this._layerControl._layers.length === 0) {\n      this._layerControl._container.setAttribute('hidden', '');\n    }\n  }\n  // delete the map controls that are private properties of this custom element\n  _deleteControls() {\n    delete this._layerControl;\n    delete this._zoomControl;\n    delete this._reloadButton;\n    delete this._fullScreenControl;\n    delete this._geolocationButton;\n    delete this._scaleBar;\n  }\n    // Sets the control's visibility AND all its childrens visibility,\n  // for the control element based on the Boolean hide parameter\n  _setControlsVisibility(control, hide) {\n    let container;\n    switch (control) {\n      case 'zoom':\n        if (this._zoomControl) {\n          container = this._zoomControl._container;\n        }\n        break;\n      case 'reload':\n        if (this._reloadButton) {\n          container = this._reloadButton._container;\n        }\n        break;\n      case 'fullscreen':\n        if (this._fullScreenControl) {\n          container = this._fullScreenControl._container;\n        }\n        break;\n      case 'layercontrol':\n        if (this._layerControl) {\n          container = this._layerControl._container;\n        }\n        break;\n      case 'geolocation':\n        if (this._geolocationButton) {\n          container = this._geolocationButton._container;\n        }\n        break;\n      case 'scale':\n        if (this._scaleBar) {\n          container = this._scaleBar._container;\n        }\n        break;\n    }\n    if (container) {\n      if (hide) {\n        // setting the visibility for all the children of the element\n        [...container.children].forEach((childEl) => {\n          childEl.setAttribute('hidden', '');\n        });\n        container.setAttribute('hidden', '');\n      } else {\n        // setting the visibility for all the children of the element\n        [...container.children].forEach((childEl) => {\n          childEl.removeAttribute('hidden');\n        });\n        container.removeAttribute('hidden');\n      }\n    }\n  }  \n  _toggleStatic() {\n    // Mirror the original mapml-viewer _toggleStatic behavior\n    if (this._map) {\n      if (this.static) {\n        this._map.dragging.disable();\n        this._map.touchZoom.disable();\n        this._map.doubleClickZoom.disable();\n        this._map.scrollWheelZoom.disable();\n        this._map.boxZoom.disable();\n        this._map.keyboard.disable();\n        this._zoomControl.disable();\n      } else {\n        this._map.dragging.enable();\n        this._map.touchZoom.enable();\n        this._map.doubleClickZoom.enable();\n        this._map.scrollWheelZoom.enable();\n        this._map.boxZoom.enable();\n        this._map.keyboard.enable();\n        this._zoomControl.enable();\n      }\n    }\n  }\n  _removeEvents() {\n    if (this._map) {\n      this._map.off();\n    }\n    if (this._boundDropHandler) {\n      this.el.removeEventListener('drop', this._boundDropHandler, false);\n    }\n    if (this._boundDragoverHandler) {\n      this.el.removeEventListener('dragover', this._boundDragoverHandler, false);\n    }\n  }\n  _setUpEvents() {\n    // Store bound handlers for cleanup\n    this._boundDropHandler = this._dropHandler.bind(this);\n    this._boundDragoverHandler = this._dragoverHandler.bind(this);\n\n    // Set up drag and drop handlers for layers, geojson, and mapml URLs\n    this.el.addEventListener('drop', this._boundDropHandler, false);\n    this.el.addEventListener('dragover', this._boundDragoverHandler, false);\n\n    // Set up map event handlers to sync with component props\n    this._map.on(\n      'moveend',\n      function () {\n        this._updateMapCenter();\n        this._addToHistory();\n        this.el.dispatchEvent(\n          new CustomEvent('map-moveend', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'zoom',\n      function () {\n        this.el.dispatchEvent(\n          new CustomEvent('map-zoom', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'zoomend',\n      function () {\n        this._updateMapCenter();\n        this.el.dispatchEvent(\n          new CustomEvent('zoomend', { detail: { target: this } })\n        );\n      },\n      this\n    );\n    \n    // Forward geolocation events from Leaflet to custom events\n    this._map.on(\n      'locationfound',\n      function (e: any) {\n        this.el.dispatchEvent(\n          new CustomEvent('maplocationfound', {\n            detail: { latlng: e.latlng, accuracy: e.accuracy }\n          })\n        );\n      },\n      this\n    );\n    this._map.on(\n      'locationerror',\n      function (e: any) {\n        this.el.dispatchEvent(\n          new CustomEvent('maplocationerror', {\n            detail: { message: e.message, code: e.code }\n          })\n        );\n      },\n      this\n    );\n    \n    // Set up zoom bounds management based on layer extents\n    const setMapMinAndMaxZoom = ((e) => {\n      this.whenLayersReady().then(() => {\n        if (e && e.layer._layerEl) {\n          this._map.setMaxZoom(this.extent.zoom.maxZoom);\n          this._map.setMinZoom(this.extent.zoom.minZoom);\n        }\n      });\n    }).bind(this);\n    this.whenLayersReady().then(() => {\n      this._map.setMaxZoom(this.extent.zoom.maxZoom);\n      this._map.setMinZoom(this.extent.zoom.minZoom);\n      this._map.on('layeradd layerremove', setMapMinAndMaxZoom, this);\n    });\n\n    // Handle Ctrl+V paste for layers, links and geojson\n    this.el.addEventListener('keydown', (e: KeyboardEvent) => {\n      if (e.keyCode === 86 && e.ctrlKey) {\n        navigator.clipboard.readText().then((layer) => {\n          Util._pasteLayer(this.el, layer);\n        });\n      } else if (\n        e.keyCode === 32 &&\n        this.el.shadowRoot.activeElement?.nodeName !== 'INPUT'\n      ) {\n        // Prevent default spacebar event on map\n        e.preventDefault();\n        this._map.fire('keypress', { originalEvent: e });\n      }\n    });\n  }\n\n  _dropHandler(event: DragEvent) {\n    event.preventDefault();\n    let text = event.dataTransfer.getData('text');\n    Util._pasteLayer(this.el, text);\n  }\n\n  _dragoverHandler(event: DragEvent) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = 'copy';\n  }\n\n  /**\n   * Toggle debug overlay on the map\n   */\n  toggleDebug() {\n    if (this._debug) {\n      this._debug.remove();\n      this._debug = undefined;\n    } else {\n      this._debug = debugOverlay().addTo(this._map);\n    }\n  }\n\n  locate(options?: any) {\n    //options: https://leafletjs.com/reference.html#locate-options\n    if (this._geolocationButton) {\n      this._geolocationButton.stop();\n    }\n    if (options) {\n      if (options.zoomTo) {\n        options.setView = options.zoomTo;\n        delete options.zoomTo;\n      }\n      this._map.locate(options);\n    } else {\n      this._map.locate({ setView: true, maxZoom: 16 });\n    }\n  }\n\n  _changeWidth(width: number | string) {\n    // Match mapml-viewer: modify the :host CSS rule, not inline styles\n    // This allows light DOM CSS to override the shadow DOM default\n    if (this._container) {\n      this._container.style.width = width + 'px';\n      // Modify the :host rule (always LAST stylesheet, first rule)\n      const sheets = this.el.shadowRoot.styleSheets;\n      if (sheets.length > 0) {\n        (sheets[sheets.length - 1].cssRules[0] as CSSStyleRule).style.width = width + 'px';\n      }\n    }\n    if (this._map) {\n      this._map.invalidateSize(false);\n    }\n  }\n\n  _changeHeight(height: number | string) {\n    // Match mapml-viewer: modify the :host CSS rule, not inline styles\n    // This allows light DOM CSS to override the shadow DOM default\n    if (this._container) {\n      this._container.style.height = height + 'px';\n      // Modify the :host rule (always LAST stylesheet, first rule)\n      const sheets = this.el.shadowRoot.styleSheets;\n      if (sheets.length > 0) {\n        (sheets[sheets.length - 1].cssRules[0] as CSSStyleRule).style.height = height + 'px';\n      }\n    }\n    if (this._map) {\n      this._map.invalidateSize(false);\n    }\n  }\n  \n  _updateMapCenter() {\n    // Update component props to match map state and sync to DOM attributes\n    // Note: Stencil mutable props don't automatically reflect changes back to DOM attributes\n    if (this._map) {\n      const center = this._map.getCenter();\n      this.lat = center.lat;\n      this.lon = center.lng;\n      this.zoom = this._map.getZoom();\n      \n      // Manually sync the props back to DOM attributes\n      this.el.setAttribute('lat', this.lat.toString());\n      this.el.setAttribute('lon', this.lon.toString());\n      this.el.setAttribute('zoom', this.zoom.toString());\n    }\n  }\n  _resetHistory() {\n    this._history = [];\n    this._historyIndex = -1;\n    this._traversalCall = false;\n    // weird but ok (original comment)\n    this._addToHistory();\n  }\n  _addToHistory() {\n    // this._traversalCall tracks how many consecutive moveends to ignore from history\n    // Check if we should ignore this moveend event due to programmatic navigation\n    if (this._traversalCall && this._traversalCall > 0) {\n      this._traversalCall--;\n      return; // Don't add to history during back/forward/reload operations\n    }\n\n    let mapLocation = this._map.getPixelBounds().getCenter();\n    let location = {\n      zoom: this._map.getZoom(),\n      x: mapLocation.x,\n      y: mapLocation.y\n    };\n    \n    this._historyIndex++;\n    this._history.splice(this._historyIndex, 0, location);\n    \n    // Remove future history when adding new location while in middle of history\n    if (this._historyIndex + 1 !== this._history.length) {\n      this._history.length = this._historyIndex + 1;\n    }\n    // Update context menu button states based on history position\n    this._updateNavigationControls();\n    \n    // Sync updated history properties to element for MapML controls\n    (this.el as any)._history = this._history;\n    (this.el as any)._historyIndex = this._historyIndex;\n  }\n\n  private _updateNavigationControls() {\n    // Centralize navigation control state management\n    const canGoBack = this._historyIndex > 0;\n    const canGoForward = this._historyIndex < this._history.length - 1;\n    const canReload = this._historyIndex > 0;\n    \n    // Update context menu items\n    this._map.contextMenu.toggleContextMenuItem('Back', canGoBack ? 'enabled' : 'disabled');\n    this._map.contextMenu.toggleContextMenuItem('Forward', canGoForward ? 'enabled' : 'disabled');\n    this._map.contextMenu.toggleContextMenuItem('Reload', canReload ? 'enabled' : 'disabled');\n    \n    // Update reload button\n    if (canReload) {\n      this._reloadButton?.enable();  \n    } else {\n      this._reloadButton?.disable();\n    }\n  }\n\n  /**\n   * Navigate back in map history\n   */\n  back() {\n    if (this._historyIndex <= 0) return;\n    \n    let curr = this._history[this._historyIndex];\n    this._historyIndex--;\n    let prev = this._history[this._historyIndex];\n    \n    // Set traversal call count based on operations needed\n    if (prev.zoom !== curr.zoom) {\n      this._traversalCall = 2; // panBy + setZoom\n      let currScale = this._map.options.crs.scale(curr.zoom);\n      let prevScale = this._map.options.crs.scale(prev.zoom);\n      let scale = currScale / prevScale;\n      this._map.panBy([prev.x * scale - curr.x, prev.y * scale - curr.y], { animate: false });\n      this._map.setZoom(prev.zoom);\n    } else {\n      this._traversalCall = 1; // panBy only\n      this._map.panBy([prev.x - curr.x, prev.y - curr.y]);\n    }\n    \n    // Update controls immediately (don't wait for moveend)\n    this._updateNavigationControls();\n    \n    // Sync to element\n    (this.el as any)._historyIndex = this._historyIndex;\n  }\n\n  /**\n   * Allows user to move forward in history\n   */\n  forward() {\n    let history = this._history;\n    let curr = history[this._historyIndex];\n    \n    if (this._historyIndex < history.length - 1) {\n      this._map.contextMenu.toggleContextMenuItem('Back', 'enabled');\n      this._historyIndex++;\n      let next = history[this._historyIndex];\n      \n      // Disable forward contextmenu item when at the end of history\n      if (this._historyIndex === history.length - 1) {\n        this._map.contextMenu.toggleContextMenuItem('Forward', 'disabled');\n      }\n\n      if (next.zoom !== curr.zoom) {\n        this._traversalCall = 2;\n        let currScale = this._map.options.crs.scale(curr.zoom);\n        let nextScale = this._map.options.crs.scale(next.zoom);\n        let scale = currScale / nextScale;\n        this._map.panBy([next.x * scale - curr.x, next.y * scale - curr.y], { animate: false });\n        this._map.setZoom(next.zoom);\n      } else {\n        this._traversalCall = 1;\n        this._map.panBy([next.x - curr.x, next.y - curr.y]);\n      }\n      \n      // Update controls immediately (don't wait for moveend)\n      this._updateNavigationControls();\n      \n      // Sync to element\n      (this.el as any)._historyIndex = this._historyIndex;\n    }\n  }\n\n  /**\n   * Allows the user to reload/reset the map's location to its initial location\n   * and reset the history to the initial state\n   */\n  reload() {\n    if (this._history.length === 0) return;\n    \n    let initialLocation = this._history[0]; // Get initial location\n    let curr = {\n      zoom: this._map.getZoom(),\n      x: this._map.getPixelBounds().getCenter().x,\n      y: this._map.getPixelBounds().getCenter().y\n    };\n    \n    // Reset history completely - this is the key change\n    this._history = [initialLocation]; // Keep only the initial location\n    this._historyIndex = 0;             // Set to the only remaining entry\n  \n    // Set traversal call count based on operations needed\n    if (initialLocation.zoom !== curr.zoom) {\n      this._traversalCall = 2; // panBy + setZoom\n      let currScale = this._map.options.crs.scale(curr.zoom);\n      let initScale = this._map.options.crs.scale(initialLocation.zoom);\n      let scale = currScale / initScale;\n      this._map.panBy([initialLocation.x * scale - curr.x, initialLocation.y * scale - curr.y], { animate: false });\n      this._map.setZoom(initialLocation.zoom);\n    } else {\n      this._traversalCall = 1; // panBy only\n      this._map.panBy([initialLocation.x - curr.x, initialLocation.y - curr.y]);\n    }\n    \n    // Update controls immediately - now with reset history state\n    this._updateNavigationControls();\n    \n    // Sync reset history to element\n    (this.el as any)._history = this._history;\n    (this.el as any)._historyIndex = this._historyIndex;\n    \n    this._map.getContainer().focus();\n  }\n\n  /**\n   * Internal method to toggle fullscreen (used by MapML context menu)\n   */\n  private _toggleFullScreen() {\n    this._map.toggleFullscreen();\n  }\n\n  /**\n   * Open the map source in a new window\n   */\n  viewSource() {\n    let blob = new Blob([this._source], { type: 'text/plain' }),\n      url = URL.createObjectURL(blob);\n    window.open(url);\n    URL.revokeObjectURL(url);\n  }\n\n  /**\n   * Zoom the map to a specific location and zoom level\n   * @param lat - Latitude coordinate\n   * @param lon - Longitude coordinate \n   * @param zoom - Zoom level (optional, defaults to current zoom)\n   */\n  zoomTo(lat: number, lon: number, zoom?: number): void {\n    // Ensure map is initialized before attempting to zoom\n    if (!this._map) {\n      console.warn('Map is not initialized. Cannot zoom to location.');\n      return;\n    }\n    \n    // Convert zoom to number if provided, otherwise use current zoom\n    const targetZoom = (zoom !== undefined && Number.isInteger(+zoom)) ? +zoom : this.zoom;\n    \n    // Create LatLng object for the target location\n    const location = new LatLng(+lat, +lon);\n    \n    // Set the map view to the new location and zoom\n    this._map.setView(location, targetZoom);\n    \n    // Update the component properties to reflect the new state\n    // This matches the behavior in the original mapml-viewer.js\n    // this.zoom = targetZoom;\n    // this.lat = location.lat;\n    // this.lon = location.lng;\n\n    // The moveend event will fire automatically and:\n    // 1. Call _updateMapCenter() to sync lat/lon/zoom props\n    // 2. Call _addToHistory() to update the history stack\n    // 3. Update context menu button states\n  }\n  @Method()\n  async whenProjectionDefined(projection: string) {\n    // Mirror the original whenProjectionDefined logic\n    return new Promise((resolve, reject) => {\n      if ((window as any).M[projection]) {\n        resolve((window as any).M[projection]);\n      } else {\n        reject(new Error('Projection ' + projection + ' is not defined'));\n      }\n    });\n  }\n  defineCustomProjection(jsonTemplate) {\n    // Delegate to the global M.defineCustomProjection API\n    if ((window as any).M && (window as any).M.defineCustomProjection) {\n      (window as any).M.defineCustomProjection(jsonTemplate);\n      const t = JSON.parse(jsonTemplate);\n      return t.projection;\n    } else {\n      throw new Error('MapML API not loaded');\n    }\n  }\n  /**\n   * Promise-based method to wait until map is ready\n   * Returns a promise that resolves when the map is fully initialized\n   */\n  @Method()\n  async whenReady(): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      let interval: any, failureTimer: any;\n      if ((this.el as any)._map) {\n        resolve();\n      } else {\n        let viewer = this.el as any;\n        interval = setInterval(testForMap, 200, viewer);\n        failureTimer = setTimeout(mapNotDefined, 5000);\n      }\n      \n      function testForMap(viewer: any) {\n        if (viewer._map) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          resolve();\n        }\n      }\n      \n      function mapNotDefined() {\n        clearInterval(interval);\n        clearTimeout(failureTimer);\n        reject('Timeout reached waiting for map to be ready');\n      }\n    });\n  }\n\n  /**\n   * Promise-based method to wait until all layers are ready\n   * Returns a promise that resolves when all child layers are fully initialized\n   */\n  @Method()\n  async whenLayersReady(): Promise<PromiseSettledResult<void>[]> {\n    let layersReady: Promise<void>[] = [];\n    \n    // Get all map-layer child elements\n    const layers = this.el.querySelectorAll('map-layer');\n    for (let i = 0; i < layers.length; i++) {\n      const layer = layers[i];\n      if ((layer as any).whenReady) {\n        layersReady.push((layer as any).whenReady());\n      }\n    }\n    \n    return Promise.allSettled(layersReady);\n  }\n\n  /**\n   * Convert GeoJSON to MapML and append as a layer\n   * @param json - GeoJSON object (FeatureCollection, Feature, or Geometry)\n   * @param options - Conversion options:\n   *   - label: Layer label (defaults to json.name, json.title, or locale default)\n   *   - projection: Target projection (defaults to map's projection)\n   *   - caption: Feature caption property name or function\n   *   - properties: Custom properties handling (function, string, or HTMLElement)\n   *   - geometryFunction: Custom geometry processing function\n   * @returns The created map-layer element\n   */\n  geojson2mapml(json: any, options: any = {}): HTMLElement {\n    // Use current map projection if not specified\n    if (options.projection === undefined) {\n      options.projection = this.projection;\n    }\n    \n    // Call Util.geojson2mapml to create the layer element\n    let geojsonLayer = Util.geojson2mapml(json, options);\n    \n    // Append the layer to the map\n    this.el.appendChild(geojsonLayer);\n    \n    return geojsonLayer;\n  }\n\n  render() {\n    return null;\n  }\n}\n"]}