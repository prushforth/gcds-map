{"version":3,"file":"map-feature.js","sourceRoot":"","sources":["../../../src/components/map-feature/map-feature.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Prop, Watch, Method } from '@stencil/core';\nimport { bounds, point, extend } from 'leaflet';\n\nimport { MapFeatureLayer } from '../utils/mapml/layers/MapFeatureLayer.js';\nimport { featureRenderer } from '../utils/mapml/features/featureRenderer.js';\nimport { Util } from '../utils/mapml/Util.js';\nimport proj4 from 'proj4';\nimport { calculatePosition } from '../utils/mapml/elementSupport/layers/calculatePosition.js';\n\ndeclare const M: any;\n\n@Component({\n  tag: 'map-feature',\n  shadow: true\n})\nexport class MapFeature {\n  @Element() el: HTMLElement;\n\n  @Prop({ reflect: false, mutable: true }) zoom?: number;\n  @Prop({ reflect: true, mutable: true }) min?: number;\n  @Prop({ reflect: true, mutable: true }) max?: number;\n\n  _featureLayer: any;\n  _geometry: any;\n  _groupEl: any;\n  _observer: MutationObserver;\n  _parentEl: any;\n  _initialZoom: number;\n  _getFeatureExtent: any;\n\n  @Watch('zoom')\n  zoomChanged(newValue: number, oldValue: number) {\n    if (oldValue !== newValue && this._featureLayer) {\n      this.reRender(this._featureLayer);\n    }\n  }\n\n  @Watch('min')\n  minChanged(newValue: number, oldValue: number) {\n    if (oldValue !== newValue && this._featureLayer) {\n      this.reRender(this._featureLayer);\n    }\n  }\n\n  @Watch('max')\n  maxChanged(newValue: number, oldValue: number) {\n    if (oldValue !== newValue && this._featureLayer) {\n      this.reRender(this._featureLayer);\n    }\n  }\n\n  get zoomValue(): number {\n    // for templated or queried features ** native zoom is only used for zoomTo() **\n    let meta = {},\n      metaEl = this.getMeta('zoom');\n    if (metaEl)\n      meta = Util._metaContentToObject(metaEl.getAttribute('content'));\n    if (this._parentEl?.nodeName === 'MAP-LINK') {\n      // nativeZoom = zoom attribute || (sd.map-meta zoom 'value'  || 'max') || this._initialZoom\n      return +(this.el.hasAttribute('zoom')\n        ? this.el.getAttribute('zoom')\n        : meta['value']\n        ? meta['value']\n        : meta['max']\n        ? meta['max']\n        : this._initialZoom ?? this.getMapEl()?.zoom ?? 0);\n    } else {\n      // for \"static\" features\n      // nativeZoom zoom attribute || this._initialZoom\n      return +(this.el.hasAttribute('zoom')\n        ? this.el.getAttribute('zoom')\n        : this._initialZoom ?? this.getMapEl()?.zoom ?? 0);\n    }\n  }\n\n  get minValue(): number {\n    // for templated or queried features\n    let meta = {},\n      metaEl = this.getMeta('zoom');\n    if (metaEl)\n      meta = Util._metaContentToObject(metaEl.getAttribute('content'));\n    let projectionMinZoom = 0;\n    if (this._parentEl?.nodeName === 'MAP-LINK') {\n      // minZoom = min attribute || sd.map-meta min zoom || map-link minZoom\n      return +(this.el.hasAttribute('min')\n        ? this.el.getAttribute('min')\n        : meta['min']\n        ? meta['min']\n        : this._parentEl.getZoomBounds().minZoom);\n    } else {\n      // for \"static\" features\n      // minZoom = min attribute || map-meta zoom || projection minZoom\n      return +(this.el.hasAttribute('min')\n        ? this.el.getAttribute('min')\n        : meta['min']\n        ? meta['min']\n        : projectionMinZoom);\n    }\n  }\n\n  get maxValue(): number {\n    // for templated or queried features\n    let meta = {},\n      metaEl = this.getMeta('zoom');\n    if (metaEl)\n      meta = Util._metaContentToObject(metaEl.getAttribute('content'));\n    let projectionMaxZoom =\n      this.getMapEl()?._map?.options.crs.options.resolutions.length - 1;\n    if (this._parentEl?.nodeName === 'MAP-LINK') {\n      // maxZoom = max attribute || sd.map-meta max zoom || map-link maxZoom\n      return +(this.el.hasAttribute('max')\n        ? this.el.getAttribute('max')\n        : meta['max']\n        ? meta['max']\n        : this._parentEl.getZoomBounds().maxZoom);\n    } else {\n      // for \"static\" features\n      // maxZoom = max attribute || map-meta zoom max || projection maxZoom\n      return +(this.el.hasAttribute('max')\n        ? this.el.getAttribute('max')\n        : meta['max']\n        ? meta['max']\n        : projectionMaxZoom);\n    }\n  }\n\n  get extent() {\n    if (this.el.isConnected) {\n      // if the feature extent is the first time to be calculated or the feature extent is changed\n      if (!this._getFeatureExtent) {\n        this._getFeatureExtent = this._memoizeExtent();\n      }\n      return this._getFeatureExtent();\n    }\n  }\n\n  get position() {\n    return calculatePosition(this.el);\n  }\n\n  getMapEl() {\n    return Util.getClosest(this.el, 'gcds-map');\n  }\n\n  getLayerEl() {\n    return Util.getClosest(this.el, 'map-layer,layer-');\n  }\n\n  async connectedCallback() {\n    // set the initial zoom of the map when features connected\n    // used for fallback zoom getter for static features\n    this._initialZoom = this.getMapEl()?.zoom;\n    this._parentEl =\n      this.el.parentNode?.nodeName === 'MAP-LAYER' ||\n      this.el.parentNode?.nodeName === 'LAYER-' ||\n      this.el.parentNode?.nodeName === 'MAP-LINK'\n        ? this.el.parentNode\n        : (this.el.parentNode as any)?.host;\n\n    if (\n      this.getLayerEl()?.hasAttribute('data-moving') ||\n      this._parentEl?.parentElement?.hasAttribute('data-moving')\n    )\n      return;\n\n    // Publish MapML compatibility methods on element\n    (this.el as any).getMapEl = this.getMapEl.bind(this);\n    (this.el as any).getLayerEl = this.getLayerEl.bind(this);\n    (this.el as any).zoomTo = this.zoomTo.bind(this);\n    (this.el as any).getZoomToZoom = this.getZoomToZoom.bind(this);\n    (this.el as any).click = this.click.bind(this);\n    (this.el as any).focus = this.focus.bind(this);\n    (this.el as any).blur = this.blur.bind(this);\n    (this.el as any).mapml2geojson = this.mapml2geojson.bind(this);\n    (this.el as any).addFeature = this.addFeature.bind(this);\n    (this.el as any).removeFeature = this.removeFeature.bind(this);\n    (this.el as any).reRender = this.reRender.bind(this);\n\n    Object.defineProperty(this.el, 'zoom', {\n        get: () => this.zoomValue,\n        configurable: true,\n        enumerable: true\n    });\n\n    Object.defineProperty(this.el, 'extent', {\n      get: () => this.extent,\n      configurable: true,\n      enumerable: true\n    });\n\n    Object.defineProperty(this.el, 'position', {\n      get: () => this.position,\n      configurable: true,\n      enumerable: true\n    });\n\n    // Note: zoom, min, max are already exposed as @Prop with reflect: true\n    // so they don't need Object.defineProperty - they're already accessible on the element\n\n    if (\n      this._parentEl?.nodeName === 'MAP-LAYER' ||\n      this._parentEl?.nodeName === 'LAYER-' ||\n      this._parentEl?.nodeName === 'MAP-LINK'\n    ) {\n      this._createOrGetFeatureLayer();\n    }\n\n    // Expose properties on DOM element for MapML compatibility\n    Object.defineProperty(this.el, '_featureLayer', {\n      get: () => this._featureLayer,\n      configurable: true,\n      enumerable: true\n    });\n\n    Object.defineProperty(this.el, '_geometry', {\n      get: () => this._geometry,\n      configurable: true,\n      enumerable: true\n    });\n    // use observer to monitor the changes in mapFeature's subtree\n    this._observer = new MutationObserver((mutationList) => {\n      for (let mutation of mutationList) {\n        // the attributes changes of <map-feature> element should be handled by watchers\n        if (mutation.type === 'attributes' && mutation.target === this.el) {\n          return;\n        }\n        // re-render feature if there is any observed change\n        this.reRender(this._featureLayer);\n      }\n    });\n    this._observer.observe(this.el, {\n      childList: true,\n      subtree: true,\n      attributes: true,\n      attributeOldValue: true,\n      characterData: true\n    });\n  }\n\n  disconnectedCallback() {\n    if (\n      this.getLayerEl()?.hasAttribute('data-moving') ||\n      this._parentEl?.parentElement?.hasAttribute('data-moving')\n    )\n      return;\n    this._observer?.disconnect();\n    if (this._featureLayer) {\n      this.removeFeature(this._featureLayer);\n      // If this was the last feature in the layer, clean up the layer\n      if (this._featureLayer.getLayers().length === 0) {\n        if (this._featureLayer.options.renderer) {\n          // manually remove the shared renderer\n          this._featureLayer.options.renderer.remove();\n        }\n        this._featureLayer.remove();\n        this._featureLayer = null;\n        delete this._featureLayer;\n      }\n    }\n    // Clean up the layer registry if not data-moving\n    const entry = this?._parentEl?._layerRegistry?.get(this.position);\n    if (entry) {\n      entry.count--;\n      if (entry.count === 0) {\n        this._parentEl._layerRegistry.delete(this.position);\n      }\n    }\n  }\n\n  reRender(layerToRenderOn: any) {\n    if (this._groupEl?.isConnected) {\n      let fallbackCS = this._getFallbackCS();\n      let placeholder = document.createElement('span');\n      this._groupEl.insertAdjacentElement('beforebegin', placeholder);\n      if (layerToRenderOn._staticFeature) {\n        layerToRenderOn._removeFromFeaturesList(this._geometry);\n      }\n      layerToRenderOn.removeLayer(this._geometry);\n      // Garbage collection needed\n      this._geometry = layerToRenderOn\n        .createGeometry(this.el, fallbackCS)\n        .addTo(layerToRenderOn);\n      // createGeometry sets _groupEl on the DOM element as a side effect\n      this._groupEl = (this.el as any)._groupEl;\n      placeholder.replaceWith(this._geometry.options.group);\n      layerToRenderOn._validateRendering();\n      delete this._getFeatureExtent;\n      this._setUpEvents();\n    }\n  }\n\n  removeFeature(layerToRemoveFrom: any) {\n    layerToRemoveFrom.removeLayer(this._geometry);\n    if (layerToRemoveFrom._staticFeature) {\n      layerToRemoveFrom._removeFromFeaturesList(this._geometry);\n    }\n    layerToRemoveFrom.options.properties = null;\n    delete this._geometry;\n    if (this._getFeatureExtent) delete this._getFeatureExtent;\n  }\n\n  addFeature(layerToAddTo: any) {\n    this._featureLayer = layerToAddTo;\n    if (!this.el.querySelector('map-geometry')) return;\n    let fallbackCS = this._getFallbackCS();\n    this._geometry = layerToAddTo.createGeometry(this.el, fallbackCS);\n    if (!this._geometry) return;\n    // createGeometry sets _groupEl on the DOM element as a side effect\n    this._groupEl = (this.el as any)._groupEl;\n    this._geometry._layerEl = this.getLayerEl();\n    layerToAddTo.addLayer(this._geometry);\n    this._setUpEvents();\n  }\n\n\n  getPrevious(): any {\n    if (this.isFirst()) {\n      return null;\n    }\n    return this.el.previousElementSibling;\n  }\n\n  isFirst(): boolean {\n    return !this._parentEl._layerRegistry.has(this.position);\n  }\n\n  _createOrGetFeatureLayer() {\n    // Wait for parent layer to be ready before proceeding\n    this._parentEl\n      .whenReady()\n      .then(() => {\n        // Detect parent context and get the appropriate layer container\n        const isMapLink = this._parentEl.nodeName === 'MAP-LINK';\n        const parentLayer = isMapLink\n          ? this._parentEl._templatedLayer\n          : this._parentEl._layer;\n\n        const parentElement = this._parentEl;\n        if (this.isFirst() && parentLayer) {\n\n          let map = parentElement.getMapEl()._map;\n\n          this._featureLayer = new MapFeatureLayer(null, {\n            renderer: featureRenderer(),\n            pane: parentLayer.getContainer(),\n            ...(isMapLink && parentElement.getBounds()\n              ? { layerBounds: parentElement.getBounds() }\n              : {}),\n            ...(isMapLink ? { zoomBounds: this._getZoomBounds() } : {}),\n            ...(isMapLink ? {} : { _leafletLayer: parentElement._layer }),\n            zIndex: this.position,\n            projection: map.options.projection,\n            mapEl: parentElement.getMapEl(),\n            onEachFeature: function (properties: any, geometry: any) {\n              if (properties) {\n                const popupOptions = {\n                  autoClose: false,\n                  autoPan: true,\n                  maxHeight: map.getSize().y * 0.5 - 50,\n                  maxWidth: map.getSize().x * 0.7,\n                  minWidth: 165\n                };\n                var c = document.createElement('div');\n                c.classList.add('mapml-popup-content');\n                c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n                geometry.bindPopup(c, popupOptions);\n              }\n            }\n          });\n\n          extend(this._featureLayer.options, {\n            _leafletLayer: Object.assign(this._featureLayer, {\n              _layerEl: this.getLayerEl()\n            })\n          });\n\n          // Add this position to the parent's _layerRegistry with layer reference and count = 1\n          parentElement._layerRegistry.set(this.position, { layer: this._featureLayer, count: 1 });\n\n          this.addFeature(this._featureLayer);\n\n          // add MapFeatureLayer to appropriate parent layer\n          parentLayer.addLayer(this._featureLayer);\n        } else {\n          // get the previously registered FeatureLayer for this position\n          const entry = parentElement._layerRegistry.get(this.position);\n          this._featureLayer = entry?.layer;\n          if (entry) {\n            entry.count++;\n          }\n          \n          if (this._featureLayer) {\n            this.addFeature(this._featureLayer);\n          }\n        }\n      })\n      .catch((error: any) => {\n        console.log('Error waiting for parent layer to be ready:', error);\n      });\n  }\n\n  _setUpEvents() {\n    ['click', 'focus', 'blur', 'keyup', 'keydown'].forEach((name) => {\n      this._groupEl.addEventListener(name, (e: Event) => {\n        if (name === 'click') {\n          let clickEv = new PointerEvent(name, { cancelable: true });\n          (clickEv as any).originalEvent = e;\n          this.el.dispatchEvent(clickEv);\n        } else if (name === 'keyup' || name === 'keydown') {\n          let keyEv = new KeyboardEvent(name, { cancelable: true });\n          (keyEv as any).originalEvent = e;\n          this.el.dispatchEvent(keyEv);\n        } else {\n          let focusEv = new FocusEvent(name, { cancelable: true });\n          (focusEv as any).originalEvent = e;\n          this.el.dispatchEvent(focusEv);\n        }\n      });\n    });\n  }\n\n  _getFallbackCS(): string {\n    let csMeta;\n    if (this._parentEl?.nodeName === 'MAP-LINK') {\n      csMeta =\n        this._parentEl.shadowRoot?.querySelector('map-meta[name=cs][content]') ||\n        (this._parentEl.parentElement as any)?.getMeta?.('cs');\n    } else {\n      let layerEl = this.getLayerEl();\n      csMeta = layerEl?.src\n        ? layerEl.shadowRoot?.querySelector('map-meta[name=cs][content]')\n        : layerEl?.querySelector('map-meta[name=cs][content]');\n    }\n    return csMeta\n      ? Util._metaContentToObject(csMeta.getAttribute('content')).content\n      : 'gcrs';\n  }\n\n  _memoizeExtent() {\n    let extentCache: any;\n    return () => {\n      if (extentCache && this._getFeatureExtent) {\n        return extentCache;\n      } else {\n        // calculate feature extent\n        let map = this.getMapEl()._map,\n          geometry = this.el.querySelector('map-geometry'),\n          cs = geometry?.getAttribute('cs') || this._getFallbackCS(),\n          zoom = this.zoomValue,\n          shapes = geometry?.querySelectorAll(\n            'map-point, map-linestring, map-polygon, map-multipoint, map-multilinestring'\n          ),\n          bboxExtent = [\n            Infinity,\n            Infinity,\n            Number.NEGATIVE_INFINITY,\n            Number.NEGATIVE_INFINITY\n          ];\n        \n        if (shapes) {\n          for (let shape of Array.from(shapes)) {\n            let coord = shape.querySelectorAll('map-coordinates');\n            for (let i = 0; i < coord.length; ++i) {\n              bboxExtent = this._updateExtent(shape, coord[i], bboxExtent);\n            }\n          }\n        }\n        \n        let topLeft = point(bboxExtent[0], bboxExtent[1]);\n        let bottomRight = point(bboxExtent[2], bboxExtent[3]);\n        let pcrsBound = Util.boundsToPCRSBounds(\n          bounds(topLeft, bottomRight),\n          zoom,\n          map.options.projection,\n          cs\n        );\n        \n        if (\n          shapes?.length === 1 &&\n          shapes[0].tagName.toUpperCase() === 'MAP-POINT'\n        ) {\n          let projection = map.options.projection,\n            maxZoom = this.el.hasAttribute('max')\n              ? +this.el.getAttribute('max')\n              : M[projection].options.resolutions.length - 1,\n            tileCenter = M[projection].options.crs.tile.bounds.getCenter(),\n            pixel = M[projection].transformation.transform(\n              pcrsBound.min,\n              M[projection].scale(+this.zoomValue || maxZoom)\n            );\n          pcrsBound = Util.pixelToPCRSBounds(\n            bounds(pixel.subtract(tileCenter), pixel.add(tileCenter)),\n            this.zoomValue || maxZoom,\n            projection\n          );\n        }\n        \n        let result = Object.assign(\n          Util._convertAndFormatPCRS(\n            pcrsBound,\n            map.options.crs,\n            map.options.projection\n          ),\n          { zoom: this._getZoomBounds() }\n        );\n        extentCache = result;\n        return result;\n      }\n    };\n  }\n\n  _updateExtent(shape: Element, coord: Element, bboxExtent: number[]): number[] {\n    let data = coord.innerHTML\n      .trim()\n      .replace(/<[^>]+>/g, '')\n      .replace(/\\s+/g, ' ')\n      .split(/[<>\\ ]/g);\n    switch (shape.tagName.toUpperCase()) {\n      case 'MAP-POINT':\n        bboxExtent = Util._updateExtent(bboxExtent, +data[0], +data[1]);\n        break;\n      case 'MAP-LINESTRING':\n      case 'MAP-POLYGON':\n      case 'MAP-MULTIPOINT':\n      case 'MAP-MULTILINESTRING':\n        for (let i = 0; i < data.length; i += 2) {\n          bboxExtent = Util._updateExtent(bboxExtent, +data[i], +data[i + 1]);\n        }\n        break;\n      default:\n        break;\n    }\n    return bboxExtent;\n  }\n\n  _getZoomBounds() {\n    return {\n      minZoom: this.minValue,\n      maxZoom: this.maxValue,\n      minNativeZoom: this.zoomValue,\n      maxNativeZoom: this.zoomValue\n    };\n  }\n\n  getZoomToZoom(): number {\n    let tL = this.extent.topLeft.pcrs,\n      bR = this.extent.bottomRight.pcrs,\n      bound = bounds(\n        point(tL.horizontal, tL.vertical),\n        point(bR.horizontal, bR.vertical)\n      );\n    let projection = this.getMapEl()._map.options.projection,\n      layerZoomBounds = this.getLayerEl().extent.zoom,\n      minZoom = layerZoomBounds.minZoom ? layerZoomBounds.minZoom : 0,\n      maxZoom = layerZoomBounds.maxZoom\n        ? layerZoomBounds.maxZoom\n        : M[projection].options.resolutions.length - 1;\n    let newZoom;\n    if (this.el.hasAttribute('zoom')) {\n      newZoom = this.zoomValue;\n    } else {\n      newZoom = Util.getMaxZoom(bound, this.getMapEl()._map, minZoom, maxZoom);\n      if (this.maxValue < newZoom) {\n        newZoom = this.maxValue;\n      } else if (this.minValue > newZoom) {\n        newZoom = this.minValue;\n      }\n    }\n    if (newZoom < minZoom) {\n      newZoom = minZoom;\n    } else if (newZoom > maxZoom) {\n      newZoom = maxZoom;\n    }\n    return newZoom;\n  }\n\n  getMeta(metaName: string): Element | null {\n    let name = metaName.toLowerCase();\n    if (name !== 'cs' && name !== 'zoom' && name !== 'projection') return null;\n    let sdMeta = this._parentEl?.shadowRoot?.querySelector(\n      `map-meta[name=${name}][content]`\n    );\n    if (this._parentEl?.nodeName === 'MAP-LINK') {\n      return sdMeta || (this._parentEl.parentElement as any)?.getMeta?.(metaName);\n    } else {\n      return this._parentEl?.src\n        ? this._parentEl.shadowRoot?.querySelector(\n            `map-meta[name=${name}][content]`\n          )\n        : this._parentEl?.querySelector(`map-meta[name=${name}][content]`);\n    }\n  }\n\n  mapml2geojson(options?: any): any {\n    let defaults = {\n      propertyFunction: null,\n      transform: true\n    };\n    options = Object.assign({}, defaults, options);\n\n    let json: any = {\n      type: 'Feature',\n      properties: {},\n      geometry: {}\n    };\n    \n    let el = this.el.querySelector('map-properties');\n    if (!el) {\n      json.properties = null;\n    } else if (typeof options.propertyFunction === 'function') {\n      json.properties = options.propertyFunction(el);\n    } else if (el.querySelector('table')) {\n      let table = el.querySelector('table').cloneNode(true);\n      json.properties = Util._table2properties(table as HTMLTableElement);\n    } else {\n      json.properties = {\n        prop0: el.innerHTML.replace(/(<([^>]+)>)/gi, '').replace(/\\s/g, '')\n      };\n    }\n\n    let source = null,\n      dest = null,\n      map = this.getMapEl()._map;\n    if (options.transform) {\n      source = new proj4.Proj(map.options.crs.code);\n      dest = new proj4.Proj('EPSG:4326');\n      if (\n        map.options.crs.code === 'EPSG:3857' ||\n        map.options.crs.code === 'EPSG:4326'\n      ) {\n        options.transform = false;\n      }\n    }\n\n    let collection = this.el.querySelector('map-geometry')?.querySelector(\n        'map-geometrycollection'\n      ),\n      shapes = this.el.querySelector('map-geometry')?.querySelectorAll(\n        'map-point, map-polygon, map-linestring, map-multipoint, map-multipolygon, map-multilinestring'\n      );\n\n    if (collection) {\n      json.geometry.type = 'GeometryCollection';\n      json.geometry.geometries = [];\n      if (shapes) {\n        for (let shape of Array.from(shapes)) {\n          json.geometry.geometries.push(\n            Util._geometry2geojson(shape, source, dest, options.transform)\n          );\n        }\n      }\n    } else if (shapes && shapes.length > 0) {\n      json.geometry = Util._geometry2geojson(\n        shapes[0],\n        source,\n        dest,\n        options.transform\n      );\n    }\n    return json;\n  }\n\n  click() {\n    let g = this._groupEl,\n      rect = g.getBoundingClientRect();\n    let event = new MouseEvent('click', {\n      clientX: rect.x + rect.width / 2,\n      clientY: rect.y + rect.height / 2,\n      button: 0\n    });\n    let properties = this.el.querySelector('map-properties');\n    if (g.getAttribute('role') === 'link') {\n      for (let path of g.children) {\n        (path as any).mousedown?.call(this._geometry, event);\n        (path as any).mouseup?.call(this._geometry, event);\n      }\n    }\n    let clickEv = new PointerEvent('click', { cancelable: true });\n    (clickEv as any).originalEvent = event;\n    this.el.dispatchEvent(clickEv);\n    if (properties && this.el.isConnected) {\n      let geometry = this._geometry,\n        shapes = geometry._layers;\n      for (let id in shapes) {\n        if (shapes[id].isPopupOpen()) {\n          shapes[id].closePopup();\n        }\n      }\n      if (geometry.isPopupOpen()) {\n        geometry.closePopup();\n      } else if (!(clickEv as any).originalEvent.cancelBubble) {\n        geometry.openPopup();\n      }\n    }\n  }\n\n  focus(options?: FocusOptions) {\n    this._groupEl?.focus(options);\n  }\n\n  blur() {\n    if (\n      document.activeElement?.shadowRoot?.activeElement === this._groupEl ||\n      (document.activeElement?.shadowRoot?.activeElement as any)?.parentNode ===\n        this._groupEl\n    ) {\n      this._groupEl.blur();\n      this.getMapEl()?._map?.getContainer().focus();\n    }\n  }\n\n  zoomTo() {\n    let extent = this.extent,\n      map = this.getMapEl()._map;\n    let tL = extent.topLeft.pcrs,\n      bR = extent.bottomRight.pcrs,\n      bound = bounds(\n        point(tL.horizontal, tL.vertical),\n        point(bR.horizontal, bR.vertical)\n      ),\n      center = map.options.crs.unproject(bound.getCenter(true));\n    map.setView(center, this.getZoomToZoom(), { animate: false });\n  }\n\n  @Method()\n  async whenReady(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      let interval: any, failureTimer: any;\n      // Check if addFeature has been published (indicating connectedCallback completed)\n      if ((this.el as any).addFeature) {\n        resolve();\n      } else {\n        let featureElement = this.el;\n        interval = setInterval(testForFeature, 200, featureElement);\n        failureTimer = setTimeout(featureNotDefined, 5000);\n      }\n      function testForFeature(featureElement: HTMLElement) {\n        if ((featureElement as any).addFeature) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          resolve();\n        }\n      }\n      function featureNotDefined() {\n        clearInterval(interval);\n        clearTimeout(failureTimer);\n        reject('Timeout reached waiting for feature to be ready');\n      }\n    });\n  }\n\n  render() {\n    return null;\n  }\n}\n"]}