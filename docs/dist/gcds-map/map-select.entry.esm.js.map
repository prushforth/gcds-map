{"version":3,"file":"map-select.entry.esm.js","sources":["src/components/map-select/map-select.tsx"],"sourcesContent":["import { Component, Prop, Element, Watch, Method } from '@stencil/core';\n\n@Component({\n  tag: 'map-select',\n  shadow: false\n})\nexport class MapSelect {\n  @Element() el: HTMLElement;\n\n  @Prop({ reflect: true }) name?: string;\n\n  selectDetails?: HTMLElement;\n  htmlSelect?: HTMLSelectElement;\n\n  connectedCallback() {\n    this._createLayerControlForSelect();\n    // Publish as lowercase to match MapML source compatibility\n    (this.el as any).selectdetails = this.selectDetails;\n    (this.el as any).htmlselect = this.htmlSelect;\n  }\n\n  disconnectedCallback() {}\n\n  @Watch('name')\n  nameChanged(newValue: string, oldValue: string) {\n    if (oldValue !== newValue) {\n      // handle side effects if needed\n    }\n  }\n\n  private _createLayerControlForSelect() {\n    this.htmlSelect = this.transcribe();\n    const selectdetails = document.createElement('details');\n    selectdetails.className = 'mapml-layer-item-details mapml-control-layers';\n    const selectsummary = document.createElement('summary');\n    const selectSummaryLabel = document.createElement('label');\n    selectSummaryLabel.innerText = this.name || '';\n    if (this.el.hasAttribute('id')) selectSummaryLabel.setAttribute('for', this.el.getAttribute('id'));\n    selectsummary.appendChild(selectSummaryLabel);\n    selectdetails.appendChild(selectsummary);\n    selectdetails.appendChild(this.htmlSelect);\n    this.selectDetails = selectdetails;\n    // Add change event listener to trigger redraw\n    this.htmlSelect.addEventListener('change', () => {\n      (this.el.parentElement as any)?._extentLayer?.redraw?.();\n    });\n  }\n\n  private transcribe(): HTMLSelectElement {\n    const select = document.createElement('select');\n    const elementAttrNames = this.el.getAttributeNames();\n    for (let i = 0; i < elementAttrNames.length; i++) {\n      select.setAttribute(elementAttrNames[i], this.el.getAttribute(elementAttrNames[i])!);\n    }\n    // Use querySelectorAll to get actual DOM children (this.el.children is a FakeNodeList in Stencil)\n    const options = this.el.querySelectorAll('map-option');\n    for (let i = 0; i < options.length; i++) {\n      const option = document.createElement('option');\n      const optionAttrNames = options[i].getAttributeNames();\n      for (let j = 0; j < optionAttrNames.length; j++) {\n        option.setAttribute(optionAttrNames[j], options[i].getAttribute(optionAttrNames[j])!);\n      }\n      option.innerHTML = options[i].innerHTML;\n      select.appendChild(option);\n    }\n    return select;\n  }\n\n  @Method()\n  async whenReady(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      let interval: any, failureTimer: any;\n      if (this.selectDetails) {\n        resolve();\n      } else {\n        const selectElement = this;\n        interval = setInterval(testForSelect, 300, selectElement);\n        failureTimer = setTimeout(selectNotDefined, 10000);\n      }\n      function testForSelect(selectElement: MapSelect) {\n        if (selectElement.selectDetails) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          resolve();\n        } else if (!selectElement.el.isConnected) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          reject('map-select was disconnected while waiting to be ready');\n        }\n      }\n      function selectNotDefined() {\n        clearInterval(interval);\n        clearTimeout(failureTimer);\n        reject('Timeout reached waiting for map-select to be ready');\n      }\n    });\n  }\n\n  render() {\n    // Render the details/summary/select structure\n    return null;\n  }\n}\n"],"names":[],"mappings":"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"}