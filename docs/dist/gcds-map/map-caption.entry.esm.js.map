{"version":3,"file":"map-caption.entry.esm.js","sources":["src/components/map-caption/map-caption.tsx"],"sourcesContent":["import { Component, Element } from '@stencil/core';\n\n/* \nimplemented for both mapml-viewer and web-map; however web-map does not focus on map element in the browser resulting in NVDA \nnot being able to read out map-caption and stating that it's an interactive map region\n*/\n@Component({\n  tag: 'map-caption',\n  shadow: false\n})\nexport class MapCaption {\n  @Element() el: HTMLElement;\n\n  observer: MutationObserver;\n\n  connectedCallback() {\n    if (\n      this.el.parentElement.nodeName === 'GCDS-MAP'\n    ) {\n      // Wait a tick for Stencil to finish rendering/hydrating the element's content\n      setTimeout(() => {\n        // Only the first map-caption child should manage the aria-label\n        const firstMapCaption = this.el.parentElement.querySelector('map-caption');\n        const isFirstCaption = firstMapCaption === (this.el as any);\n        \n        if (!isFirstCaption) {\n          // Not the first caption, don't set up observer or aria-label\n          return;\n        }\n        \n        // calls MutationObserver; needed to observe changes to content between <map-caption> tags and update to aria-label\n        let mapcaption = this.el.innerText;\n\n        this.observer = new MutationObserver(() => {\n          let mapcaptionupdate = this.el.innerText;\n\n          if (mapcaptionupdate !== mapcaption) {\n            this.el.parentElement.setAttribute('aria-label', mapcaptionupdate);\n            mapcaption = mapcaptionupdate;\n          }\n        });\n\n        this.observer.observe(this.el, {\n          characterData: true,\n          subtree: true,\n          attributes: true,\n          childList: true\n        });\n\n        // don't change aria-label if one already exists from user  (checks when element is first created)\n        if (!this.el.parentElement.hasAttribute('aria-label')) {\n          const ariaLabel = this.el.innerText;\n          this.el.parentElement.setAttribute('aria-label', ariaLabel);\n        }\n      }, 0);\n    }\n  }\n\n  disconnectedCallback() {\n    if (this.observer) {\n      this.observer.disconnect();\n    }\n  }\n\n  render() {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;MAUa,UAAU,GAAA,MAAA;;;;;AAGrB,IAAA,QAAQ;IAER,iBAAiB,GAAA;QACf,IACE,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,QAAQ,KAAK,UAAU,EAC7C;;YAEA,UAAU,CAAC,MAAK;;AAEd,gBAAA,MAAM,eAAe,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,aAAa,CAAC,aAAa,CAAC;AAC1E,gBAAA,MAAM,cAAc,GAAG,eAAe,KAAM,IAAI,CAAC,EAAU;gBAE3D,IAAI,CAAC,cAAc,EAAE;;oBAEnB;;;AAIF,gBAAA,IAAI,UAAU,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS;AAElC,gBAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,gBAAgB,CAAC,MAAK;AACxC,oBAAA,IAAI,gBAAgB,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS;AAExC,oBAAA,IAAI,gBAAgB,KAAK,UAAU,EAAE;wBACnC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,YAAY,EAAE,gBAAgB,CAAC;wBAClE,UAAU,GAAG,gBAAgB;;AAEjC,iBAAC,CAAC;gBAEF,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE;AAC7B,oBAAA,aAAa,EAAE,IAAI;AACnB,oBAAA,OAAO,EAAE,IAAI;AACb,oBAAA,UAAU,EAAE,IAAI;AAChB,oBAAA,SAAS,EAAE;AACZ,iBAAA,CAAC;;AAGF,gBAAA,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,YAAY,CAAC,EAAE;AACrD,oBAAA,MAAM,SAAS,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS;oBACnC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,YAAY,EAAE,SAAS,CAAC;;aAE9D,EAAE,CAAC,CAAC;;;IAIT,oBAAoB,GAAA;AAClB,QAAA,IAAI,IAAI,CAAC,QAAQ,EAAE;AACjB,YAAA,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE;;;IAI9B,MAAM,GAAA;AACJ,QAAA,OAAO,IAAI;;;;;;"}