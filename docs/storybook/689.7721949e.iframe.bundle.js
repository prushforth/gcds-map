"use strict";(self.webpackChunkgcds_map=self.webpackChunkgcds_map||[]).push([[689],{"./dist/esm/map-input.entry.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{map_input:()=>MapInput});var _index_PZrWUcjo_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./dist/esm/index-PZrWUcjo.js");class ZoomInput{name;min;max;value;step;layer;constructor(name,min,max,value,step,layer){this.name=name,this.min=min,this.max=max,this.value=value,this.step=step,this.layer=layer}validateInput(){return!!this.name}getValue(){return this.layer._map.options.mapEl.zoom}}class HiddenInput{name;value;constructor(name,value){this.name=name,this.value=value}validateInput(){return!(!this.name||!this.value)}getValue(){return this.value}}class WidthInput{name;layer;constructor(name,layer){this.name=name,this.layer=layer}validateInput(){return!!this.name}getValue(){return this.layer._map.getSize().x}}class HeightInput{name;layer;constructor(name,layer){this.name=name,this.layer=layer}validateInput(){return!!this.name}getValue(){return this.layer._map.getSize().y}}class LocationInput{name;position;axis;units;min;max;rel;layer;constructor(name,position,axis,units,min,max,rel,layer){this.name=name,this.position=position,this.axis=axis,units||!axis||["i","j"].includes(axis)?this.units=units:this.units=_index_PZrWUcjo_js__WEBPACK_IMPORTED_MODULE_0__.U.axisToCS(axis).toLowerCase(),this.min=min,this.max=max,this.rel=rel,this.layer=layer}validateInput(){if(!this.name||!this.axis)return!1;if(("i"===this.axis||"j"===this.axis)&&!["map","tile"].includes(this.units))return!1;if(this.units){let axisCS=_index_PZrWUcjo_js__WEBPACK_IMPORTED_MODULE_0__.U.axisToCS(this.axis);if("string"==typeof axisCS&&axisCS.toUpperCase()!==this.units.toUpperCase())return!1}return!0}_TCRSToPCRS(coords,zoom){const crs=this.layer._map.options.crs;return crs.transformation.untransform(coords,crs.scale(zoom))}getValue(zoom,bounds){if(void 0===zoom&&(zoom=this.layer._map.getZoom()),void 0===bounds&&(bounds=this.layer._map.getPixelBounds()),"pcrs"===this.units||"gcrs"===this.units)switch(this.axis){case"longitude":case"easting":if(!this.position)return this._TCRSToPCRS(bounds.min,zoom).x;if(this.position.match(/.*?-left/i))return this._TCRSToPCRS(bounds.min,zoom).x;if(this.position.match(/.*?-right/i))return this._TCRSToPCRS(bounds.max,zoom).x;break;case"latitude":case"northing":if(!this.position)return this._TCRSToPCRS(bounds.min,zoom).y;if(this.position.match(/top-.*?/i))return this._TCRSToPCRS(bounds.min,zoom).y;if(this.position.match(/bottom-.*?/i))return this._TCRSToPCRS(bounds.max,zoom).y}else if("tilematrix"===this.units){const center=this.layer._map.getCenter(),templatedTileLayer=this.layer._extentLayer._templates[0].layer,pixelBounds=templatedTileLayer._getTiledPixelBounds(center),tileRange=templatedTileLayer._pxBoundsToTileRange(pixelBounds),obj=[];for(let j=tileRange.min.y;j<=tileRange.max.y;j++)for(let i=tileRange.min.x;i<=tileRange.max.x;i++){const coords=new _index_PZrWUcjo_js__WEBPACK_IMPORTED_MODULE_0__.l.Point(i,j);coords.z=templatedTileLayer._tileZoom,obj.push(coords)}return obj}}}const MapInput=class{constructor(hostRef){(0,_index_PZrWUcjo_js__WEBPACK_IMPORTED_MODULE_0__.r)(this,hostRef)}get el(){return(0,_index_PZrWUcjo_js__WEBPACK_IMPORTED_MODULE_0__.a)(this)}name;type;value;axis;units;position;rel;min;max;step;input;_layer;initialValue;getMapEl(){return _index_PZrWUcjo_js__WEBPACK_IMPORTED_MODULE_0__.U.getClosest(this.el,"gcds-map")}getLayerEl(){return _index_PZrWUcjo_js__WEBPACK_IMPORTED_MODULE_0__.U.getClosest(this.el,"map-layer,layer-")}async connectedCallback(){try{switch(this.el.getMapEl=this.getMapEl.bind(this),this.el.getLayerEl=this.getLayerEl.bind(this),this.type){case"zoom":this.initialValue=+this.el.getAttribute("value"),this.el.initialValue=this.initialValue,this.input=new ZoomInput(this.name,this.min,this.max,this.initialValue,this.step,this._layer);break;case"location":this.input=new LocationInput(this.name,this.position,this.axis,this.units,this.min,this.max,this.rel,this._layer);break;case"width":this.input=new WidthInput(this.name,this._layer);break;case"height":this.input=new HeightInput(this.name,this._layer);break;case"hidden":this.input=new HiddenInput(this.name,this.value)}}catch(reason){console.log(reason,"\nin mapInput.connectedCallback")}}disconnectedCallback(){}checkValidity(){if(this.input?.validateInput())return!0;{const evt=new Event("invalid",{bubbles:!0,cancelable:!0,composed:!0});return this.el.dispatchEvent(evt),!1}}reportValidity(){if(this.input?.validateInput())return!0;{const evt=new Event("invalid",{bubbles:!0,cancelable:!0,composed:!0});return this.el.dispatchEvent(evt),console.log("Input type='"+this.type+"' is not valid!"),!1}}async whenReady(){return new Promise((resolve,reject)=>{let interval,failureTimer;if(this.input)return void resolve();interval=setInterval(function testForInput(inputElement){inputElement.input?(clearInterval(interval),clearTimeout(failureTimer),resolve()):inputElement.el.isConnected||(clearInterval(interval),clearTimeout(failureTimer),reject("map-input was disconnected while waiting to be ready"))},300,this),failureTimer=setTimeout(function inputNotDefined(){clearInterval(interval),clearTimeout(failureTimer),reject("Timeout reached waiting for input to be ready")},1e4)})}render(){return null}}}}]);