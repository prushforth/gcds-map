import{U as t,l as e,r as i,a as s}from"./p-PZrWUcjo.js";class r{name;min;max;value;step;layer;constructor(t,e,i,s,r,n){this.name=t;this.min=e;this.max=i;this.value=s;this.step=r;this.layer=n}validateInput(){if(!this.name){return false}return true}getValue(){return this.layer._map.options.mapEl.zoom}}class n{name;value;constructor(t,e){this.name=t;this.value=e}validateInput(){if(!this.name||!this.value){return false}return true}getValue(){return this.value}}class a{name;layer;constructor(t,e){this.name=t;this.layer=e}validateInput(){if(!this.name){return false}return true}getValue(){return this.layer._map.getSize().x}}class h{name;layer;constructor(t,e){this.name=t;this.layer=e}validateInput(){if(!this.name){return false}return true}getValue(){return this.layer._map.getSize().y}}class l{name;position;axis;units;min;max;rel;layer;constructor(e,i,s,r,n,a,h,l){this.name=e;this.position=i;this.axis=s;if(!r&&s&&!["i","j"].includes(s)){this.units=t.axisToCS(s).toLowerCase()}else{this.units=r}this.min=n;this.max=a;this.rel=h;this.layer=l}validateInput(){if(!this.name||!this.axis){return false}if((this.axis==="i"||this.axis==="j")&&!["map","tile"].includes(this.units)){return false}if(this.units){let e=t.axisToCS(this.axis);if(typeof e==="string"&&e.toUpperCase()!==this.units.toUpperCase()){return false}}return true}_TCRSToPCRS(t,e){const i=this.layer._map;const s=i.options.crs;const r=s.transformation.untransform(t,s.scale(e));return r}getValue(t,i){if(t===undefined)t=this.layer._map.getZoom();if(i===undefined)i=this.layer._map.getPixelBounds();if(this.units==="pcrs"||this.units==="gcrs"){switch(this.axis){case"longitude":case"easting":if(this.position){if(this.position.match(/.*?-left/i)){return this._TCRSToPCRS(i.min,t).x}else if(this.position.match(/.*?-right/i)){return this._TCRSToPCRS(i.max,t).x}}else{return this._TCRSToPCRS(i.min,t).x}break;case"latitude":case"northing":if(this.position){if(this.position.match(/top-.*?/i)){return this._TCRSToPCRS(i.min,t).y}else if(this.position.match(/bottom-.*?/i)){return this._TCRSToPCRS(i.max,t).y}}else{return this._TCRSToPCRS(i.min,t).y}break}}else if(this.units==="tilematrix"){const t=this.layer._map.getCenter();const i=this.layer._extentLayer._templates[0].layer;const s=i._getTiledPixelBounds(t);const r=i._pxBoundsToTileRange(s);const n=[];for(let t=r.min.y;t<=r.max.y;t++){for(let s=r.min.x;s<=r.max.x;s++){const r=new e.Point(s,t);r.z=i._tileZoom;n.push(r)}}return n}else;return}}const u=class{constructor(t){i(this,t)}get el(){return s(this)}name;type;value;axis;units;position;rel;min;max;step;input;_layer;initialValue;getMapEl(){return t.getClosest(this.el,"gcds-map")}getLayerEl(){return t.getClosest(this.el,"map-layer,layer-")}async connectedCallback(){try{this.el.getMapEl=this.getMapEl.bind(this);this.el.getLayerEl=this.getLayerEl.bind(this);switch(this.type){case"zoom":this.initialValue=+this.el.getAttribute("value");this.el.initialValue=this.initialValue;this.input=new r(this.name,this.min,this.max,this.initialValue,this.step,this._layer);break;case"location":this.input=new l(this.name,this.position,this.axis,this.units,this.min,this.max,this.rel,this._layer);break;case"width":this.input=new a(this.name,this._layer);break;case"height":this.input=new h(this.name,this._layer);break;case"hidden":this.input=new n(this.name,this.value);break}}catch(t){console.log(t,"\nin mapInput.connectedCallback")}}disconnectedCallback(){}checkValidity(){if(this.input?.validateInput()){return true}else{const t=new Event("invalid",{bubbles:true,cancelable:true,composed:true});this.el.dispatchEvent(t);return false}}reportValidity(){if(this.input?.validateInput()){return true}else{const t=new Event("invalid",{bubbles:true,cancelable:true,composed:true});this.el.dispatchEvent(t);console.log("Input type='"+this.type+"' is not valid!");return false}}async whenReady(){return new Promise(((t,e)=>{let i,s;if(this.input){t();return}const r=this;i=setInterval(n,300,r);s=setTimeout(a,1e4);function n(r){if(r.input){clearInterval(i);clearTimeout(s);t()}else if(!r.el.isConnected){clearInterval(i);clearTimeout(s);e("map-input was disconnected while waiting to be ready")}}function a(){clearInterval(i);clearTimeout(s);e("Timeout reached waiting for input to be ready")}}))}render(){return null}};export{u as map_input};
//# sourceMappingURL=p-da19e118.entry.js.map