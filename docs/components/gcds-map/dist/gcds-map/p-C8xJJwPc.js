import{l as t,U as i}from"./p-PZrWUcjo.js";var s=t.GridLayer.extend({initialize:function(i){t.GridLayer.prototype.initialize.call(this,i);this._mapTiles=i.mapTiles||[];this._tileMap={};this._pendingTiles={};this._buildTileMap();this._container=t.DomUtil.create("div","leaflet-layer");if(i.zIndex){this._container.style.zIndex=i.zIndex}t.DomUtil.addClass(this._container,"mapml-static-tile-container")},getEvents:function(){const i=t.GridLayer.prototype.getEvents?t.GridLayer.prototype.getEvents.call(this):{};i.zoomend=this._handleZoomChange;return i},onAdd:function(i){this.options.pane.appendChild(this._container);t.GridLayer.prototype.onAdd.call(this,i)},onRemove:function(i){this._pendingTiles={};t.DomUtil.remove(this._container)},setZIndex:function(t){this.options.zIndex=t;this._updateZIndex();return this},_updateZIndex:function(){if(this._container&&this.options.zIndex!==undefined&&this.options.zIndex!==null){this._container.style.zIndex=this.options.zIndex}},_handleZoomChange:function(){const t=this._map.getZoom();for(const i in this._tiles){const s=this._keyToTileCoords(i);if(s.z!==t){this._removeTile(i)}}},addMapTile:function(t){if(!this._mapTiles.includes(t)){this._mapTiles.push(t);this._addToTileMap(t);this._updateBounds();if(this._map){this.redraw()}}},removeMapTile:function(t){const i=this._mapTiles.indexOf(t);if(i!==-1){this._mapTiles.splice(i,1);this._removeFromTileMap(t);this._updateBounds();if(this._map){this.redraw()}}},removeMapTileAt:function(t,i){const s=this._mapTiles.indexOf(t);if(s!==-1){this._mapTiles.splice(s,1);this._removeFromTileMapAt(i);if(t._tileDiv){t._tileDiv._mapTile=null;t._tileDiv=null}this._updateBounds();if(this._map){this.redraw()}}},isVisible:function(){if(!this._map)return false;if(!this.layerBounds)this._updateBounds();let t=this._map,s=t.getZoom(),n=this.zoomBounds,o=this.layerBounds,e=s<=n.maxZoom&&s>=n.minZoom;return e&&this._mapTiles&&o&&o.overlaps(i.pixelToPCRSBounds(t.getPixelBounds(),s,t.options.projection))},createTile:function(i,s){const n=this._tileCoordsToKey(i);const o=this.getTileSize();const e=document.createElement("div");e.setAttribute("col",i.x);e.setAttribute("row",i.y);e.setAttribute("zoom",i.z);t.DomUtil.addClass(e,"leaflet-tile");e.style.width=o.x+"px";e.style.height=o.y+"px";const h=this._tileMap[n];if(h){const i=document.createElement("img");i.src=h.src;i.width=o.x;i.height=o.y;i.alt="";i.setAttribute("role","presentation");e._mapTile=h;h._tileDiv=e;e.appendChild(i);t.DomUtil.addClass(e,"leaflet-tile-loaded");s(null,e)}else{if(!this._pendingTiles){this._pendingTiles={}}this._pendingTiles[n]={element:e,done:s}}return e},_buildTileMap:function(){this._tileMap={};for(const t of this._mapTiles){this._addToTileMap(t)}},_addToTileMap:function(i){const s=`${i.col}:${i.row}:${i.zoom}`;this._tileMap[s]=i;if(this._pendingTiles&&this._pendingTiles[s]){const n=this._pendingTiles[s];const o=n.element;const e=n.done;const h=this.getTileSize();const f=document.createElement("img");f.src=i.src;f.width=h.x;f.height=h.y;f.alt="";f.setAttribute("role","presentation");o._mapTile=i;i._tileDiv=o;o.appendChild(f);t.DomUtil.addClass(o,"leaflet-tile-loaded");if(e){e(null,o)}delete this._pendingTiles[s]}},_removeFromTileMap:function(t){const i=`${t.col}:${t.row}:${t.zoom}`;delete this._tileMap[i];if(t._tileDiv){t._tileDiv._mapTile=null;t._tileDiv=null}if(this._pendingTiles&&this._pendingTiles[i]){delete this._pendingTiles[i]}},_removeFromTileMapAt:function(t){const i=`${t.col}:${t.row}:${t.zoom}`;delete this._tileMap[i];if(this._pendingTiles&&this._pendingTiles[i]){delete this._pendingTiles[i]}},_updateBounds:function(){this.layerBounds=this._computeLayerBounds();this.zoomBounds=this._computeZoomBounds()},_computeLayerBounds:function(){if(this._mapTiles.length===0){return t.bounds([0,0],[0,0])}const s={};const n=this.options.projection;const o=M[n].options.crs.tile.bounds.max.x;for(const t of this._mapTiles){const i=t.zoom;if(!s[i]){s[i]=[]}s[i].push({x:t.col,y:t.row,z:i})}const e={};for(const h in s){const f=s[h];let c=null;for(const i of f){const s=i.x*o;const n=i.y*o;if(!c){c=t.bounds(t.point(s,n),t.point(s+o,n+o))}else{c.extend(t.point(s,n));c.extend(t.point(s+o,n+o))}}if(c){e[h]=i.pixelToPCRSBounds(c,parseInt(h),n)}}let h=null;for(const t in e){if(!h){h=e[t].pad(0)}else{h.extend(e[t].min);h.extend(e[t].max)}}return h||t.bounds([0,0],[0,0])},_computeZoomBounds:function(){const t={minZoom:Infinity,maxZoom:-Infinity,minNativeZoom:Infinity,maxNativeZoom:-Infinity};if(this._mapTiles.length===0){return{minZoom:0,maxZoom:22,minNativeZoom:0,maxNativeZoom:22}}for(const i of this._mapTiles){const s=i.zoom;t.minNativeZoom=Math.min(t.minNativeZoom,s);t.maxNativeZoom=Math.max(t.maxNativeZoom,s)}t.minZoom=t.minNativeZoom;t.maxZoom=t.maxNativeZoom;return t}});var n=function(t){return new s(t)};export{s as M,n as m};
//# sourceMappingURL=p-C8xJJwPc.js.map