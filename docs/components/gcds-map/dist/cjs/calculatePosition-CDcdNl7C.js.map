{"version":3,"file":"calculatePosition-CDcdNl7C.js","sources":["src/components/utils/mapml/elementSupport/layers/calculatePosition.js"],"sourcesContent":["/**\n * Calculate the sequence position for map elements based on their position in a\n * sequence of target elements (map-tile, map-feature, map-extent).\n * - map-extent: Each element gets its own unique position (each is its own MapExtentLayer)\n * - map-tile/map-feature: Adjacent elements of same type share the same position (they share a MapTileLayer/MapFeatureLayer)\n * - used to set the zIndex for the LayerGroup's _container (rendering).\n *\n * @param {HTMLElement} element - The element to calculate position for (map-tile, map-extent, or map-feature)\n * @returns {number} The position of this element's LayerGroup\n */\nexport function calculatePosition(element) {\n  const tagName = element.tagName.toLowerCase();\n  const validTags = ['map-tile', 'map-extent', 'map-feature'];\n\n  // Validate element type\n  if (!validTags.includes(tagName)) {\n    console.warn(`calculatePosition: Invalid element type ${tagName}`);\n    return 0;\n  }\n\n  // Get parent - could be Element or ShadowRoot\n  const parent = element.parentNode;\n  if (!parent) return 1;\n\n  // Get children - works for both Element and ShadowRoot\n  // For ShadowRoot, we need to filter to get only element nodes\n  const children =\n    parent.children ||\n    Array.from(parent.childNodes).filter(\n      (node) => node.nodeType === Node.ELEMENT_NODE\n    );\n\n  if (!children || children.length === 0) return 1;\n\n  let position = 0;\n  let lastTag = null;\n  let foundTarget = false;\n\n  // Iterate through all child elements\n  for (const child of children) {\n    // Skip non-element nodes (shouldn't happen with .children, but safe for childNodes)\n    if (child.nodeType !== Node.ELEMENT_NODE) continue;\n\n    const childTag = child.tagName.toLowerCase();\n\n    // Skip non-map elements\n    if (!validTags.includes(childTag)) continue;\n\n    // Check if we've reached our target element\n    if (child === element) {\n      foundTarget = true;\n\n      // map-extent always needs a new z-index\n      if (childTag === 'map-extent') {\n        position++;\n        return position;\n      }\n\n      // For map-tile and map-feature:\n      // If this element continues a sequence of the same type, return the current z-index\n      if (lastTag === childTag) {\n        return position;\n      }\n\n      // This element starts a new layer group\n      position++;\n      return position;\n    }\n\n    // Before reaching target, count layer group transitions\n    if (!foundTarget) {\n      if (childTag === 'map-extent') {\n        // Each map-extent increments z-index\n        position++;\n      } else if (lastTag !== null && lastTag !== childTag) {\n        // Transition between different types (excluding map-extent)\n        position++;\n      } else if (lastTag === null) {\n        // First valid element starts at z-index 1\n        position = 1;\n      }\n\n      lastTag = childTag;\n    }\n  }\n  // Element not found (shouldn't happen in normal usage)\n  return 0;\n}\n"],"names":[],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,iBAAiB,CAAC,OAAO,EAAE;AAC3C,EAAE,MAAM,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,WAAW,EAAE;AAC/C,EAAE,MAAM,SAAS,GAAG,CAAC,UAAU,EAAE,YAAY,EAAE,aAAa,CAAC;;AAE7D;AACA,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;AACpC,IAAI,OAAO,CAAC,IAAI,CAAC,CAAC,wCAAwC,EAAE,OAAO,CAAC,CAAC,CAAC;AACtE,IAAI,OAAO,CAAC;AACZ;;AAEA;AACA,EAAE,MAAM,MAAM,GAAG,OAAO,CAAC,UAAU;AACnC,EAAE,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC;;AAEvB;AACA;AACA,EAAE,MAAM,QAAQ;AAChB,IAAI,MAAM,CAAC,QAAQ;AACnB,IAAI,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,MAAM;AACxC,MAAM,CAAC,IAAI,KAAK,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC;AACvC,KAAK;;AAEL,EAAE,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE,OAAO,CAAC;;AAElD,EAAE,IAAI,QAAQ,GAAG,CAAC;AAClB,EAAE,IAAI,OAAO,GAAG,IAAI;AACpB,EAAE,IAAI,WAAW,GAAG,KAAK;;AAEzB;AACA,EAAE,KAAK,MAAM,KAAK,IAAI,QAAQ,EAAE;AAChC;AACA,IAAI,IAAI,KAAK,CAAC,QAAQ,KAAK,IAAI,CAAC,YAAY,EAAE;;AAE9C,IAAI,MAAM,QAAQ,GAAG,KAAK,CAAC,OAAO,CAAC,WAAW,EAAE;;AAEhD;AACA,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;;AAEvC;AACA,IAAI,IAAI,KAAK,KAAK,OAAO,EAAE;AAC3B,MAAM,WAAW,GAAG,IAAI;;AAExB;AACA,MAAM,IAAI,QAAQ,KAAK,YAAY,EAAE;AACrC,QAAQ,QAAQ,EAAE;AAClB,QAAQ,OAAO,QAAQ;AACvB;;AAEA;AACA;AACA,MAAM,IAAI,OAAO,KAAK,QAAQ,EAAE;AAChC,QAAQ,OAAO,QAAQ;AACvB;;AAEA;AACA,MAAM,QAAQ,EAAE;AAChB,MAAM,OAAO,QAAQ;AACrB;;AAEA;AACA,IAAI,IAAI,CAAC,WAAW,EAAE;AACtB,MAAM,IAAI,QAAQ,KAAK,YAAY,EAAE;AACrC;AACA,QAAQ,QAAQ,EAAE;AAClB,OAAO,MAAM,IAAI,OAAO,KAAK,IAAI,IAAI,OAAO,KAAK,QAAQ,EAAE;AAC3D;AACA,QAAQ,QAAQ,EAAE;AAClB,OAAO,MAAM,IAAI,OAAO,KAAK,IAAI,EAAE;AACnC;AACA,QAAQ,QAAQ,GAAG,CAAC;AACpB;;AAEA,MAAM,OAAO,GAAG,QAAQ;AACxB;AACA;AACA;AACA,EAAE,OAAO,CAAC;AACV;;;;"}