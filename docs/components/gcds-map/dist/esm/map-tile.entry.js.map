{"version":3,"file":"map-tile.entry.js","sources":["src/components/map-tile/map-tile.tsx"],"sourcesContent":["import { Component, Prop, Element, Method, Watch } from '@stencil/core';\nimport { Util } from '../utils/mapml/Util.js';\nimport { mapTileLayer } from '../utils/mapml/layers/MapTileLayer.js';\nimport { calculatePosition } from '../utils/mapml/elementSupport/layers/calculatePosition.js';\n\n@Component({\n  tag: 'map-tile',\n  shadow: false\n})\nexport class MapTile {\n  @Element() el: HTMLElement;\n\n  // \"Set once\" properties - these are set once at connection and never change\n  @Prop({ reflect: true }) row?: number;\n  @Prop({ reflect: true }) col?: number;\n  @Prop({ reflect: true }) zoom?: number;\n  @Prop({ reflect: true }) src?: string;\n\n  _parentEl: any;\n  _tileLayer: any;\n  _extent: any;\n  \n  // Store initial values to prevent changes after connection\n  private _initialRow: number;\n  private _initialCol: number;\n  private _initialZoom: number;\n  private _hasConnected = false;\n\n  @Watch('src')\n  srcChanged(newValue: string, oldValue: string) {\n    if (oldValue !== newValue) {\n      if (this._extent) this._calculateExtent();\n      if (this._tileLayer) {\n        this._tileLayer.removeMapTile(this.el);\n        this._tileLayer.addMapTile(this.el);\n      }\n    }\n  }\n\n  connectedCallback() {\n    // Capture initial values before anything else - these won't change\n    // Read from attributes first, then fall back to props\n    this._initialRow = this.el.hasAttribute('row') ? +this.el.getAttribute('row') : (this.row ?? 0);\n    this._initialCol = this.el.hasAttribute('col') ? +this.el.getAttribute('col') : (this.col ?? 0);\n    \n    // For zoom, check: explicit attribute -> prop -> map-meta value -> map zoom -> 0\n    let zoomValue = 0;\n    if (this.el.hasAttribute('zoom')) {\n      zoomValue = +this.el.getAttribute('zoom');\n    } else if (this.zoom !== undefined) {\n      zoomValue = this.zoom;\n    } else {\n      // Try to get zoom from map-meta element\n      const metaZoom = this._getMetaZoomValue();\n      if (metaZoom !== null) {\n        zoomValue = metaZoom;\n      } else {\n        zoomValue = this.getMapEl()?.zoom || 0;\n      }\n    }\n    this._initialZoom = zoomValue;\n    this._hasConnected = true;\n    \n    // Override getAttribute/setAttribute on the element to prevent row/col/zoom changes\n    const originalGetAttribute = this.el.getAttribute.bind(this.el);\n    const originalSetAttribute = this.el.setAttribute.bind(this.el);\n    \n    this.el.getAttribute = (name: string) => {\n      if (this._hasConnected) {\n        switch (name) {\n          case 'row':\n            return String(this._initialRow);\n          case 'col':\n            return String(this._initialCol);\n          case 'zoom':\n            return String(this._initialZoom);\n        }\n      }\n      return originalGetAttribute(name);\n    };\n    \n    this.el.setAttribute = (name: string, value: string) => {\n      if (this._hasConnected) {\n        switch (name) {\n          case 'row':\n          case 'col':\n          case 'zoom':\n            return; // Ignore changes to these after connection\n        }\n      }\n      originalSetAttribute(name, value);\n    };\n\n    // Override property accessors on the element to return initial values\n    Object.defineProperties(this.el, {\n      row: {\n        get: () => this._initialRow,\n        configurable: true\n      },\n      col: {\n        get: () => this._initialCol,\n        configurable: true\n      },\n      zoom: {\n        get: () => this._initialZoom,\n        configurable: true\n      }\n    });\n    \n    // Find parent element (handle shadow DOM)\n    const parentNode = this.el.parentNode as HTMLElement;\n    this._parentEl =\n      parentNode.nodeName === 'MAP-LAYER' ||\n      parentNode.nodeName === 'LAYER-' ||\n      parentNode.nodeName === 'MAP-LINK'\n        ? parentNode\n        : (parentNode as any).host;\n\n    // Preload image\n    const imgObj = new Image();\n    imgObj.src = this.src || '';\n\n    this._createOrGetTileLayer();\n  }\n  disconnectedCallback() {\n    if (this._tileLayer) {\n      this._tileLayer.removeMapTile(this.el);\n      if (this._tileLayer._mapTiles && this._tileLayer._mapTiles.length === 0) {\n        this._tileLayer.remove();\n        this._tileLayer = null;\n        delete this._tileLayer;\n\n        const entry = this?._parentEl?._layerRegistry?.get(this.position);\n        if (entry) {\n          entry.count--;\n          if (entry.count === 0) {\n              this._parentEl._layerRegistry.delete(this.position);\n          }\n        }\n      }\n    }\n  }\n\n  // \"Set once\" property pattern for row, col, zoom\n  // After connection, always return the initial values\n  get rowValue() {\n    return this._hasConnected ? this._initialRow : +this.row;\n  }\n  get colValue() {\n    return this._hasConnected ? this._initialCol : +this.col;\n  }\n  get zoomValue() {\n    return this._hasConnected ? this._initialZoom : +this.zoom;\n  }\n\n  get extent() {\n    if (!this._extent) this._calculateExtent();\n    return this._extent;\n  }\n\n  get position() {\n    return calculatePosition(this.el);\n  }\n\n  isFirst() {\n    return !this._parentEl._layerRegistry.has(this.position);\n  }\n\n  getPrevious() {\n    if (this.isFirst()) return null;\n    return this.el.previousElementSibling;\n  }\n\n  @Method()\n  async zoomTo() {\n    const extent = this.extent;\n    const map = this.getMapEl()?._map;\n    if (!extent || !map) return;\n    const xmin = extent.topLeft.pcrs.horizontal,\n      xmax = extent.bottomRight.pcrs.horizontal,\n      ymin = extent.bottomRight.pcrs.vertical,\n      ymax = extent.topLeft.pcrs.vertical,\n      bounds = (window as any).L.bounds((window as any).L.point(xmin, ymin), (window as any).L.point(xmax, ymax)),\n      center = map.options.crs.unproject(bounds.getCenter(true)),\n      maxZoom = extent.zoom.maxZoom,\n      minZoom = extent.zoom.minZoom;\n    map.setView(center, Util.getMaxZoom(bounds, map, minZoom, maxZoom), { animate: false });\n  }\n\n  getMapEl() {\n    return Util.getClosest(this.el, 'gcds-map');\n  }\n\n  getLayerEl() {\n    return Util.getClosest(this.el, 'map-layer,layer-');\n  }\n\n  private _getMetaZoomValue(): number | null {\n    // Look for <map-meta name=\"zoom\" content=\"...value=N...\"> in parent layer\n    const layerEl = this.getLayerEl();\n    if (!layerEl) return null;\n    \n    const metaZoom = layerEl.querySelector('map-meta[name=\"zoom\"][content]');\n    if (!metaZoom) return null;\n    \n    const content = metaZoom.getAttribute('content');\n    if (!content) return null;\n    \n    // Parse content like \"min=1,max=4,value=2\"\n    const valueMatch = content.match(/value=(\\d+)/);\n    if (valueMatch && valueMatch[1]) {\n      return parseInt(valueMatch[1], 10);\n    }\n    \n    return null;\n  }\n\n  getMeta(metaName: string) {\n    const name = metaName.toLowerCase();\n    if (name !== 'cs' && name !== 'zoom' && name !== 'projection') return;\n    const sdMeta = this._parentEl?.shadowRoot?.querySelector(`map-meta[name=${name}][content]`);\n    if (this._parentEl?.nodeName === 'MAP-LINK') {\n      return sdMeta || this._parentEl.parentElement?.getMeta(metaName);\n    } else {\n      return this._parentEl?.src\n        ? this._parentEl.shadowRoot?.querySelector(`map-meta[name=${name}][content]`)\n        : this._parentEl.querySelector(`map-meta[name=${name}][content]`);\n    }\n  }\n\n  private async _createOrGetTileLayer() {\n    if (!this._parentEl?.whenReady) return;\n    await this._parentEl.whenReady();\n    const parentElement = this._parentEl;\n    if (this.isFirst()) {\n\n      this._tileLayer = mapTileLayer({\n        projection: this.getMapEl()?.projection,\n        opacity: 1,\n        pane:\n          parentElement._templatedLayer?.getContainer?.() ||\n          parentElement._layer?.getContainer?.(),\n        zIndex: this.position\n      });\n      this._tileLayer.addMapTile(this.el);\n      if (parentElement._templatedLayer?.addLayer) {\n        parentElement._templatedLayer.addLayer(this._tileLayer);\n      } else {\n        parentElement._layer?.addLayer?.(this._tileLayer);\n      }\n      // Publish _tileLayer on the element for test access\n      (this.el as any)._tileLayer = this._tileLayer;\n      // Add this position to the parent's _layerRegistry with layer reference and count = 1\n      parentElement._layerRegistry.set(this.position, { layer: this._tileLayer, count: 1 });\n    } else {\n      // get the previously registered TileLayer for this position\n      const entry = parentElement._layerRegistry.get(this.position);\n\n      this._tileLayer = entry?.layer;\n      if (entry) {\n        entry.count++;\n      }\n      if (this._tileLayer) {\n        this._tileLayer.addMapTile(this.el);\n        // Publish _tileLayer on the element for test access\n        (this.el as any)._tileLayer = this._tileLayer;\n      }\n    }\n  }\n\n  private _calculateExtent() {\n    const mapEl = this.getMapEl();\n    if (!mapEl || !mapEl._map) return;\n    const map = mapEl._map;\n    const projection = map.options.projection;\n    const tileSize = (window as any).M[projection].options.crs.tile.bounds.max.x;\n    const pixelX = this.colValue * tileSize;\n    const pixelY = this.rowValue * tileSize;\n    const pixelBounds = (window as any).L.bounds(\n      (window as any).L.point(pixelX, pixelY),\n      (window as any).L.point(pixelX + tileSize, pixelY + tileSize)\n    );\n    const pcrsBounds = Util.pixelToPCRSBounds(pixelBounds, this.zoomValue, projection);\n    this._extent = Util._convertAndFormatPCRS(pcrsBounds, map.options.crs, projection);\n    this._extent.zoom = {\n      minZoom: this.zoomValue,\n      maxZoom: this.zoomValue,\n      minNativeZoom: this.zoomValue,\n      maxNativeZoom: this.zoomValue\n    };\n  }\n\n  render() {\n    // This component does not render any visible DOM\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;MASa,OAAO,GAAA,MAAA;;;;;;AAIO,IAAA,GAAG;AACH,IAAA,GAAG;AACH,IAAA,IAAI;AACJ,IAAA,GAAG;AAE5B,IAAA,SAAS;AACT,IAAA,UAAU;AACV,IAAA,OAAO;;AAGC,IAAA,WAAW;AACX,IAAA,WAAW;AACX,IAAA,YAAY;IACZ,aAAa,GAAG,KAAK;IAG7B,UAAU,CAAC,QAAgB,EAAE,QAAgB,EAAA;AAC3C,QAAA,IAAI,QAAQ,KAAK,QAAQ,EAAE;YACzB,IAAI,IAAI,CAAC,OAAO;gBAAE,IAAI,CAAC,gBAAgB,EAAE;AACzC,YAAA,IAAI,IAAI,CAAC,UAAU,EAAE;gBACnB,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC;gBACtC,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC;;;;IAKzC,iBAAiB,GAAA;;;AAGf,QAAA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;AAC/F,QAAA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;;QAG/F,IAAI,SAAS,GAAG,CAAC;QACjB,IAAI,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE;YAChC,SAAS,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC;;AACpC,aAAA,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,EAAE;AAClC,YAAA,SAAS,GAAG,IAAI,CAAC,IAAI;;aAChB;;AAEL,YAAA,MAAM,QAAQ,GAAG,IAAI,CAAC,iBAAiB,EAAE;AACzC,YAAA,IAAI,QAAQ,KAAK,IAAI,EAAE;gBACrB,SAAS,GAAG,QAAQ;;iBACf;gBACL,SAAS,GAAG,IAAI,CAAC,QAAQ,EAAE,EAAE,IAAI,IAAI,CAAC;;;AAG1C,QAAA,IAAI,CAAC,YAAY,GAAG,SAAS;AAC7B,QAAA,IAAI,CAAC,aAAa,GAAG,IAAI;;AAGzB,QAAA,MAAM,oBAAoB,GAAG,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;AAC/D,QAAA,MAAM,oBAAoB,GAAG,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;QAE/D,IAAI,CAAC,EAAE,CAAC,YAAY,GAAG,CAAC,IAAY,KAAI;AACtC,YAAA,IAAI,IAAI,CAAC,aAAa,EAAE;gBACtB,QAAQ,IAAI;AACV,oBAAA,KAAK,KAAK;AACR,wBAAA,OAAO,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC;AACjC,oBAAA,KAAK,KAAK;AACR,wBAAA,OAAO,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC;AACjC,oBAAA,KAAK,MAAM;AACT,wBAAA,OAAO,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;;;AAGtC,YAAA,OAAO,oBAAoB,CAAC,IAAI,CAAC;AACnC,SAAC;QAED,IAAI,CAAC,EAAE,CAAC,YAAY,GAAG,CAAC,IAAY,EAAE,KAAa,KAAI;AACrD,YAAA,IAAI,IAAI,CAAC,aAAa,EAAE;gBACtB,QAAQ,IAAI;AACV,oBAAA,KAAK,KAAK;AACV,oBAAA,KAAK,KAAK;AACV,oBAAA,KAAK,MAAM;AACT,wBAAA,OAAO;;;AAGb,YAAA,oBAAoB,CAAC,IAAI,EAAE,KAAK,CAAC;AACnC,SAAC;;AAGD,QAAA,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,EAAE,EAAE;AAC/B,YAAA,GAAG,EAAE;AACH,gBAAA,GAAG,EAAE,MAAM,IAAI,CAAC,WAAW;AAC3B,gBAAA,YAAY,EAAE;AACf,aAAA;AACD,YAAA,GAAG,EAAE;AACH,gBAAA,GAAG,EAAE,MAAM,IAAI,CAAC,WAAW;AAC3B,gBAAA,YAAY,EAAE;AACf,aAAA;AACD,YAAA,IAAI,EAAE;AACJ,gBAAA,GAAG,EAAE,MAAM,IAAI,CAAC,YAAY;AAC5B,gBAAA,YAAY,EAAE;AACf;AACF,SAAA,CAAC;;AAGF,QAAA,MAAM,UAAU,GAAG,IAAI,CAAC,EAAE,CAAC,UAAyB;AACpD,QAAA,IAAI,CAAC,SAAS;YACZ,UAAU,CAAC,QAAQ,KAAK,WAAW;gBACnC,UAAU,CAAC,QAAQ,KAAK,QAAQ;gBAChC,UAAU,CAAC,QAAQ,KAAK;AACtB,kBAAE;AACF,kBAAG,UAAkB,CAAC,IAAI;;AAG9B,QAAA,MAAM,MAAM,GAAG,IAAI,KAAK,EAAE;QAC1B,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,IAAI,EAAE;QAE3B,IAAI,CAAC,qBAAqB,EAAE;;IAE9B,oBAAoB,GAAA;AAClB,QAAA,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC;AACtC,YAAA,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;AACvE,gBAAA,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE;AACxB,gBAAA,IAAI,CAAC,UAAU,GAAG,IAAI;gBACtB,OAAO,IAAI,CAAC,UAAU;AAEtB,gBAAA,MAAM,KAAK,GAAG,IAAI,EAAE,SAAS,EAAE,cAAc,EAAE,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACjE,IAAI,KAAK,EAAE;oBACT,KAAK,CAAC,KAAK,EAAE;AACb,oBAAA,IAAI,KAAK,CAAC,KAAK,KAAK,CAAC,EAAE;wBACnB,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;;;;;;;;AAS/D,IAAA,IAAI,QAAQ,GAAA;AACV,QAAA,OAAO,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,WAAW,GAAG,CAAC,IAAI,CAAC,GAAG;;AAE1D,IAAA,IAAI,QAAQ,GAAA;AACV,QAAA,OAAO,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,WAAW,GAAG,CAAC,IAAI,CAAC,GAAG;;AAE1D,IAAA,IAAI,SAAS,GAAA;AACX,QAAA,OAAO,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,YAAY,GAAG,CAAC,IAAI,CAAC,IAAI;;AAG5D,IAAA,IAAI,MAAM,GAAA;QACR,IAAI,CAAC,IAAI,CAAC,OAAO;YAAE,IAAI,CAAC,gBAAgB,EAAE;QAC1C,OAAO,IAAI,CAAC,OAAO;;AAGrB,IAAA,IAAI,QAAQ,GAAA;AACV,QAAA,OAAO,iBAAiB,CAAC,IAAI,CAAC,EAAE,CAAC;;IAGnC,OAAO,GAAA;AACL,QAAA,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC;;IAG1D,WAAW,GAAA;QACT,IAAI,IAAI,CAAC,OAAO,EAAE;AAAE,YAAA,OAAO,IAAI;AAC/B,QAAA,OAAO,IAAI,CAAC,EAAE,CAAC,sBAAsB;;AAIvC,IAAA,MAAM,MAAM,GAAA;AACV,QAAA,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM;QAC1B,MAAM,GAAG,GAAG,IAAI,CAAC,QAAQ,EAAE,EAAE,IAAI;AACjC,QAAA,IAAI,CAAC,MAAM,IAAI,CAAC,GAAG;YAAE;QACrB,MAAM,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,EACzC,IAAI,GAAG,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EACzC,IAAI,GAAG,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,EACvC,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EACnC,MAAM,GAAI,MAAc,CAAC,CAAC,CAAC,MAAM,CAAE,MAAc,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,EAAG,MAAc,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,EAC3G,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,EAC1D,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,EAC7B,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO;QAC/B,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,OAAO,CAAC,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;;IAGzF,QAAQ,GAAA;QACN,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,EAAE,UAAU,CAAC;;IAG7C,UAAU,GAAA;QACR,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,EAAE,kBAAkB,CAAC;;IAG7C,iBAAiB,GAAA;;AAEvB,QAAA,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE;AACjC,QAAA,IAAI,CAAC,OAAO;AAAE,YAAA,OAAO,IAAI;QAEzB,MAAM,QAAQ,GAAG,OAAO,CAAC,aAAa,CAAC,gCAAgC,CAAC;AACxE,QAAA,IAAI,CAAC,QAAQ;AAAE,YAAA,OAAO,IAAI;QAE1B,MAAM,OAAO,GAAG,QAAQ,CAAC,YAAY,CAAC,SAAS,CAAC;AAChD,QAAA,IAAI,CAAC,OAAO;AAAE,YAAA,OAAO,IAAI;;QAGzB,MAAM,UAAU,GAAG,OAAO,CAAC,KAAK,CAAC,aAAa,CAAC;AAC/C,QAAA,IAAI,UAAU,IAAI,UAAU,CAAC,CAAC,CAAC,EAAE;YAC/B,OAAO,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC;;AAGpC,QAAA,OAAO,IAAI;;AAGb,IAAA,OAAO,CAAC,QAAgB,EAAA;AACtB,QAAA,MAAM,IAAI,GAAG,QAAQ,CAAC,WAAW,EAAE;QACnC,IAAI,IAAI,KAAK,IAAI,IAAI,IAAI,KAAK,MAAM,IAAI,IAAI,KAAK,YAAY;YAAE;AAC/D,QAAA,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,EAAE,UAAU,EAAE,aAAa,CAAC,CAAA,cAAA,EAAiB,IAAI,CAAA,UAAA,CAAY,CAAC;QAC3F,IAAI,IAAI,CAAC,SAAS,EAAE,QAAQ,KAAK,UAAU,EAAE;AAC3C,YAAA,OAAO,MAAM,IAAI,IAAI,CAAC,SAAS,CAAC,aAAa,EAAE,OAAO,CAAC,QAAQ,CAAC;;aAC3D;AACL,YAAA,OAAO,IAAI,CAAC,SAAS,EAAE;AACrB,kBAAE,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,aAAa,CAAC,CAAA,cAAA,EAAiB,IAAI,CAAA,UAAA,CAAY;kBAC1E,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,CAAiB,cAAA,EAAA,IAAI,CAAY,UAAA,CAAA,CAAC;;;AAI/D,IAAA,MAAM,qBAAqB,GAAA;AACjC,QAAA,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS;YAAE;AAChC,QAAA,MAAM,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE;AAChC,QAAA,MAAM,aAAa,GAAG,IAAI,CAAC,SAAS;AACpC,QAAA,IAAI,IAAI,CAAC,OAAO,EAAE,EAAE;AAElB,YAAA,IAAI,CAAC,UAAU,GAAG,YAAY,CAAC;AAC7B,gBAAA,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,EAAE,UAAU;AACvC,gBAAA,OAAO,EAAE,CAAC;AACV,gBAAA,IAAI,EACF,aAAa,CAAC,eAAe,EAAE,YAAY,IAAI;AAC/C,oBAAA,aAAa,CAAC,MAAM,EAAE,YAAY,IAAI;gBACxC,MAAM,EAAE,IAAI,CAAC;AACd,aAAA,CAAC;YACF,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC;AACnC,YAAA,IAAI,aAAa,CAAC,eAAe,EAAE,QAAQ,EAAE;gBAC3C,aAAa,CAAC,eAAe,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC;;iBAClD;gBACL,aAAa,CAAC,MAAM,EAAE,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC;;;YAGlD,IAAI,CAAC,EAAU,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU;;YAE7C,aAAa,CAAC,cAAc,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,UAAU,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;;aAChF;;AAEL,YAAA,MAAM,KAAK,GAAG,aAAa,CAAC,cAAc,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC;AAE7D,YAAA,IAAI,CAAC,UAAU,GAAG,KAAK,EAAE,KAAK;YAC9B,IAAI,KAAK,EAAE;gBACT,KAAK,CAAC,KAAK,EAAE;;AAEf,YAAA,IAAI,IAAI,CAAC,UAAU,EAAE;gBACnB,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC;;gBAElC,IAAI,CAAC,EAAU,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU;;;;IAK3C,gBAAgB,GAAA;AACtB,QAAA,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE;AAC7B,QAAA,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,IAAI;YAAE;AAC3B,QAAA,MAAM,GAAG,GAAG,KAAK,CAAC,IAAI;AACtB,QAAA,MAAM,UAAU,GAAG,GAAG,CAAC,OAAO,CAAC,UAAU;QACzC,MAAM,QAAQ,GAAI,MAAc,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAC5E,QAAA,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,GAAG,QAAQ;AACvC,QAAA,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,GAAG,QAAQ;AACvC,QAAA,MAAM,WAAW,GAAI,MAAc,CAAC,CAAC,CAAC,MAAM,CACzC,MAAc,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE,MAAM,CAAC,EACtC,MAAc,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,QAAQ,EAAE,MAAM,GAAG,QAAQ,CAAC,CAC9D;AACD,QAAA,MAAM,UAAU,GAAG,IAAI,CAAC,iBAAiB,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,EAAE,UAAU,CAAC;AAClF,QAAA,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,UAAU,CAAC;AAClF,QAAA,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG;YAClB,OAAO,EAAE,IAAI,CAAC,SAAS;YACvB,OAAO,EAAE,IAAI,CAAC,SAAS;YACvB,aAAa,EAAE,IAAI,CAAC,SAAS;YAC7B,aAAa,EAAE,IAAI,CAAC;SACrB;;IAGH,MAAM,GAAA;;AAEJ,QAAA,OAAO,IAAI;;;;;;;;;"}