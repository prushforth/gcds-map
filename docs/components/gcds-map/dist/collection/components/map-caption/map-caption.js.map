{"version":3,"file":"map-caption.js","sourceRoot":"","sources":["../../../src/components/map-caption/map-caption.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,MAAM,eAAe,CAAC;AAEnD;;;EAGE;AAKF,MAAM,OAAO,UAAU;IACV,EAAE,CAAc;IAE3B,QAAQ,CAAmB;IAE3B,iBAAiB;QACf,IACE,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,QAAQ,KAAK,UAAU,EAC7C,CAAC;YACD,8EAA8E;YAC9E,UAAU,CAAC,GAAG,EAAE;gBACd,gEAAgE;gBAChE,MAAM,eAAe,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;gBAC3E,MAAM,cAAc,GAAG,eAAe,KAAM,IAAI,CAAC,EAAU,CAAC;gBAE5D,IAAI,CAAC,cAAc,EAAE,CAAC;oBACpB,6DAA6D;oBAC7D,OAAO;gBACT,CAAC;gBAED,mHAAmH;gBACnH,IAAI,UAAU,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC;gBAEnC,IAAI,CAAC,QAAQ,GAAG,IAAI,gBAAgB,CAAC,GAAG,EAAE;oBACxC,IAAI,gBAAgB,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC;oBAEzC,IAAI,gBAAgB,KAAK,UAAU,EAAE,CAAC;wBACpC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,YAAY,EAAE,gBAAgB,CAAC,CAAC;wBACnE,UAAU,GAAG,gBAAgB,CAAC;oBAChC,CAAC;gBACH,CAAC,CAAC,CAAC;gBAEH,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE;oBAC7B,aAAa,EAAE,IAAI;oBACnB,OAAO,EAAE,IAAI;oBACb,UAAU,EAAE,IAAI;oBAChB,SAAS,EAAE,IAAI;iBAChB,CAAC,CAAC;gBAEH,kGAAkG;gBAClG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,YAAY,CAAC,EAAE,CAAC;oBACtD,MAAM,SAAS,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC;oBACpC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,YAAY,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;gBAC9D,CAAC;YACH,CAAC,EAAE,CAAC,CAAC,CAAC;QACR,CAAC;IACH,CAAC;IAED,oBAAoB;QAClB,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;YAClB,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;QAC7B,CAAC;IACH,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAC;IACd,CAAC;;;CACF","sourcesContent":["import { Component, Element } from '@stencil/core';\n\n/* \nimplemented for both mapml-viewer and web-map; however web-map does not focus on map element in the browser resulting in NVDA \nnot being able to read out map-caption and stating that it's an interactive map region\n*/\n@Component({\n  tag: 'map-caption',\n  shadow: false\n})\nexport class MapCaption {\n  @Element() el: HTMLElement;\n\n  observer: MutationObserver;\n\n  connectedCallback() {\n    if (\n      this.el.parentElement.nodeName === 'GCDS-MAP'\n    ) {\n      // Wait a tick for Stencil to finish rendering/hydrating the element's content\n      setTimeout(() => {\n        // Only the first map-caption child should manage the aria-label\n        const firstMapCaption = this.el.parentElement.querySelector('map-caption');\n        const isFirstCaption = firstMapCaption === (this.el as any);\n        \n        if (!isFirstCaption) {\n          // Not the first caption, don't set up observer or aria-label\n          return;\n        }\n        \n        // calls MutationObserver; needed to observe changes to content between <map-caption> tags and update to aria-label\n        let mapcaption = this.el.innerText;\n\n        this.observer = new MutationObserver(() => {\n          let mapcaptionupdate = this.el.innerText;\n\n          if (mapcaptionupdate !== mapcaption) {\n            this.el.parentElement.setAttribute('aria-label', mapcaptionupdate);\n            mapcaption = mapcaptionupdate;\n          }\n        });\n\n        this.observer.observe(this.el, {\n          characterData: true,\n          subtree: true,\n          attributes: true,\n          childList: true\n        });\n\n        // don't change aria-label if one already exists from user  (checks when element is first created)\n        if (!this.el.parentElement.hasAttribute('aria-label')) {\n          const ariaLabel = this.el.innerText;\n          this.el.parentElement.setAttribute('aria-label', ariaLabel);\n        }\n      }, 0);\n    }\n  }\n\n  disconnectedCallback() {\n    if (this.observer) {\n      this.observer.disconnect();\n    }\n  }\n\n  render() {\n    return null;\n  }\n}\n"]}