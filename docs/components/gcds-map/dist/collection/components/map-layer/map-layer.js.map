{"version":3,"file":"map-layer.js","sourceRoot":"","sources":["../../../src/components/map-layer/map-layer.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Prop, Element, Watch, Method } from '@stencil/core';\nimport { setOptions, DomUtil, bounds, point } from 'leaflet';\nimport { Util } from '../utils/mapml/Util.js';\nimport * as MapLayerModule from '../utils/mapml/layers/MapLayer.js';\nimport { MapTileLayer } from '../utils/mapml/layers/MapTileLayer.js';\nimport { MapFeatureLayer } from '../utils/mapml/layers/MapFeatureLayer.js';\nimport { createLayerControlHTML } from '../utils/mapml/elementSupport/layers/createLayerControlForLayer.js';\n\n@Component({\n  tag: 'map-layer',\n  shadow: true\n})\nexport class GcdsMapLayer {\n  /*\n   * MapML Compatibility: The following properties are exposed on this.el for MapML compatibility:\n   * - _layer: The MapML layer instance\n   * - _layerControl: The layer control instance \n   * - _layerControlHTML: The layer control HTML elements\n   * - _fetchError: Boolean indicating if there was a fetch error\n   * - _layerControlCheckbox: The layer control checkbox element (set by createLayerControlHTML)\n   * - _opacitySlider: The opacity slider element (set by createLayerControlHTML)\n   * - Other layer control elements set dynamically by createLayerControlHTML\n   */\n  @Element() el: HTMLElement;\n\n  // Core properties matching BaseLayerElement observedAttributes\n  @Prop({ reflect: true, mutable: true }) src?: string;\n  @Prop({ reflect: true, mutable: true }) checked?: boolean;\n  @Prop({ reflect: true, mutable: true }) hidden: boolean = false;\n  @Prop({ mutable: true }) opacity?: number = 1;\n  @Prop({ mutable: true }) _opacity?: number;\n  @Prop({ reflect: true, mutable: true }) media?: string;\n  \n  get opacityValue(): number {\n    return this._opacity ?? this.opacity ?? 1.0;\n  }\n\n  _layer: any;\n  _layerControl: any;\n  _layerControlHTML: any;\n  _layerItemSettingsHTML: any;\n  _propertiesGroupAnatomy: any;\n  disabled: boolean = false;\n  _fetchError: boolean = false;\n  // the layer registry is a semi-private Map stored on each map-link and map-layer element\n  // structured as follows: position -> {layer: layerInstance, count: number}\n  // where layer is either a MapTileLayer or a MapFeatureLayer, \n  // and count is the number of tiles or features in that layer\n  _layerRegistry: Map<number, { layer: any; count: number }> = new Map();\n\n  // Watchers for attribute changes - these automatically don't fire during initial load\n  @Watch('src')\n  srcChanged(newValue: string, oldValue: string) {\n    if (oldValue !== newValue) {\n      this._onRemove();\n      if (this.el.isConnected) {\n        this._onAdd();\n      }\n    }\n  }\n  @Watch('checked')\n  checkedChanged(newValue: boolean) {\n    if (this._layer) {\n      \n      // Get the parent map element\n      const mapEl = this.getMapEl();\n      if (mapEl && (mapEl as any)._map) {\n        const leafletMap = (mapEl as any)._map;\n        \n        if (newValue) {\n          // If checked is true, add the layer to the map\n          leafletMap.addLayer(this._layer);\n        } else {\n          // If checked is false, remove the layer from the map\n          leafletMap.removeLayer(this._layer);\n        }\n      }\n      \n      // Update the layer control checkbox to match the checked state\n      if (this._layerControlCheckbox) {\n        this._layerControlCheckbox.checked = newValue;\n      }\n    }\n  }\n  @Watch('_opacity')\n  opacityChanged(newValue: number, oldValue: number) {\n    // This watcher handles programmatic changes to the opacity property\n    if (oldValue !== newValue && this._layer) {\n      this._opacity = newValue;\n      this._layer.changeOpacity(newValue);\n      // reflect to map-layer opacity attribute when opacity property changes\n      // this.el.setAttribute('opacity', newValue.toString());\n      // Update opacity slider if it exists\n      if (this._opacitySlider) {\n        this._opacitySlider.value = newValue.toString();\n      }\n    }\n  }\n  @Watch('media')\n  mediaChanged(newValue: string, oldValue: string) {\n    if (oldValue !== newValue) {\n      this._registerMediaQuery(newValue);\n    }\n  }\n  @Watch('hidden')\n  hiddenChanged(newValue: boolean, oldValue: boolean) {\n    // Only process hidden changes after the layer is fully initialized\n    // During initial load, this will be handled in _attachedToMap()\n    if (oldValue !== newValue && this._layer && this._layerControl) {\n      this._applyHiddenState(newValue);\n    }\n  }\n  \n  private _applyHiddenState(isHidden: boolean) {\n    if (!this._layer || !this._layerControl) return;\n    \n    if (isHidden) {\n      // Hidden was set to true - remove from layer control\n      this._layerControl.removeLayer(this._layer);\n    } else {\n      // Hidden was set to false - add back to layer control and validate\n      this._layerControl.addOrUpdateOverlay(this._layer, this.label);\n      this._validateDisabled();\n    }\n  }\n\n  private loggedMessages: Set<unknown>;\n  private _observer?: MutationObserver;\n  private _mql?: MediaQueryList;\n  private _changeHandler?: () => void;\n  private _boundCreateLayerControlHTML?: () => any;\n  \n  // Layer control element references (synced from DOM element properties)\n  private _layerControlCheckbox?: HTMLInputElement;\n  private _layerControlLabel?: HTMLElement;\n  private _opacityControl?: HTMLElement;\n  private _opacitySlider?: HTMLInputElement;\n  // private _layerItemSettingsHTML?: HTMLElement; \n  // private _propertiesGroupAnatomy?: HTMLElement; \n  private _styles?: HTMLElement;\n\n  get label(): string {\n    if (this._layer) return this._layer.getName();\n    else return this.el.hasAttribute('label') ? this.el.getAttribute('label') : '';\n  }\n\n  set label(val: string) {\n    if (val) {\n      this.el.setAttribute('label', val);\n      if (this._layer) this._layer.setName(val);\n    }\n  }\n\n  get extent() {\n    // calculate the bounds of all content, return it.\n    if (this._layer) {\n      this._layer._calculateBounds();\n    }\n    return this._layer\n      ? Object.assign(\n          Util._convertAndFormatPCRS(\n            this._layer.bounds,\n            (window as any).M[this.getProjection()],\n            this.getProjection()\n          ),\n          { zoom: this._layer.zoomBounds }\n        )\n      : null;\n  }\n  private _registerMediaQuery(mq: string) {\n    if (!this._changeHandler) {\n      this._changeHandler = () => {\n        this._onRemove();\n        if (this._mql.matches) {\n          this._onAdd();\n        }\n        // set the disabled 'read-only' attribute indirectly, via _validateDisabled\n        this._validateDisabled();\n      };\n    }\n\n    if (mq) {\n      // a new media query is being established\n      let map = this.getMapEl();\n      if (!map) return;\n\n      // Remove listener from the old media query (if it exists)\n      if (this._mql) {\n        this._mql.removeEventListener('change', this._changeHandler);\n      }\n\n      this._mql = (map as any).matchMedia(mq);\n      this._changeHandler();\n      this._mql.addEventListener('change', this._changeHandler);\n    } else if (this._mql) {\n      // the media attribute removed or query set to ''\n      this._mql.removeEventListener('change', this._changeHandler);\n      delete this._mql;\n      // effectively, no / empty media attribute matches, do what changeHandler does\n      this._onRemove();\n      this._onAdd();\n      this._validateDisabled();\n    }\n  }\n\n  getMapEl() {\n    return Util.getClosest(this.el, 'gcds-map');\n  }\n  // Note: Stencil handles constructor automatically, but we can use componentWillLoad for initialization\n  componentWillLoad() {\n    // Mirror the original constructor logic\n    // by keeping track of console.log, we can avoid overwhelming the console\n    this.loggedMessages = new Set();\n    \n    // Publish queryable() early so it's available even before connectedCallback\n    // This is needed for dynamically added layers (e.g., via inplace links)\n    Object.defineProperty(this.el, 'queryable', {\n      value: () => this.queryable(),\n      writable: true,\n      configurable: true\n    });\n  }\n  \n  disconnectedCallback() {\n    // if the map-layer node is removed from the dom, the layer should be\n    // removed from the map and the layer control\n    if (this.el.hasAttribute('data-moving')) return;\n    this._onRemove();\n\n    if (this._mql) {\n      if (this._changeHandler) {\n        this._mql.removeEventListener('change', this._changeHandler);\n      }\n      delete this._mql;\n    }\n  }\n\n  private _onRemove() {\n    if (this._observer) {\n      this._observer.disconnect();\n    }\n    let l = this._layer,\n      lc = this._layerControl;\n\n    if (l) {\n      l.off();\n    }\n    // if this layer has never been connected, it will not have a _layer\n    if (l && l._map) {\n      l._map.removeLayer(l);\n    }\n\n    if (lc && !this.el.hasAttribute('hidden')) {\n      // lc.removeLayer depends on this._layerControlHTML, can't delete it until after\n      lc.removeLayer(l);\n    }\n    // remove properties of layer involved in whenReady() logic\n    delete this._layer;\n    delete this._layerControl;\n    delete this._layerControlHTML;\n    delete this._fetchError;\n    \n    // Clean up DOM element properties exposed for MapML compatibility\n    delete (this.el as any)._layer;\n    delete (this.el as any)._layerControl;\n    delete (this.el as any)._layerControlHTML;\n    delete (this.el as any)._fetchError;\n    \n    // Clean up layer control element references\n    this._layerControlCheckbox = undefined;\n    this._layerControlLabel = undefined;\n    this._opacityControl = undefined;\n    this._opacitySlider = undefined;\n    // this._layerItemSettingsHTML = undefined;\n    // this._propertiesGroupAnatomy = undefined;\n    this._styles = undefined;\n\n    this.el.shadowRoot.innerHTML = '';\n    if (this.src) this.el.innerHTML = '';\n    this._layerRegistry.clear();\n  }\n\n  connectedCallback() {\n    if (this.el.hasAttribute('data-moving')) return;\n    this._boundCreateLayerControlHTML = createLayerControlHTML.bind(this.el);\n    \n    // Publish _validateDisabled on element for MapML compatibility\n    (this.el as any)._validateDisabled = this._validateDisabled.bind(this);\n    \n    // Expose disabled property on DOM element\n    Object.defineProperty(this.el, 'disabled', {\n      get: () => this.disabled,\n      set: (val: boolean) => {\n        this.disabled = val;\n      },\n      configurable: true,\n      enumerable: true\n    });\n    \n    // Expose _opacity property on DOM element (internal opacity state)\n    Object.defineProperty(this.el, '_opacity', {\n      get: () => this._opacity,\n      set: (val: number) => {\n        if (val !== this._opacity) {\n          this._opacity = val;\n        }\n      },\n      configurable: true,\n      enumerable: true\n    });\n    // Expose opacity getter/setter on DOM element using the component's opacityValue\n    Object.defineProperty(this.el, 'opacity', {\n      get: () => {\n        return this.opacityValue;\n      },\n      set: (val: number) => {\n        if (+val > 1 || +val < 0) return;\n        this._opacity = val;\n        this._layer?.changeOpacity(val);\n      },\n      configurable: true,\n      enumerable: true\n    });\n\n    Object.defineProperty(this.el, 'whenElemsReady', {\n      value: () => this.whenElemsReady(),\n      writable: true,\n      configurable: true\n    })\n\n    Object.defineProperty(this.el, 'zoomTo', {\n      value: () => this.zoomTo(),\n      writable: true,\n      configurable: true\n    });\n    \n    Object.defineProperty(this.el, 'mapml2geojson', {\n      value: (options = {}) => this.mapml2geojson(options),\n      writable: true,\n      configurable: true\n    });\n    \n    Object.defineProperty(this.el, 'pasteFeature', {\n      value: (feature: any) => this.pasteFeature(feature),\n      writable: true,\n      configurable: true\n    });\n    \n    Object.defineProperty(this.el, 'getAlternateStyles', {\n      value: (styleLinks: any[]) => this.getAlternateStyles(styleLinks),\n      writable: true,\n      configurable: true\n    });\n    \n    Object.defineProperty(this.el, 'getOuterHTML', {\n      value: () => this.getOuterHTML(),\n      writable: true,\n      configurable: true\n    });\n    \n    Object.defineProperty(this.el, 'getMapEl', {\n      value: () => this.getMapEl(),\n      writable: true,\n      configurable: true\n    });\n    \n    Object.defineProperty(this.el, 'getProjection', {\n      value: () => this.getProjection(),\n      writable: true,\n      configurable: true\n    });\n\n    // Expose label property on DOM element for MapML compatibility\n    Object.defineProperty(this.el, 'label', {\n      get: () => this.label,\n      set: (val: string) => this.label = val,\n      configurable: true,\n      enumerable: true\n    });\n\n    // Expose hidden property on DOM element for MapML compatibility\n    // The @Watch('hidden') decorator handles the side effects\n    Object.defineProperty(this.el, 'hidden', {\n      get: () => this.el.hasAttribute('hidden'),\n      set: (val: boolean) => {\n        if (val) {\n          this.el.setAttribute('hidden', '');\n        } else {\n          this.el.removeAttribute('hidden');\n        }\n      },\n      configurable: true,\n      enumerable: true\n    });\n    \n    // Expose extent property on DOM element for MapML compatibility\n    Object.defineProperty(this.el, 'extent', {\n      get: () => this.extent,\n      configurable: true,\n      enumerable: true\n    });\n\n    (this.el as any)._layerRegistry = this._layerRegistry;\n\n    const doConnected = this._onAdd.bind(this);\n    const doRemove = this._onRemove.bind(this);\n    const registerMediaQuery = this._registerMediaQuery.bind(this);\n    let mq = this.media;\n    this.getMapEl()\n      .whenReady()\n      .then(() => {\n        doRemove();\n        if (mq) {\n          registerMediaQuery(mq);\n        } else {\n          doConnected();\n        }\n      })\n      .catch((error) => {\n        throw new Error('Map never became ready: ' + error);\n      });\n  }\n\n  private _onAdd() {\n    new Promise<void>((resolve, reject) => {\n      this.el.addEventListener(\n        'changestyle',\n        (e: any) => {\n          e.stopPropagation();\n          // if user changes the style in layer control\n          if (e.detail) {\n            this.src = e.detail.src;\n          }\n        },\n        { once: true }\n      );\n      let base = this.el.baseURI ? this.el.baseURI : document.baseURI;\n      const headers = new Headers();\n      headers.append('Accept', 'text/mapml');\n      if (this.src) {\n        fetch(this.src, { headers: headers })\n          .then((response) => {\n            if (!response.ok) {\n              throw new Error(`HTTP error! Status: ${response.status}`);\n            }\n            // Save the response URL to use as base for resolving relative URLs\n            const responseUrl = response.url;\n            return response.text().then(text => ({ text, url: responseUrl }));\n          })\n          .then(({ text, url: sourceUrl }) => {\n            let content = new DOMParser().parseFromString(text, 'text/xml');\n            if (\n              content.querySelector('parsererror') ||\n              !content.querySelector('mapml-')\n            ) {\n              // cut short whenReady with the _fetchError property\n              this._fetchError = true;\n              // Expose _fetchError on DOM element for MapML compatibility\n              (this.el as any)._fetchError = this._fetchError;\n              console.log('Error fetching layer content:\\n\\n' + text + '\\n');\n              throw new Error('Parser error');\n            }\n            // Attach the source URL to the content for later use\n            (content as any)._sourceUrl = sourceUrl;\n            return content;\n          })\n          .then((content) => {\n            this._copyRemoteContentToShadowRoot(content.querySelector('mapml-'), (content as any)._sourceUrl);            this._copyRemoteContentToShadowRoot(content.querySelector('mapml-'));\n            let elements = this.el.shadowRoot.querySelectorAll('*');\n            let elementsReady = [];\n            for (let i = 0; i < elements.length; i++) {\n              if ((elements[i] as any).whenReady) {\n                elementsReady.push((elements[i] as any).whenReady().catch(error => {\n                  console.warn(`Element ${elements[i].tagName} failed to become ready:`, error);\n                  return null; // Convert rejection to resolution so layer can still proceed\n                }));\n              }\n            }\n            return Promise.allSettled(elementsReady);\n          })\n          .then(() => {\n            // may throw:\n            this._selectAlternateOrChangeProjection();\n          })\n          .then(() => {\n            this._layer = (MapLayerModule as any).mapLayer(new URL(this.src, base).href, this.el, {\n              projection: this.getProjection(),\n              opacity: this.opacityValue\n            });\n            // Expose _layer on DOM element for MapML compatibility\n            (this.el as any)._layer = this._layer;\n            this._createLayerControlHTML();\n            this._setLocalizedDefaultLabel();\n            this._attachedToMap();\n            // Process any elements that were created before layer was ready\n            this._runMutationObserver(this.el.shadowRoot.children);\n            this._bindMutationObserver();\n            this._validateDisabled();\n            // re-use 'loadedmetadata' event from HTMLMediaElement inteface, applied\n            // to MapML extent as metadata\n            // Should always be fired at the end of initialization process\n            // https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/loadedmetadata_event\n            // https://maps4html.org/web-map-doc/docs/api/layer-api#events\n            this.el.dispatchEvent(\n              new CustomEvent('loadedmetadata', { detail: { target: this.el } })\n            );\n            resolve(undefined);\n          })\n          .catch((error) => {\n            reject(error);\n          });\n      } else {\n        let elements = this.el.querySelectorAll('*');\n        let elementsReady = [];\n        for (let i = 0; i < elements.length; i++) {\n          if ((elements[i] as any).whenReady)\n            elementsReady.push((elements[i] as any).whenReady());\n        }\n        Promise.allSettled(elementsReady)\n          .then(() => {\n            // may throw:\n            this._selectAlternateOrChangeProjection();\n          })\n          .then(() => {\n            this._layer = (MapLayerModule as any).mapLayer(null, this.el, {\n              projection: this.getProjection(),\n              opacity: this.opacityValue\n            });\n            // Expose _layer on DOM element for MapML compatibility\n            (this.el as any)._layer = this._layer;\n            this._createLayerControlHTML();\n            this._setLocalizedDefaultLabel();\n            this._attachedToMap();\n            // Process any elements that were created before layer was ready\n            this._runMutationObserver(this.el.children);\n            this._bindMutationObserver();\n            this._validateDisabled();\n            // re-use 'loadedmetadata' event from HTMLMediaElement inteface, applied\n            // to MapML extent as metadata\n            // Should always be fired at the end of initialization process\n            // https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/loadedmetadata_event\n            // https://maps4html.org/web-map-doc/docs/api/layer-api#events\n            this.el.dispatchEvent(\n              new CustomEvent('loadedmetadata', { detail: { target: this.el } })\n            );\n            resolve(undefined);\n          })\n          .catch((error) => {\n            reject(error);\n          });\n      }\n    }).catch((e) => {\n      if (e.message === 'changeprojection') {\n        if (e.cause.href) {\n          console.log('Changing layer src to: ' + e.cause.href);\n          this.src = e.cause.href;\n        } else if (e.cause.mapprojection) {\n          console.log(\n            'Changing map projection to match layer: ' + e.cause.mapprojection\n          );\n          const mapEl = this.getMapEl();\n          if (mapEl) {\n            (mapEl as any).projection = e.cause.mapprojection;\n          }\n        }\n      } else if (e.message === 'Failed to fetch') {\n        // cut short whenReady with the _fetchError property\n        this._fetchError = true;\n        // Expose _fetchError on DOM element for MapML compatibility\n        (this.el as any)._fetchError = this._fetchError;\n      } else {\n        console.log(e);\n        this.el.dispatchEvent(\n          new CustomEvent('error', { detail: { target: this.el } })\n        );\n      }\n    });\n  }\n\n  private _setLocalizedDefaultLabel() {\n    if (!this._layer?._titleIsReadOnly && !this._layer?._title) {\n      const mapEl = this.getMapEl();\n      if (mapEl && (mapEl as any).locale?.dfLayer) {\n        this.label = (mapEl as any).locale.dfLayer;\n      }\n    }\n  }\n\n  private _selectAlternateOrChangeProjection() {\n    const mapml = this.src ? this.el.shadowRoot : this.el;\n    const mapEl = this.getMapEl();\n    \n    if (!mapml || !mapEl) return;\n    \n    const selectedAlternate = \n      this.getProjection() !== (mapEl as any).projection &&\n      mapml.querySelector(\n        'map-link[rel=alternate][projection=' +\n          (mapEl as any).projection +\n          '][href]'\n      );\n\n    if (selectedAlternate) {\n      // Use the same base resolution logic as map-link.getBase()\n      // Check for map-base element first, then fall back to layer src\n      let baseUrl: string;\n      const mapBase = mapml.querySelector('map-base[href]');\n      if (mapBase) {\n        baseUrl = mapBase.getAttribute('href')!;\n      } else if (this.src) {\n        // Fallback to resolving layer's src against document base\n        baseUrl = new URL(this.src, this.el.baseURI || document.baseURI).href;\n      } else {\n        baseUrl = this.el.baseURI || document.baseURI;\n      }\n      \n      const url = new URL(selectedAlternate.getAttribute('href')!, baseUrl).href;\n      throw new Error('changeprojection', {\n        cause: { href: url }\n      });\n    }\n    \n    const contentProjection = this.getProjection();\n    if (\n      contentProjection !== (mapEl as any).projection &&\n      (mapEl as any).layers?.length === 1\n    ) {\n      throw new Error('changeprojection', {\n        cause: { mapprojection: contentProjection }\n      });\n    }\n  }\n\n  private _copyRemoteContentToShadowRoot(mapml: any, sourceUrl?: string) {\n    const shadowRoot = this.el.shadowRoot;\n    if (!shadowRoot || !mapml) return;\n    \n    const frag = document.createDocumentFragment();\n    const elements = mapml.querySelectorAll('map-head > *, map-body > *');\n    \n    // Find or create a map-base element to store the source document's base URL\n    let mapBase = Array.from(elements).find(el => (el as any).nodeName === 'MAP-BASE') as HTMLElement;\n    \n    if (!mapBase && sourceUrl) {\n      // Create a synthetic map-base element if none exists\n      mapBase = document.createElement('map-base');\n      mapBase.setAttribute('href', sourceUrl);\n      frag.appendChild(mapBase);\n    } else if (mapBase && sourceUrl) {\n      // Resolve existing map-base href against the source URL\n      const resolvedHref = new URL(mapBase.getAttribute('href') || '', sourceUrl).href;\n      mapBase.setAttribute('href', resolvedHref);\n    }\n    \n    for (let i = 0; i < elements.length; i++) {\n      frag.appendChild(elements[i]);\n    }\n    \n    shadowRoot.appendChild(frag);\n  }\n  /**\n   * For \"local\" content, getProjection will use content of \"this\"\n   * For \"remote\" content, you need to pass the shadowRoot to search through\n   */\n  getProjection() {\n    let mapml = this.src ? this.el.shadowRoot : this.el;\n    let projection = this.getMapEl().projection;\n    if (mapml.querySelector('map-meta[name=projection][content]')) {\n      projection =\n        Util._metaContentToObject(\n          mapml\n            .querySelector('map-meta[name=projection]')\n            .getAttribute('content')\n        ).content || projection;\n    } else if (mapml.querySelector('map-extent[units]')) {\n      const getProjectionFrom = (extents) => {\n        let extentProj = extents[0].attributes.units.value;\n        let isMatch = true;\n        for (let i = 0; i < extents.length; i++) {\n          if (extentProj !== extents[i].attributes.units.value) {\n            isMatch = false;\n          }\n        }\n        return isMatch ? extentProj : null;\n      };\n      projection =\n        getProjectionFrom(\n          Array.from(mapml.querySelectorAll('map-extent[units]'))\n        ) || projection;\n    } else {\n      const titleElement = this.el.querySelector('map-title');\n      const layerLabel = this.label || (titleElement ? titleElement.textContent : 'Unnamed');\n      const message = `A projection was not assigned to the '${layerLabel}' Layer. \\nPlease specify a projection for that layer using a map-meta element. \\nSee more here - https://maps4html.org/web-map-doc/docs/elements/meta/`;\n      if (!this.loggedMessages.has(message)) {\n        console.log(message);\n        this.loggedMessages.add(message);\n      }\n    }\n    return projection;\n  }\n  private _attachedToMap() {\n    // Refactored from layer.js _attachedToMap()\n    // Set i to the position of this layer element in the set of layers\n    const mapEl = this.getMapEl();\n    if (!mapEl || !this._layer) return;\n\n    let i = 0;\n    let position = 1;\n    const nodes = mapEl.children;\n    \n    for (i = 0; i < nodes.length; i++) {\n      if (\n        nodes[i].nodeName === 'MAP-LAYER' ||\n        nodes[i].nodeName === 'LAYER-'\n      ) {\n        if (nodes[i] === this.el) {\n          position = i + 1;\n        } else if ((nodes[i] as any)._layer) {\n          (nodes[i] as any)._layer.setZIndex(i + 1);\n        }\n      }\n    }\n    \n    const proj = (mapEl as any).projection ? (mapEl as any).projection : 'OSMTILE';\n    setOptions(this._layer, {\n      zIndex: position,\n      mapprojection: proj,\n      opacity: window.getComputedStyle(this.el).opacity\n    });\n\n    if (this.checked) {\n      this._layer.addTo((mapEl as any)._map);\n      // Toggle the this.disabled attribute depending on whether the layer\n      // is: same prj as map, within view/zoom of map\n    }\n    \n    (mapEl as any)._map.on('moveend layeradd', this._validateDisabled, this);\n    this._layer.on('add remove', this._validateDisabled, this);\n\n    if ((mapEl as any)._layerControl) {\n      this._layerControl = (mapEl as any)._layerControl;\n      // Expose _layerControl on DOM element for MapML compatibility\n      (this.el as any)._layerControl = this._layerControl;\n    }\n    \n    // If controls option is enabled, insert the layer into the overlays array\n    if ((mapEl as any)._layerControl && !this.hidden) {\n      this._layerControl.addOrUpdateOverlay(this._layer, this.label);\n    }\n\n    // The mapml document associated to this layer can in theory contain many\n    // link[@rel=legend] elements with different @type or other attributes;\n    // currently only support a single link, don't care about type, lang etc.\n    // TODO: add support for full LayerLegend object, and > one link.\n    if (this._layer._legendUrl) {\n      (this.el as any).legendLinks = [\n        {\n          type: 'application/octet-stream',\n          href: this._layer._legendUrl,\n          rel: 'legend',\n          lang: null,\n          hreflang: null,\n          sizes: null\n        }\n      ];\n    }\n  }\n  \n  private _runMutationObserver(elementsGroup: NodeList | HTMLCollection) {\n    const _addStylesheetLink = (mapLink: any) => {\n      this.whenReady().then(() => {\n        this._layer.renderStyles(mapLink);\n      });\n    };\n    const _addStyleElement = (mapStyle: any) => {\n      this.whenReady().then(() => {\n        this._layer.renderStyles(mapStyle);\n      });\n    };\n    const _addExtentElement = (mapExtent: any) => {\n      this.whenReady().then(() => {\n        // Wait for the extent itself to be ready before recalculating bounds\n        if (typeof mapExtent.whenReady === 'function') {\n          mapExtent.whenReady().then(() => {\n            // Force complete recalculation by deleting cached bounds\n            delete this._layer.bounds;\n            this._layer._calculateBounds();\n            this._validateDisabled();\n          });\n        } else {\n          delete this._layer.bounds;\n          this._layer._calculateBounds();\n          this._validateDisabled();\n        }\n      });\n    };\n    \n    const root = this.src ? this.el.shadowRoot : this.el;\n    const pseudo = root instanceof ShadowRoot ? ':host' : ':scope';\n    \n    const _addMetaElement = (_mapMeta: any) => {\n      this.whenReady().then(() => {\n        this._layer._calculateBounds();\n        this._validateDisabled();\n      });\n    };\n    \n    for (let i = 0; i < elementsGroup.length; ++i) {\n      const element = elementsGroup[i] as any;\n      switch (element.nodeName) {\n        case 'MAP-LINK':\n          if (element.link && !element.link.isConnected)\n            _addStylesheetLink(element);\n          break;\n        case 'MAP-STYLE':\n          if (element.styleElement && !element.styleElement.isConnected) {\n            _addStyleElement(element);\n          }\n          break;\n        case 'MAP-EXTENT':\n          _addExtentElement(element);\n          break;\n        case 'MAP-META':\n          const name =\n            element.hasAttribute('name') &&\n            (element.getAttribute('name').toLowerCase() === 'zoom' ||\n              element.getAttribute('name').toLowerCase() === 'extent');\n          if (\n            name &&\n            element ===\n              root.querySelector(\n                `${pseudo} > [name=${element.getAttribute('name')}]`\n              ) &&\n            element.hasAttribute('content')\n          ) {\n            _addMetaElement(element);\n          }\n          break;\n        default:\n          break;\n      }\n    }\n  }\n  \n  /**\n   * Set up a function to watch additions of child elements of map-layer or\n   * map-layer.shadowRoot and invoke desired side effects via _runMutationObserver\n   */\n  private _bindMutationObserver() {\n    this._observer = new MutationObserver((mutationList) => {\n      for (let mutation of mutationList) {\n        if (mutation.type === 'childList') {\n          this._runMutationObserver(mutation.addedNodes);\n        }\n      }\n    });\n    this._observer.observe(this.src ? this.el.shadowRoot : this.el, {\n      childList: true\n    });\n  }\n  \n  private _validateDisabled() {\n    const countTileLayers = () => {\n      let totalCount = 0;\n      let disabledCount = 0;\n\n      this._layer.eachLayer((layer: any) => {\n        if (layer instanceof MapTileLayer) {\n          totalCount++;\n          if (!layer.isVisible()) disabledCount++;\n        }\n      });\n\n      return { totalCount, disabledCount };\n    };\n    const countFeatureLayers = () => {\n      let totalCount = 0;\n      let disabledCount = 0;\n\n      this._layer.eachLayer((layer: any) => {\n        if (layer instanceof MapFeatureLayer) {\n          totalCount++;\n          if (!layer.isVisible()) disabledCount++;\n        }\n      });\n\n      return { totalCount, disabledCount };\n    };\n    // setTimeout is necessary to make the validateDisabled happen later than the moveend operations etc.,\n    // to ensure that the validated result is correct\n    setTimeout(() => {\n      let layer = this._layer,\n        map = layer?._map;\n      // if there's a media query in play, check it early\n      if (this._mql && !this._mql.matches) {\n        this.el.setAttribute('disabled', '');\n        this.disabled = true;\n        return;\n      }\n      if (map) {\n        // prerequisite: no inline and remote mapml elements exists at the same time\n        const mapExtents = this.src\n          ? this.el.shadowRoot?.querySelectorAll('map-extent')\n          : this.el.querySelectorAll('map-extent');\n        let extentLinksReady: Promise<any>[] = [];\n        if (mapExtents) {\n          for (let i = 0; i < mapExtents.length; i++) {\n            if ((mapExtents[i] as any).whenLinksReady) {\n              extentLinksReady.push((mapExtents[i] as any).whenLinksReady());\n            }\n          }\n        }\n        Promise.allSettled(extentLinksReady)\n          .then(() => {\n            let disabledExtentCount = 0,\n              totalExtentCount = 0,\n              layerTypes = [\n                '_staticTileLayer',\n                '_mapmlvectors',\n                '_extentLayer'\n              ];\n            for (let j = 0; j < layerTypes.length; j++) {\n              let type = layerTypes[j];\n              if (this.checked) {\n                if (type === '_extentLayer' && mapExtents && mapExtents.length > 0) {\n                  for (let i = 0; i < mapExtents.length; i++) {\n                    totalExtentCount++;\n                    if ((mapExtents[i] as any)._validateDisabled && (mapExtents[i] as any)._validateDisabled())\n                      disabledExtentCount++;\n                  }\n                } else if (type === '_mapmlvectors') {\n                  // inline / static features\n                  const featureLayerCounts = countFeatureLayers();\n                  totalExtentCount += featureLayerCounts.totalCount;\n                  disabledExtentCount += featureLayerCounts.disabledCount;\n                } else {\n                  // inline tiles\n                  const tileLayerCounts = countTileLayers();\n                  totalExtentCount += tileLayerCounts.totalCount;\n                  disabledExtentCount += tileLayerCounts.disabledCount;\n                }\n              }\n            }\n            // if all extents are not visible / disabled, set layer to disabled\n            if (\n              disabledExtentCount === totalExtentCount &&\n              disabledExtentCount !== 0\n            ) {\n              this.el.setAttribute('disabled', '');\n              this.disabled = true;\n            } else {\n              this.el.removeAttribute('disabled');\n              this.disabled = false;\n            }\n            this.toggleLayerControlDisabled();\n          })\n          .catch((e) => {\n            console.log(e);\n          });\n      }\n    }, 0);\n  }\n  // disable/italicize layer control elements based on the map-layer.disabled property\n  private toggleLayerControlDisabled() {\n    let input = this._layerControlCheckbox,\n      label = this._layerControlLabel,\n      opacityControl = this._opacityControl,\n      opacitySlider = this._opacitySlider,\n      styleControl = this._styles;\n    if (this.disabled) {\n      if (input) input.disabled = true;\n      if (opacitySlider) opacitySlider.disabled = true;\n      if (label) label.style.fontStyle = 'italic';\n      if (opacityControl) opacityControl.style.fontStyle = 'italic';\n      if (styleControl) {\n        styleControl.style.fontStyle = 'italic';\n        styleControl.querySelectorAll('input').forEach((i: any) => {\n          i.disabled = true;\n        });\n      }\n    } else {\n      if (input) input.disabled = false;\n      if (opacitySlider) opacitySlider.disabled = false;\n      if (label) label.style.fontStyle = 'normal';\n      if (opacityControl) opacityControl.style.fontStyle = 'normal';\n      if (styleControl) {\n        styleControl.style.fontStyle = 'normal';\n        styleControl.querySelectorAll('input').forEach((i: any) => {\n          i.disabled = false;\n        });\n      }\n    }\n  }\n  queryable(): boolean {\n    let content = this.src ? this.el.shadowRoot : this.el;\n    return !!(\n      content?.querySelector(\n        'map-extent[checked] > map-link[rel=query]:not([disabled])'\n      ) &&\n      this.checked &&\n      this._layer &&\n      !this.el.hasAttribute('hidden')\n    );\n  }\n  getAlternateStyles(styleLinks: any[]): HTMLElement | null {\n    if (styleLinks.length > 1) {\n      const stylesControl = document.createElement('details');\n      const stylesControlSummary = document.createElement('summary');\n      const mapEl = this.getMapEl();\n      \n      stylesControlSummary.innerText = (mapEl as any)?.locale?.lmStyle || 'Style';\n      stylesControl.appendChild(stylesControlSummary);\n\n      for (let j = 0; j < styleLinks.length; j++) {\n        stylesControl.appendChild(styleLinks[j].getLayerControlOption());\n        DomUtil.addClass(\n          stylesControl,\n          'mapml-layer-item-style mapml-control-layers'\n        );\n      }\n      return stylesControl;\n    }\n    return null;\n  }\n\n  getOuterHTML(): string {\n    let tempElement = this.el.cloneNode(true) as HTMLElement;\n\n    if (this.el.hasAttribute('src')) {\n      let newSrc = this._layer.getHref();\n      tempElement.setAttribute('src', newSrc);\n    }\n    if (this.el.querySelector('map-link')) {\n      let mapLinks = tempElement.querySelectorAll('map-link');\n\n      mapLinks.forEach((mapLink) => {\n        if (mapLink.hasAttribute('href')) {\n          mapLink.setAttribute(\n            'href',\n            decodeURI(\n              new URL(\n                mapLink.getAttribute('href')!,\n                this.el.baseURI ? this.el.baseURI : document.baseURI\n              ).href\n            )\n          );\n        } else if (mapLink.hasAttribute('tref')) {\n          mapLink.setAttribute(\n            'tref',\n            decodeURI(\n              new URL(\n                mapLink.getAttribute('tref')!,\n                this.el.baseURI ? this.el.baseURI : document.baseURI\n              ).href\n            )\n          );\n        }\n      });\n    }\n\n    let outerLayer = tempElement.outerHTML;\n\n    tempElement.remove();\n\n    return outerLayer;\n  }\n  zoomTo() {\n    this.whenReady().then(() => {\n      let map = (this.getMapEl() as any)?._map,\n        extent = this.extent,\n        tL = extent.topLeft.pcrs,\n        bR = extent.bottomRight.pcrs,\n        layerBounds = bounds(\n          point(tL.horizontal, tL.vertical),\n          point(bR.horizontal, bR.vertical)\n        ),\n        center = map.options.crs.unproject(layerBounds.getCenter(true));\n\n      let maxZoom = extent.zoom.maxZoom,\n        minZoom = extent.zoom.minZoom;\n      map.setView(center, Util.getMaxZoom(layerBounds, map, minZoom, maxZoom), {\n        animate: false\n      });\n    });\n  }\n\n  pasteFeature(feature: any) {\n    switch (typeof feature) {\n      case 'string':\n        feature.trim();\n        if (\n          feature.slice(0, 12) === '<map-feature' &&\n          feature.slice(-14) === '</map-feature>'\n        ) {\n          this.el.insertAdjacentHTML('beforeend', feature);\n        }\n        break;\n      case 'object':\n        if (feature.nodeName?.toUpperCase() === 'MAP-FEATURE') {\n          this.el.appendChild(feature);\n        }\n    }\n  }\n  private _createLayerControlHTML() {\n    // Use the bound function that was set up in connectedCallback  \n    // The createLayerControlHTML function was bound to this.el in connectedCallback\n    if (this._boundCreateLayerControlHTML) {\n      // Call the async function but don't await it (matches original layer.js behavior)\n      this._boundCreateLayerControlHTML().then((result: any) => {\n        this._layerControlHTML = result;\n        // Expose _layerControlHTML on DOM element for MapML compatibility\n        (this.el as any)._layerControlHTML = this._layerControlHTML;\n        \n        // Sync all layer control properties created by createLayerControlForLayer\n        // These properties are set on the DOM element by the bound function and need to be\n        // available on both the element and the component for future refactoring\n        this._layerControlCheckbox = (this.el as any)._layerControlCheckbox;\n        this._layerControlLabel = (this.el as any)._layerControlLabel;\n        this._opacityControl = (this.el as any)._opacityControl;\n        this._opacitySlider = (this.el as any)._opacitySlider;\n        this._layerItemSettingsHTML = (this.el as any)._layerItemSettingsHTML;\n        this._propertiesGroupAnatomy = (this.el as any)._propertiesGroupAnatomy;\n        this._styles = (this.el as any)._styles;\n        \n        // Ensure opacity slider is synced with current opacity value\n        if (this._opacitySlider && this._opacity !== undefined) {\n          this._opacitySlider.value = this._opacity.toString();\n        }\n        \n\n      });\n    }\n  }\n\n  @Method()\n  async whenReady(): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      let interval: any, failureTimer: any;\n      if (\n        (this.el as any)._layer &&\n        this._layerControlHTML &&\n        (!this.src || this.el.shadowRoot?.childNodes.length)\n      ) {\n        resolve();\n      } else {\n        const layerElement = this.el;\n        interval = setInterval(testForLayer, 200, layerElement);\n        failureTimer = setTimeout(layerNotDefined, 5000);\n      }\n\n      function testForLayer(layerElement: any) {\n        if (\n          layerElement._layer &&\n          layerElement._layerControlHTML &&\n          (!layerElement.src || layerElement.shadowRoot?.childNodes.length)\n        ) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          resolve();\n        } else if (layerElement._fetchError) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          reject('Error fetching layer content');\n        }\n      }\n      \n      function layerNotDefined() {\n        clearInterval(interval);\n        clearTimeout(failureTimer);\n        reject('Timeout reached waiting for layer to be ready');\n      }\n    });\n  }\n  /**\n   * Wait for all map-extent and map-feature elements to be ready.\n   * Returns a promise that resolves when all are settled.\n   */\n  @Method()\n  async whenElemsReady(): Promise<PromiseSettledResult<unknown>[]> {\n    let elemsReady: Promise<unknown>[] = [];\n    // Use shadowRoot if src is set, otherwise use this.el\n    let target = this.src ? this.el.shadowRoot : this.el;\n    if (!target) return [];\n    const extents = Array.from(target.querySelectorAll('map-extent'));\n    const features = Array.from(target.querySelectorAll('map-feature'));\n    for (let elem of [...extents, ...features]) {\n      if (typeof (elem as any).whenReady === 'function') {\n        elemsReady.push((elem as any).whenReady());\n      }\n    }\n    return Promise.allSettled(elemsReady);\n  }\n\n  /**\n   * Convert this MapML layer to GeoJSON FeatureCollection\n   * @param options - Conversion options:\n   *   - propertyFunction: Function to map <map-properties> to GeoJSON properties\n   *   - transform: Whether to transform coordinates to GCRS (EPSG:4326), defaults to true\n   * @returns GeoJSON FeatureCollection object\n   */\n  mapml2geojson(options: any = {}): any {\n    return Util.mapml2geojson(this.el, options);\n  }\n\n  render() {\n    return null;\n  }\n}\n"]}