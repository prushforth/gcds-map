{"version":3,"file":"map-input.js","sourceRoot":"","sources":["../../../src/components/map-input/map-input.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Prop, Method } from '@stencil/core';\nimport { Util } from '../utils/mapml/Util';\nimport { ZoomInput } from '../utils/mapml/elementSupport/inputs/zoomInput';\nimport { HiddenInput } from '../utils/mapml/elementSupport/inputs/hiddenInput';\nimport { WidthInput } from '../utils/mapml/elementSupport/inputs/widthInput';\nimport { HeightInput } from '../utils/mapml/elementSupport/inputs/heightInput';\nimport { LocationInput } from '../utils/mapml/elementSupport/inputs/locationInput';\n\n@Component({\n  tag: 'map-input',\n  shadow: false\n})\nexport class MapInput {\n  @Element() el: HTMLElement;\n\n  // Core attributes that can be set on the element\n  @Prop({ reflect: true }) name!: string;\n  @Prop({ reflect: true }) type!: string;\n  @Prop({ reflect: true, mutable: true }) value?: string;\n  @Prop({ reflect: true }) axis?: string;\n  @Prop({ reflect: true }) units?: string;\n  @Prop({ reflect: true }) position?: string;\n  @Prop({ reflect: true }) rel?: string;\n  @Prop({ reflect: true }) min?: string;\n  @Prop({ reflect: true }) max?: string;\n  @Prop({ reflect: true }) step?: string;\n\n  // Internal state\n  input: any; // Stores the input class instance (ZoomInput, LocationInput, etc.)\n  _layer: any;\n  initialValue?: number;\n\n  getMapEl() {\n    return Util.getClosest(this.el, 'gcds-map');\n  }\n\n  getLayerEl() {\n    return Util.getClosest(this.el, 'map-layer,layer-');\n  }\n\n  async connectedCallback() {\n    try {\n      // Publish methods on element for MapML compatibility\n      (this.el as any).getMapEl = this.getMapEl.bind(this);\n      (this.el as any).getLayerEl = this.getLayerEl.bind(this);\n      \n      // await (this.el.parentElement as any).whenReady();\n      // // TODO this might not be necessary, as map-extent doesn't have a _layer property afaik\n      // if (this.el.parentElement.nodeName === 'MAP-EXTENT') {\n      //   this._layer = (this.el.parentElement as any)._layer;\n      // }\n\n      switch (this.type) {\n        case 'zoom':\n          // this could be a bug, but it's the same bug as the mapml-source zoom input\n          this.initialValue = +this.el.getAttribute('value');\n          // Publish for MapML compatibility\n          (this.el as any).initialValue = this.initialValue;\n          this.input = new ZoomInput(\n            this.name,\n            this.min,\n            this.max,\n            this.initialValue,\n            this.step,\n            this._layer\n          );\n          break;\n        case 'location':\n          this.input = new LocationInput(\n            this.name,\n            this.position,\n            this.axis,\n            this.units,\n            this.min,\n            this.max,\n            this.rel,\n            this._layer\n          );\n          break;\n        case 'width':\n          this.input = new WidthInput(this.name, this._layer);\n          break;\n        case 'height':\n          this.input = new HeightInput(this.name, this._layer);\n          break;\n        case 'hidden':\n          this.input = new HiddenInput(this.name, this.value);\n          break;\n      }\n    } catch (reason) {\n      console.log(reason, '\\nin mapInput.connectedCallback');\n    }\n  }\n\n  disconnectedCallback() {\n    // Cleanup if needed\n  }\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/checkValidity\n  checkValidity(): boolean {\n    if (this.input?.validateInput()) {\n      return true;\n    } else {\n      const evt = new Event('invalid', {\n        bubbles: true,\n        cancelable: true,\n        composed: true\n      });\n      this.el.dispatchEvent(evt);\n      return false;\n    }\n  }\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/reportValidity\n  reportValidity(): boolean {\n    if (this.input?.validateInput()) {\n      return true;\n    } else {\n      const evt = new Event('invalid', {\n        bubbles: true,\n        cancelable: true,\n        composed: true\n      });\n      this.el.dispatchEvent(evt);\n      // If the event isn't canceled, report the problem to the user.\n      // https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#dom-cva-reportvalidity-dev\n      console.log(\"Input type='\" + this.type + \"' is not valid!\");\n      return false;\n    }\n  }\n\n  @Method()\n  async whenReady(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      let interval: any, failureTimer: any;\n      \n      if (this.input) {\n        resolve();\n        return;\n      }\n\n      const inputElement = this;\n      interval = setInterval(testForInput, 300, inputElement);\n      failureTimer = setTimeout(inputNotDefined, 10000);\n\n      function testForInput(inputElement: MapInput) {\n        if (inputElement.input) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          resolve();\n        } else if (!inputElement.el.isConnected) {\n          clearInterval(interval);\n          clearTimeout(failureTimer);\n          reject('map-input was disconnected while waiting to be ready');\n        }\n      }\n\n      function inputNotDefined() {\n        clearInterval(interval);\n        clearTimeout(failureTimer);\n        reject('Timeout reached waiting for input to be ready');\n      }\n    });\n  }\n\n  render() {\n    return null;\n  }\n}\n"]}